<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hadoop Practices :: The Cuddly Computing Machine</title>
    <link rel="canonical" href="http://alexwangx.github.io/cuddly-blog/1.2/hadoop/hdp-ops/hadoop_practices.html">
    <meta name="generator" content="Antora 2.3.1">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-86782445-1"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','UA-86782445-1')</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="http://alexwangx.github.io">The Cuddly Computing Machine</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/alexwangx">GitHub</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="cuddly-blog" data-version="1.2">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">Cuddly Blog</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Flink</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../flink/training/index.html">Flink Training Home</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Streaming 介绍</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../flink/training/intro/intro-1.html">使用Apache Flink 进行流处理</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../flink/training/intro/intro-2.html">流可以传输什么?</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../flink/training/intro/intro-3.html">一个完整的例子</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">环境配置</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../flink/training/labs/devEnvSetup.html">设置您的开发环境</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../flink/training/labs/taxiData.html">使用出租车数据流</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../flink/training/labs/howto-exercises.html">如何做实验室</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../flink/training/lab1/rideCleansing.html">Lab 1 - 过滤流</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">数据转换</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../flink/training/lab1/stateless.html">无状态转换</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../flink/training/lab1/keyed-streams.html">Keyed 流</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../flink/training/lab1/stateful.html">有状态的转换</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../flink/training/lab1/connected-streams.html">连接流</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../flink/training/lab2/rideEnrichment-flatmap.html">Lab 2 - Stateful Enrichment</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">时间和分析</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../flink/training/lab3/event-time-watermarks.html">Event Time and Watermarks</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../flink/training/lab3/windows.html">Windows</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Lab 3 - Windowing</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../flink/training/lab3/hourlyTips.html">Lab 3 - 窗口化分析</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../flink/training/lab3/hourlyTips-discussion.html">Lab 3 - 讨论</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">事件驱动的应用</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../flink/training/lab4/processfunction.html">ProcessFunction</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../flink/training/lab4/side-outputs.html">Side Outputs</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Lab 4 - 到期状态</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../flink/training/lab4/rideEnrichment-processfunction.html">Lab 4 - 练习</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../flink/training/lab4/expiring-state-discussion.html">Lab 4 - 讨论</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">容错能力</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../flink/training/fault/state-backends.html">状态后端</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../flink/training/fault/snapshots.html">检查点和保存点</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../flink/training/app-dev.html">应用开发</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">其他练习</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../flink/training/extra-labs/longRides.html">长途警报</a>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">广播状态</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../flink/training/extra-labs/nearestTaxi.html">寻找最近的出租车</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../flink/training/extra-labs/ongoingRides.html">报告正在进行的出租车</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../../flink/training/extra-labs/taxiQuery.html">规则引擎</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../flink/training/extra-labs/eventTimeJoin.html">丰富的 Joins</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../flink/training/resources.html">资源链接</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../flink/introduction/index.html">Flink 简介</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../flink/introduction/architecture.html">Flink 架构介绍</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../flink/introduction/failover.html">Flink 容错机制</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../flink/introduction/scheduling.html">Flink 调度机制</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../flink/introduction/statemachine.html">Flink 状态机</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../flink/introduction/memorymanager.html">Flink 内存管理</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../flink/introduction/dataflow.html">Flink Dataflow</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../flink/introduction/batchdata.html">Flink 批处理</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../flink/introduction/streamdata.html">Flink 流处理</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../flink/internals/index.html">Flink 学习笔记</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Spark</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Spark ops</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../spark/ops/spark-exitcode.html">Spark 任务退出码</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../spark/ops/spark-issues.html">Spark 常见错误</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://alexwangx.github.io/apache-spark-internals/2.4.5/">Spark 2.4.4 架构原理</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Hadoop</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hadoop_krb_install.html">Hadoop 配置 Kerberos</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Hadoop ops</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="hadoop_commands.html">Hadoop Commands</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="hadoop_practices.html">Hadoop Practices</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="hadoop_jmx.html">Hadoop JMX</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="hadoop_delroot.html">Hadoop 意外删除挽救</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="delrmstore_onzk.html">删除ZK上的rmstore目录</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Hbase</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Hbase ops</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../hbase/hbase-ops/hbase_notes.html">Hbase 基本命令</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../hbase/hbase-ops/hbase_issues.html">Hbase Issues</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Druid</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../druid/druid-install.html">Druid 安装</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../druid/ops/druid-restApi.html">Druid RestApi</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Druid 架构</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../druid/druid-internals/tutorial-load-data.html">Druid 导入数据</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../druid/druid-internals/tutorial-load-data1.html">Druid Json 配置介绍</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../druid/druid-internals/druid-internals.html">Druid 0.1.5 架构</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../druid/druid-internals/broker.html">Druid Broker</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../druid/druid-internals/coordinator.html">Druid Coordinator</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../druid/druid-internals/historical.html">Druid Historical</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../druid/druid-internals/middleManager.html">Druid MiddleManager</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../druid/druid-internals/overlord.html">Druid Overlord</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../druid/druid-internals/router.html">Druid Router</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../druid/druid-internals/segment.html">Druid Segments</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Kafka</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../kafka/kafka_practices.html">Kafka Practices</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../kafka/kafka_issues.html">Kafka Issues</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Other</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../mac.html">Mac OS</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../linux.html">Linux</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../mysql_install.html">Mysql 安装</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../readlist.html">北京中小学孩子读书清单</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../demo/demo.html">Adoc Demo</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Cuddly Blog</span>
    <span class="version">1.2</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Cuddly Blog</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">1.2</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main>
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Cuddly Blog</a></li>
    <li>Hadoop</li>
    <li>Hadoop ops</li>
    <li><a href="hadoop_practices.html">Hadoop Practices</a></li>
  </ul>
</nav>
</div>
<article class="doc">
<h1 class="page">Hadoop Practices</h1>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>转载: 请附上原文出处链接.</p>
</li>
<li>
<p><a href="https://github.com/alexwangx/alexwangx.github.io/issues" target="_blank" rel="noopener">点击留言</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://www.slideshare.net/Hadoop_Summit/hadoop-operations-best-practices-from-the-field">Hadoop Operations - Best Practices from the Field</a></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configuration - Hardware and Cluster Sizing</p>
<div class="ulist">
<ul>
<li>
<p>Larger clusters heal faster on nodes or disk failure</p>
</li>
<li>
<p>Machines with huge storage take longer to recover</p>
</li>
<li>
<p>More racks give more failure domains</p>
</li>
<li>
<p>Recommendations</p>
<div class="ulist">
<ul>
<li>
<p>Get good-quality commodity hardware</p>
</li>
</ul>
</div>
</li>
<li>
<p>Buy the sweet-spot in pricing: 3TB disk, 96GB, 8-12 cores</p>
<div class="ulist">
<ul>
<li>
<p>More memory is better</p>
</li>
<li>
<p>real time is memory hungry!</p>
</li>
</ul>
</div>
</li>
<li>
<p>Before considering fatter machines (1U 6 disks vs. 2U 12 disks)</p>
<div class="ulist">
<ul>
<li>
<p>Get to 30-40 machines or 3-4 racks</p>
</li>
</ul>
</div>
</li>
<li>
<p>Use pilot cluster to learn about load patterns</p>
<div class="ulist">
<ul>
<li>
<p>Balanced hardware for I/O, compute or memory bound</p>
</li>
</ul>
</div>
</li>
<li>
<p>More details - <a href="http://tinyurl.com/hwx-hadoop-hw" class="bare">http://tinyurl.com/hwx-hadoop-hw</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Configuration – JVM Tuning</p>
<div class="ulist">
<ul>
<li>
<p>Avoid JVM issues</p>
</li>
<li>
<p>Use 64 bit JVM for all daemons - 对所有守护程序使用64位JVM</p>
<div class="ulist">
<ul>
<li>
<p>Compressed OOPS enabled by default (6 u23 and later)</p>
</li>
<li>
<p>默认启用压缩OOPS（6 u23及更高版本）-XX:+UseCompressedOops</p>
</li>
<li>
<p>-XX:+UseCompressedOops当java堆内存大小 &lt; 32GB的时候,默认开启(<a href="http://rednaxelafx.iteye.com/blog/1010079" class="bare">http://rednaxelafx.iteye.com/blog/1010079</a>)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Java heap size</p>
<div class="ulist">
<ul>
<li>
<p>Set same max and starting heapsize, Xmx(最大堆大小) == Xms(初始堆大小)</p>
</li>
<li>
<p>避免使用jvm默认值 – 配置 NewSize(年轻代大小) and MaxNewSize (年轻代大小)</p>
</li>
<li>
<p>Use 1/8 to 1/6 of max size for JVMs larger than 4G</p>
</li>
<li>
<p>对于大于4G的JVM，使用最大大小的1/8至1/6</p>
</li>
<li>
<p>Configure –XX:PermSize=128m, -XX:MaxPermSize=256m (持久代大小)</p>
</li>
</ul>
</div>
</li>
<li>
<p>使用低延迟GC收集器</p>
<div class="ulist">
<ul>
<li>
<p>-XX:+UseConcMarkSweepGC, -XX:ParallelGCThreads=&lt;N&gt; (设置并行收集器收集时使用的CPU数。并行收集线程数)</p>
</li>
<li>
<p>High &lt;N&gt; on Namenode and JobTracker or ResourceManager</p>
</li>
</ul>
</div>
</li>
<li>
<p>重要的JVM配置以帮助调试</p>
<div class="ulist">
<ul>
<li>
<p>-verbose:gc(在输出设备上显示虚拟机运行信息) -Xloggc:&lt;file&gt; -XX:+PrintGCDetails</p>
</li>
<li>
<p>-XX:ErrorFile=&lt;file&gt; – -XX:+HeapDumpOnOutOfMemoryError</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Configuration</p>
<div class="ulist">
<ul>
<li>
<p>使用QuorumJournalManager进行部署以实现高可用性</p>
</li>
<li>
<p>Configure open fd ulimit</p>
<div class="ulist">
<ul>
<li>
<p>Default 1024 is too low</p>
</li>
<li>
<p>16K for datanodes, 64K for Master nodes</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Configuration</p>
<div class="ulist">
<ul>
<li>
<p>Use disk fail in place for datanodes: dfs.datanode.failed.volumes.tolerated (能够导致DN挂掉的坏硬盘最大数，默认0就是只要有1个硬盘坏了，DN就会shutdown)</p>
</li>
<li>
<p>磁盘故障并不代表DN故障</p>
</li>
<li>
<p>对于大密度节点特别重要</p>
<div class="ulist">
<ul>
<li>
<p>Set dfs.namenode.name.dir.restore to true (是否尝试重新存储失败的存储目录)</p>
</li>
</ul>
</div>
</li>
<li>
<p>允许NN尝试恢复之前失败的dfs.namenode.name.dir目录。在创建checkpoint是做此尝试。如果设置多个磁盘，建议允许</p>
</li>
<li>
<p>This is useful for restoring a remote storage directory mount that has failed because of a network outage or intermittent NFS failure.</p>
<div class="ulist">
<ul>
<li>
<p>定期备份namenode元数据</p>
</li>
</ul>
</div>
</li>
<li>
<p>制作整个存储目录的副本</p>
<div class="ulist">
<ul>
<li>
<p>为NN日志留出大量磁盘空间</p>
</li>
</ul>
</div>
</li>
<li>
<p>It is verbose – set aside multiple GBs</p>
</li>
<li>
<p>Many installs configure this too small</p>
<div class="ulist">
<ul>
<li>
<p>NN logs roll with in minutes – hard to debug issues</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Configuration – Monitoring Usage</p>
<div class="ulist">
<ul>
<li>
<p>集群存储，节点，文件，块增长</p>
<div class="ulist">
<ul>
<li>
<p>Update NN heap, handler count, number of DN xceivers</p>
</li>
<li>
<p>定期调整其他相关配置</p>
</li>
<li>
<p>监控工作负载的硬件使用情况</p>
</li>
</ul>
</div>
</li>
<li>
<p>Disk I/O, network I/O, CPU and memory usage</p>
</li>
<li>
<p>Use this information when expanding cluster capacity</p>
<div class="ulist">
<ul>
<li>
<p>Monitor the usage with HADOOP metrics</p>
</li>
</ul>
</div>
</li>
<li>
<p>JVM metrics – GC times, Memory used, Thread Status</p>
</li>
<li>
<p>RPC metrics – especially latency to track slowdowns</p>
</li>
<li>
<p>HDFS metrics</p>
<div class="ulist">
<ul>
<li>
<p>使用的存储，文件和块数，群集上的总负载</p>
</li>
<li>
<p>文件系统操作</p>
</li>
</ul>
</div>
</li>
<li>
<p>MapReduce Metrics</p>
<div class="ulist">
<ul>
<li>
<p>Slot utilization(利用) and Job status</p>
</li>
<li>
<p>在升级/维护期间持续调整配置</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Improvement (改进)</p>
<div class="ulist">
<ul>
<li>
<p>datanode本地磁盘负载均衡</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://issues.apache.org/jira/browse/HDFS-9560" class="bare">https://issues.apache.org/jira/browse/HDFS-9560</a></p>
</li>
<li>
<p>该配置项取值范围是0.0-1.0，一般取0.5-1.0，如果配置太小，会导致剩余空间足够的磁盘实际上没分配足够的数据副本，而剩余空间不足的磁盘取需要存储更多的数据副本，导致磁盘数据存储不均衡。单个磁盘io有压力.</p>
</li>
</ul>
</div>
</li>
<li>
<p>当namenode启动时，暂停删除块</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://issues.apache.org/jira/browse/HDFS-6186" class="bare">https://issues.apache.org/jira/browse/HDFS-6186</a>    Fix Version/s: 2.5.0</p>
</li>
<li>
<p>TODO 看下源码具体理解该参数的意思</p>
</li>
<li>
<p>在NameNode启动后支持块删除的可配置延迟(dfs.namenode.startup.delay.block.deletion.sec) 可配置1小时,给管理员提供足够的时间处理</p>
</li>
<li>
<p>在删除开始前给予管理员额外的时间诊断</p>
</li>
</ul>
</div>
</li>
<li>
<p>当在WebUI中启动NameNode后，将显示块删除</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://issues.apache.org/jira/browse/HDFS-6385" class="bare">https://issues.apache.org/jira/browse/HDFS-6385</a>     Fix Version/s:2.6.0</p>
</li>
<li>
<p>The web UI already displayed the number of pending block deletions</p>
</li>
<li>
<p>This enhanced the display to indicate when actual deletion will begin</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>意外删除的保护</p>
<div class="ulist">
<ul>
<li>
<p>rm –r</p>
<div class="ulist">
<ul>
<li>
<p>ctrl-c的命令不会停止删除！</p>
</li>
<li>
<p>立即关闭NN，卸载数据节点上的磁盘</p>
</li>
<li>
<p>恢复已删除的文件</p>
</li>
<li>
<p>在编辑中启动没有删除操作的namenode</p>
<div class="ulist">
<ul>
<li>
<p>启用回收站</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Improvement 改进</p>
<div class="ulist">
<ul>
<li>
<p>HDFS快照(为重要数据创建快照http://blog.csdn.net/skywalker_only/article/details/40395933)</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://issues.apache.org/jira/browse/HDFS-2802" class="bare">https://issues.apache.org/jira/browse/HDFS-2802</a></p>
</li>
<li>
<p>快照是文件系统的一部分的只读时间点映像</p>
</li>
<li>
<p>在删除之前创建的快照可用于恢复已删除的数据</p>
</li>
</ul>
</div>
</li>
<li>
<p>HDFS ACLs (linux文件系统权限)</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://issues.apache.org/jira/browse/HDFS-4685" class="bare">https://issues.apache.org/jira/browse/HDFS-4685</a></p>
</li>
<li>
<p>文件权限的细粒度控制可以帮助防止意外删除</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Unexpected error during HA HDFS upgrade (HA HDFS升级期间的意外错误)</p>
<div class="ulist">
<ul>
<li>
<p>Background: HDFS HA Architecture</p>
<div class="ulist">
<ul>
<li>
<p><a href="http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-hdfs/HDFSHighAvailabilityWithQJM.html" class="bare">http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-hdfs/HDFSHighAvailabilityWithQJM.html</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>During upgrade, NameNode calls every JournalNode to request backup of metadata directory, which renames “current” directory to “previous.tmp”.</p>
<div class="ulist">
<ul>
<li>
<p>Permissions incorrect on metadata directory for 1 out of 3 JournalNodes.</p>
</li>
<li>
<p>The hdfs user is not authorized to rename. Backup fails for that JournalNode, so upgrade process aborts with error. Root cause not easily identifiable, long time to recover</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Improvement 改进</p>
<div class="ulist">
<ul>
<li>
<p>Improve diagnostics on storage directory rename operations by using native code.</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://issues.apache.org/jira/browse/HDFS-7118" class="bare">https://issues.apache.org/jira/browse/HDFS-7118</a></p>
</li>
<li>
<p>Logs additional root cause information for rename failure. For example, EACCES</p>
</li>
</ul>
</div>
</li>
<li>
<p>Split error checks in into separate conditions to improve diagnostics.</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://issues.apache.org/jira/browse/HDFS-7119" class="bare">https://issues.apache.org/jira/browse/HDFS-7119</a></p>
</li>
<li>
<p>Splits a log message about failure to delete or rename into separate log messages to clarify which specific action failed</p>
</li>
</ul>
</div>
</li>
<li>
<p>When aborting NameNode or JournalNode, write the contents of the metadata directories and permissions to logs.</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://issues.apache.org/jira/browse/HDFS-7120" class="bare">https://issues.apache.org/jira/browse/HDFS-7120</a></p>
</li>
<li>
<p>Usually the first information asked of the user, so we can automate this</p>
</li>
<li>
<p>For JournalNode operations that must succeed on all nodes, execute a pre-check to verify that the operation can succeed.</p>
</li>
<li>
<p><a href="https://issues.apache.org/jira/browse/HDFS-7121" class="bare">https://issues.apache.org/jira/browse/HDFS-7121</a></p>
</li>
<li>
<p>Prevents need for manual cleanup on 2 out of 3 JournalNodes where backup succeeded</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>HDFS ACLs</p>
<div class="ulist">
<ul>
<li>
<p>Existing HDFS POSIX permissions good, but not flexible enough</p>
<div class="ulist">
<ul>
<li>
<p>Permission requirements may differ from the natural organizational hierarchy of users and groups.</p>
</li>
</ul>
</div>
</li>
<li>
<p>HDFS ACLs augment the existing HDFS POSIX permissions model by implementing the POSIX ACL model.</p>
<div class="ulist">
<ul>
<li>
<p>An ACL (Access Control List) provides a way to set different permissions for specific named users or named groups, not only the file’s owner and file’s group.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>HDFS ACLs New Tools for ACL Management (setfacl, getfacl) (dfs.namenode.acls.enabled 设置为true)</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">hdfs dfs -setfacl -m group:execs:r-- /sales-data
hdfs dfs -getfacl /sales-data # file: /sales-data
    #owner: maya #group: sales user::rw- group::r-- group:execs:r-- mask::r-- other::--
# How do you know if a directory has ACLs set?
hdfs dfs -ls /sales-data
Found 1 items -rw-r-----+ 3 maya sales 0 2014-03-04 16:31 /sales-data</code></pre>
</div>
</div>
</li>
<li>
<p>HDFS Snapshots</p>
<div class="ulist">
<ul>
<li>
<p>HDFS快照</p>
<div class="ulist">
<ul>
<li>
<p>快照是文件系统的一部分的只读时间点映像</p>
</li>
<li>
<p>性能：快照创建是瞬时的，不管数据大小或子树深度</p>
</li>
<li>
<p>可靠性：快照创建是原子的</p>
</li>
<li>
<p>可扩展性：快照不会创建数据块的额外副本</p>
</li>
<li>
<p>用于防止意外删除数据</p>
<div class="ulist">
<ul>
<li>
<p>Example: Daily Feeds  <code>hdfs dfs -ls /daily-feeds</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>HDFS Snapshots</p>
<div class="ulist">
<ul>
<li>
<p>Create a snapshot after each daily load 在每次日常加载后创建快照</p>
<div class="ulist">
<ul>
<li>
<p>hdfs dfsadmin -allowSnapshot /daily-feeds</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-test hljs" data-lang="test">Allowing snaphot on /daily-feeds succeeded</code></pre>
</div>
</div>
</li>
<li>
<p>hdfs dfs -createSnapshot /daily-feeds snapshot-to-2014-10-17</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-test hljs" data-lang="test">Created snapshot /daily-feeds/.snapshot/snapshot-to-2014-10-17</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>User accidentally deletes data for 2014-10-16</p>
<div class="ulist">
<ul>
<li>
<p>hdfs dfs -ls /daily-feeds</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-test hljs" data-lang="test">Found 4 items
    drwxr-xr-x - chris supergroup 0 2014-10-13 14:36 /daily-feeds/2014-10-13
    drwxr-xr-x - chris supergroup 0 2014-10-13 14:36 /daily-feeds/2014-10-14
    drwxr-xr-x - chris supergroup 0 2014-10-13 14:37 /daily-feeds/2014-10-15
    drwxr-xr-x - chris supergroup 0 2014-10-13 14:37 /daily-feeds/2014-10-17</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>HDFS Snapshots</p>
<div class="ulist">
<ul>
<li>
<p>Snapshots to the rescue: the data is still in the snapshot (快照到救援：数据仍在快照中)</p>
<div class="ulist">
<ul>
<li>
<p>hdfs dfs -ls /daily-feeds/.snapshot/snapshot-to-2014-10-17</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-test hljs" data-lang="test">Found 5 items
      drwxr-xr-x - chris supergroup 0 2014-10-13 14:36 /daily- feeds/.snapshot/snapshot-to-2014-10-17/2014-10-13
      drwxr-xr-x - chris supergroup 0 2014-10-13 14:36 /daily- feeds/.snapshot/snapshot-to-2014-10-17/2014-10-14
      drwxr-xr-x - chris supergroup 0 2014-10-13 14:37 /daily- feeds/.snapshot/snapshot-to-2014-10-17/2014-10-15
      drwxr-xr-x - chris supergroup 0 2014-10-13 14:37 /daily- feeds/.snapshot/snapshot-to-2014-10-17/2014-10-16
      drwxr-xr-x - chris supergroup 0 2014-10-13 14:37 /daily- feeds/.snapshot/snapshot-to-2014-10-17/2014-10-17</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Restore data from 2014-10-16
<code>hdfs dfs -cp /daily-feeds/.snapshot/snapshot-to-2014-10-17/2014-10-16 /daily-feeds</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Reporting DataNode Volume Failures</p>
<div class="ulist">
<ul>
<li>
<p>配置dfs.datanode.failed.volumes.tolerated&gt; 0可使DataNode在卷故障后继续运行</p>
</li>
<li>
<p>DataNode仍在运行，但容量下降</p>
</li>
<li>
<p>HDFS已经为每个DataNode提供了失败卷的计数，但没有提供更多详细信息</p>
</li>
<li>
<p>Apache Hadoop 2.7.0提供了更多信息：失败的路径，估计的丢失容量和失败日期/时间</p>
</li>
<li>
<p>管理员可以使用此信息来确定集群维护工作的优先级</p>
</li>
</ul>
</div>
</li>
<li>
<p>Reporting DataNode Volume Failures</p>
<div class="ulist">
<ul>
<li>
<p>Everything in the web UI is sourced from standardized Hadoop metrics</p>
<div class="ulist">
<ul>
<li>
<p>Each DataNode publishes its own metrics</p>
</li>
<li>
<p>NameNode publishes aggregate information from every DataNode</p>
</li>
</ul>
</div>
</li>
<li>
<p>Metrics accessible through JMX or the HTTP /jmx URI</p>
</li>
<li>
<p>Integrated in Ambari</p>
</li>
<li>
<p>Can be integrated into your preferred management tools and ops dashboards</p>
</li>
</ul>
</div>
</li>
<li>
<p>Summary</p>
<div class="ulist">
<ul>
<li>
<p>配置</p>
<div class="ulist">
<ul>
<li>
<p>防止垃圾回收问题</p>
</li>
<li>
<p>配置冗余</p>
</li>
<li>
<p>响应指标的重新调整配置</p>
</li>
</ul>
</div>
</li>
<li>
<p>HDFS ACL</p>
<div class="ulist">
<ul>
<li>
<p>对文件实施细粒度的授权规则</p>
</li>
<li>
<p>可以防止意外的文件操作</p>
</li>
</ul>
</div>
</li>
<li>
<p>HDFS快照</p>
<div class="ulist">
<ul>
<li>
<p>部分文件系统的时间点映像</p>
</li>
<li>
<p>用于在意外的文件操作后恢复到先前的状态</p>
</li>
</ul>
</div>
</li>
<li>
<p>报告DataNode卷故障</p>
<div class="ulist">
<ul>
<li>
<p>在DataNode上显示有关卷故障的信息的度量标准和Web UI</p>
</li>
<li>
<p>用于规划集群维护工作</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</article>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
