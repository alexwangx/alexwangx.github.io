<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title> BlockManager&#8201;&#8212;&#8201;Key-Value Store of Blocks of Data :: Spark 2.4.4 架构原理</title>
    <link rel="canonical" href="http://alexwangx.github.io/apache-spark-internals/2.4.4/apache-spark-internals/2.4.4/spark-BlockManager.html">
    <meta name="generator" content="Antora 2.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-86782445-1"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','UA-86782445-1')</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="http://alexwangx.github.io/apache-spark-internals/2.4.4">Spark 2.4.4 架构原理</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="apache-spark-internals" data-version="2.4.4">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Apache Spark</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="spark-overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Block Storage System</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-BlockDataManager.html">BlockDataManager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-BlockId.html">BlockId</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-ManagedBuffer.html">ManagedBuffer</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-BlockManager.html">BlockManager</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-MemoryStore.html">MemoryStore</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-BlockEvictionHandler.html">BlockEvictionHandler</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-StorageMemoryPool.html">StorageMemoryPool</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-MemoryPool.html">MemoryPool</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-DiskStore.html">DiskStore</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-RpcHandler.html">RpcHandler</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-RpcResponseCallback.html">RpcResponseCallback</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-TransportRequestHandler.html">TransportRequestHandler</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-TransportContext.html">TransportContext</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-TransportServer.html">TransportServer</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-TransportClientFactory.html">TransportClientFactory</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-MessageHandler.html">MessageHandler</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-BlockManagerMaster.html">BlockManagerMaster</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-blockmanager-BlockManagerMasterEndpoint.html">BlockManagerMasterEndpoint</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-DiskBlockManager.html">DiskBlockManager</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-BlockInfoManager.html">BlockInfoManager</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-BlockInfo.html">BlockInfo</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-blockmanager-BlockManagerSlaveEndpoint.html">BlockManagerSlaveEndpoint</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-blockmanager-DiskBlockObjectWriter.html">DiskBlockObjectWriter</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-BlockManager-BlockManagerSource.html">BlockManagerSource</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-BlockManager-ShuffleMetricsSource.html">ShuffleMetricsSource</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-blockmanager-StorageStatus.html">StorageStatus</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Transferring Data Blocks (between Nodes in Spark Application)</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-ShuffleClient.html">ShuffleClient</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-BlockTransferService.html">BlockTransferService</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-ShuffleClient-ExternalShuffleClient.html">ExternalShuffleClient</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-NettyBlockTransferService.html">NettyBlockTransferService</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-NettyBlockRpcServer.html">NettyBlockRpcServer</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-BlockFetchingListener.html">BlockFetchingListener</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-RetryingBlockFetcher.html">RetryingBlockFetcher</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-RetryingBlockFetcher-BlockFetchStarter.html">BlockFetchStarter</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Shuffle System</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-shuffle-ShuffleManager.html">ShuffleManager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-shuffle-ShuffleBlockResolver.html">ShuffleBlockResolver</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-shuffle-SortShuffleManager.html">SortShuffleManager</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-shuffle-IndexShuffleBlockResolver.html">IndexShuffleBlockResolver</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-shuffle-ShuffleHandle.html">ShuffleHandle</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-shuffle-BaseShuffleHandle.html">BaseShuffleHandle</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-shuffle-BypassMergeSortShuffleHandle.html">BypassMergeSortShuffleHandle</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-shuffle-SerializedShuffleHandle.html">SerializedShuffleHandle</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-shuffle-ShuffleWriter.html">ShuffleWriter</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-shuffle-BypassMergeSortShuffleWriter.html">BypassMergeSortShuffleWriter</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-shuffle-SortShuffleWriter.html">SortShuffleWriter</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-shuffle-UnsafeShuffleWriter.html">UnsafeShuffleWriter</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-shuffle-ShuffleReader.html">ShuffleReader</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-shuffle-BlockStoreShuffleReader.html">BlockStoreShuffleReader</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-shuffle-ShuffleExternalSorter.html">ShuffleExternalSorter</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-shuffle-ShuffleInMemorySorter.html">ShuffleInMemorySorter</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-architecture.html">Spark Architecture</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-driver.html">Driver</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-Executor.html">Executor</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-Executor-TaskRunner.html">TaskRunner</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-executor-ExecutorSource.html">ExecutorSource</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-master.html">Master</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-workers.html">Workers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-SparkConf.html">SparkConf</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-properties.html">Spark Properties and spark-defaults.conf Properties File</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-deploy-mode.html">Deploy Mode</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-SparkContext.html">SparkContext</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-HeartbeatReceiver.html">HeartbeatReceiver RPC Endpoint</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-SparkContext-creating-instance-internals.html">Inside Creating SparkContext</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-sparkcontext-ConsoleProgressBar.html">ConsoleProgressBar</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-sparkcontext-SparkStatusTracker.html">SparkStatusTracker</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-sparkcontext-local-properties.html">Local Properties</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="spark-execution-model.html">Execution Model</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="spark-configuration-properties.html">Configuration Properties</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="spark-anatomy-spark-application.html">Anatomy of Spark Application</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-rdd.html">RDD</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-rdd-RDD.html">RDD API</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-rdd-operations.html">Operators</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-rdd-transformations.html">Transformations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-rdd-PairRDDFunctions.html">PairRDDFunctions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-rdd-actions.html">Actions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-rdd-lineage.html">RDD Lineage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-rdd-caching.html">Caching and Persistence</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-rdd-StorageLevel.html">StorageLevel</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-rdd-checkpointing.html">Checkpointing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-rdd-CheckpointRDD.html">CheckpointRDD</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-rdd-partitions.html">Partitions and Partitioning</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-rdd-Partition.html">Partition</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-rdd-Partitioner.html">Partitioner</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-rdd-HashPartitioner.html">HashPartitioner</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-rdd-shuffle.html">Shuffling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-rdd-Dependency.html">RDD Dependencies</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-rdd-NarrowDependency.html">NarrowDependency</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-rdd-ShuffleDependency.html">ShuffleDependency</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-Aggregator.html">Map/Reduce-side Aggregator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Specialized RDDs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-rdd-ParallelCollectionRDD.html">ParallelCollectionRDD</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-rdd-MapPartitionsRDD.html">MapPartitionsRDD</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-rdd-OrderedRDDFunctions.html">OrderedRDDFunctions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-rdd-CoGroupedRDD.html">CoGroupedRDD</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-rdd-SubtractedRDD.html">SubtractedRDD</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-rdd-HadoopRDD.html">HadoopRDD</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-rdd-NewHadoopRDD.html">NewHadoopRDD</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-rdd-ShuffledRDD.html">ShuffledRDD</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-TaskLocation.html">TaskLocation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-internal-io-SparkHadoopWriter.html">SparkHadoopWriter</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-internal-io-FileCommitProtocol.html">FileCommitProtocol</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-internal-io-HadoopMapReduceCommitProtocol.html">HadoopMapReduceCommitProtocol</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-internal-io-HadoopMapRedCommitProtocol.html">HadoopMapRedCommitProtocol</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-internal-io-HadoopWriteConfigUtil.html">HadoopWriteConfigUtil</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-internal-io-HadoopMapReduceWriteConfigUtil.html">HadoopMapReduceWriteConfigUtil</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-internal-io-HadoopMapRedWriteConfigUtil.html">HadoopMapRedWriteConfigUtil</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-core-AppStatusStore.html">AppStatusStore</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-core-AppStatusPlugin.html">AppStatusPlugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-core-KVStore.html">KVStore</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-core-KVStoreView.html">KVStoreView</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-core-ElementTrackingStore.html">ElementTrackingStore</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-core-InMemoryStore.html">InMemoryStore</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-core-LevelDB.html">LevelDB</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-InterruptibleIterator.html">InterruptibleIterator</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-barrier-execution-mode.html">Barrier Execution Mode</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-RDDBarrier.html">RDDBarrier</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Shared Variables</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-broadcast.html">Broadcast variables</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-accumulators.html">Accumulators</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-AccumulatorContext.html">AccumulatorContext</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Tools</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-shell.html">Spark Shell (spark-shell)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-submit.html">Spark Submit (spark-submit)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-submit-SparkSubmitArguments.html">SparkSubmitArguments</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-submit-SparkSubmitOptionParser.html">SparkSubmitOptionParser</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-submit-SparkSubmitCommandBuilder.html">SparkSubmitCommandBuilder</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-class.html">spark-class shell script</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-AbstractCommandBuilder.html">AbstractCommandBuilder</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-SparkLauncher.html">SparkLauncher</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Core Services</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Low-Level Spark Task Scheduler</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-scheduler-ActiveJob.html">Jobs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-scheduler-SchedulableBuilder.html">SchedulableBuilder</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-scheduler-FIFOSchedulableBuilder.html">FIFOSchedulableBuilder</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-scheduler-FairSchedulableBuilder.html">FairSchedulableBuilder</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-scheduler-TaskScheduler.html">TaskScheduler</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-scheduler-TaskSchedulerImpl.html">TaskSchedulerImpl</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-scheduler-Task.html">Task</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-scheduler-ShuffleMapTask.html">ShuffleMapTask</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-scheduler-ResultTask.html">ResultTask</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-scheduler-TaskSet.html">TaskSet</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-scheduler-TaskSetManager.html">TaskSetManager</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-scheduler-Schedulable.html">Schedulable Entities</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-scheduler-Pool.html">Schedulable Pool</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-scheduler-SchedulingMode.html">Scheduling Mode</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-scheduler-TaskInfo.html">TaskInfo</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-TaskRunner-FetchFailedException.html">FetchFailedException</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-scheduler-MapStatus.html">MapStatus</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-scheduler-TaskDescription.html">TaskDescription</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-taskschedulerimpl-speculative-execution.html">Speculative Execution of Tasks</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-scheduler-TaskResultGetter.html">TaskResultGetter</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-TaskContext.html">TaskContext</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-BarrierTaskContext.html">BarrierTaskContext</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-TaskContextImpl.html">TaskContextImpl</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-scheduler-TaskResult.html">TaskResults</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-scheduler-TaskSetBlacklist.html">TaskSetBlacklist</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">High-Level Spark Stage Scheduler</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-scheduler-DAGScheduler.html">DAGScheduler</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-scheduler-Stage.html">Stage</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-scheduler-ShuffleMapStage.html">ShuffleMapStage</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-scheduler-ResultStage.html">ResultStage</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-scheduler-StageInfo.html">StageInfo</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-scheduler-DAGSchedulerEventProcessLoop.html">DAGScheduler Event Bus</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-scheduler-JobListener.html">JobListener</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-scheduler-JobWaiter.html">JobWaiter</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-memory-unified-memory-management.html">Unified Memory Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-memory-TaskMemoryManager.html">TaskMemoryManager</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-memory-MemoryConsumer.html">MemoryConsumer</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-MemoryManager.html">MemoryManager</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-UnifiedMemoryManager.html">UnifiedMemoryManager</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-StaticMemoryManager.html">StaticMemoryManager</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-MemoryManager-properties.html">MemoryManager Configuration Properties</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-SerializerManager.html">SerializerManager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-SparkEnv.html">SparkEnv</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-SchedulerBackend.html">SchedulerBackend</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-CoarseGrainedSchedulerBackend.html">CoarseGrainedSchedulerBackend</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-CoarseGrainedSchedulerBackend-DriverEndpoint.html">DriverEndpoint</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-ExecutorBackend.html">ExecutorBackend</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-CoarseGrainedExecutorBackend.html">CoarseGrainedExecutorBackend</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-ExternalShuffleService.html">ExternalShuffleService</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-OneForOneStreamManager.html">OneForOneStreamManager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-ShuffleBlockFetcherIterator.html">ShuffleBlockFetcherIterator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-ExternalSorter.html">ExternalSorter</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-service-mapoutputtracker.html">MapOutputTracker</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-service-MapOutputTrackerMaster.html">MapOutputTrackerMaster</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-service-MapOutputTrackerMasterEndpoint.html">MapOutputTrackerMasterEndpoint</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-service-MapOutputTrackerWorker.html">MapOutputTrackerWorker</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-serialization.html">Serialization</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-Serializer.html">Serializer</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-SerializerInstance.html">SerializerInstance</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-SerializationStream.html">SerializationStream</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-DeserializationStream.html">DeserializationStream</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-ExternalClusterManager.html">ExternalClusterManager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-service-broadcastmanager.html">BroadcastManager</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-BroadcastFactory.html">BroadcastFactory</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-TorrentBroadcastFactory.html">TorrentBroadcastFactory</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-TorrentBroadcast.html">TorrentBroadcast</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-CompressionCodec.html">CompressionCodec</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-service-contextcleaner.html">ContextCleaner</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-CleanerListener.html">CleanerListener</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-dynamic-allocation.html">Dynamic Allocation (of Executors)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-ExecutorAllocationManager.html">ExecutorAllocationManager</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-service-ExecutorAllocationClient.html">ExecutorAllocationClient</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-service-ExecutorAllocationManagerSource.html">ExecutorAllocationManagerSource</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-http-file-server.html">HTTP File Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-data-locality.html">Data Locality</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-cachemanager.html">Cache Manager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-service-outputcommitcoordinator.html">OutputCommitCoordinator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-rpc.html">RPC Environment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-rpc-RpcEnv.html">RpcEnv</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-rpc-RpcEndpoint.html">RpcEndpoint</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-RpcEndpointRef.html">RpcEndpointRef</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-RpcEnvFactory.html">RpcEnvFactory</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-rpc-netty.html">Netty-based RpcEnv</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-TransportConf.html">TransportConf</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-Utils.html">Utils Helper Object</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-webui-security.html">Securing Web UI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-deployment-environments.html">Deployment Environments</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-cluster.html">Spark on cluster</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-history-server.html">Spark History Server</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-history-server-HistoryServer.html">HistoryServer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-history-server-SQLHistoryListener.html">SQLHistoryListener</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-history-server-FsHistoryProvider.html">FsHistoryProvider</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-history-server-ApplicationHistoryProvider.html">ApplicationHistoryProvider</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-history-server-HistoryServerArguments.html">HistoryServerArguments</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-history-server-ApplicationCacheOperations.html">ApplicationCacheOperations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-history-server-ApplicationCache.html">ApplicationCache</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Monitoring, Tuning, Debugging and Testing</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-logging.html">Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-tuning.html">Performance Tuning</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-scheduler-SparkListener.html">SparkListener</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-SparkListener-AppStatusListener.html">AppStatusListener</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-SparkListener-EventLoggingListener.html">EventLoggingListener</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-SparkListener-ExecutorAllocationListener.html">ExecutorAllocationListener</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-SparkListener-SpillListener.html">SpillListener</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-SparkListener-StatsReportListener.html">StatsReportListener</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-scheduler-LiveListenerBus.html">LiveListenerBus</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-SparkListenerBus.html">SparkListenerBus</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-SparkListenerBus-AsyncEventQueue.html">AsyncEventQueue</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-SparkListenerBus-ReplayListenerBus.html">ReplayListenerBus</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-JsonProtocol.html">JsonProtocol</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-debugging.html">Debugging Spark</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Varia</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="varia/spark-building-from-sources.html">Building Apache Spark from Sources</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="varia/spark-hadoop.html">Spark and Hadoop</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-SparkHadoopUtil.html">SparkHadoopUtil</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="varia/spark-inmemory-filesystems.html">Spark and software in-memory file systems</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="varia/spark-others.html">Spark and The Others</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="varia/spark-deeplearning.html">Distributed Deep Learning on Spark</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="varia/spark-packages.html">Spark Packages</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-tips-and-tricks.html">Spark Tips and Tricks</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-tips-and-tricks-access-private-members-spark-shell.html">Access private members in Scala in Spark shell</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-tips-and-tricks-sparkexception-task-not-serializable.html">SparkException: Task not serializable</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-tips-and-tricks-running-spark-windows.html">Running Spark Applications on Windows</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Further Learning</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-courses.html">Courses</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-books.html">Books</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="spark-sql.html">Spark SQL</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="spark-structured-streaming.html">Spark Structured Streaming</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="webui/index.html">Web UI</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="webui/spark-webui-jobs.html">Jobs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="webui/spark-webui-stages.html">Stages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="webui/spark-webui-storage.html">Storage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="webui/spark-webui-environment.html">Environment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="webui/spark-webui-executors.html">Executors</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="webui/spark-webui-JobsTab.html">JobsTab</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="webui/spark-webui-AllJobsPage.html">AllJobsPage</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="webui/spark-webui-JobPage.html">JobPage</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="webui/spark-webui-StagesTab.html">StagesTab&#8201;&#8212;&#8201;Stages for All Jobs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="webui/spark-webui-AllStagesPage.html">AllStagesPage&#8201;&#8212;&#8201;Stages for All Jobs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="webui/spark-webui-StagePage.html">StagePage&#8201;&#8212;&#8201;Stage Details</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="webui/spark-webui-PoolPage.html">PoolPage&#8201;&#8212;&#8201;Pool Details</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="webui/spark-webui-StorageTab.html">StorageTab</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="webui/spark-webui-StoragePage.html">StoragePage</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="webui/spark-webui-RDDPage.html">RDDPage</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="webui/spark-webui-EnvironmentTab.html">EnvironmentTab</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="webui/spark-webui-EnvironmentPage.html">EnvironmentPage</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="webui/spark-webui-ExecutorsTab.html">ExecutorsTab</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="webui/spark-webui-ExecutorsPage.html">ExecutorsPage</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="webui/spark-webui-ExecutorThreadDumpPage.html">ExecutorThreadDumpPage</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="webui/spark-webui-SparkUI.html">SparkUI&#8201;&#8212;&#8201;Web UI of Spark Application</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="webui/spark-webui-SparkUITab.html">SparkUITab</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="webui/spark-webui-BlockStatusListener.html">BlockStatusListener Spark Listener</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="webui/spark-webui-EnvironmentListener.html">EnvironmentListener Spark Listener</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="webui/spark-webui-executors-ExecutorsListener.html">ExecutorsListener Spark Listener</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="webui/spark-webui-JobProgressListener.html">JobProgressListener Spark Listener</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="webui/spark-webui-StorageStatusListener.html">StorageStatusListener Spark Listener</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="webui/spark-webui-StorageListener.html">StorageListener&#8201;&#8212;&#8201;Spark Listener for Tracking Persistence Status of RDD Blocks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="webui/spark-webui-RDDOperationGraphListener.html">RDDOperationGraphListener Spark Listener</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="webui/spark-webui-WebUI.html">WebUI&#8201;&#8212;&#8201;Framework For Web UIs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="webui/spark-webui-WebUIPage.html">WebUIPage&#8201;&#8212;&#8201;Contract of Pages in Web UI</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="webui/spark-webui-WebUITab.html">WebUITab&#8201;&#8212;&#8201;Contract of Tabs in Web UI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="webui/spark-webui-RDDStorageInfo.html">RDDStorageInfo</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="webui/spark-core-RDDInfo.html">RDDInfo</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="webui/spark-core-LiveEntity.html">LiveEntity</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="webui/spark-core-LiveRDD.html">LiveRDD</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="webui/spark-webui-UIUtils.html">UIUtils</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="webui/spark-webui-JettyUtils.html">JettyUtils</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="webui/spark-webui-properties.html">web UI Configuration Properties</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="metrics/index.html">Spark Metrics</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="metrics/spark-metrics-MetricsSystem.html">MetricsSystem</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="metrics/spark-metrics-MetricsConfig.html">MetricsConfig</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="metrics/spark-metrics-Source.html">Source</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="metrics/spark-scheduler-DAGSchedulerSource.html">DAGSchedulerSourcer</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="metrics/spark-metrics-Sink.html">Sink</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="metrics/spark-metrics-MetricsServlet.html">MetricsServlet JSON Metrics Sink</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="metrics/spark-metrics-properties.html">Metrics Configuration Properties</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="metrics/spark-executor-TaskMetrics.html">TaskMetrics</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="metrics/spark-executor-ShuffleWriteMetrics.html">ShuffleWriteMetrics</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-mllib/index.html">Spark MLlib</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-mllib/spark-mllib-pipelines.html">ML Pipelines (spark.ml)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-mllib/spark-mllib-Pipeline.html">Pipeline</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-mllib/spark-mllib-PipelineStage.html">PipelineStage</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-mllib/spark-mllib-transformers.html">Transformers</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-mllib/spark-mllib-Transformer.html">Transformer</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-mllib/spark-mllib-transformers-Tokenizer.html">Tokenizer</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-mllib/spark-mllib-estimators.html">Estimators</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-mllib/spark-mllib-Estimator.html">Estimator</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="spark-mllib/spark-mllib-StringIndexer.html">StringIndexer</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="spark-mllib/spark-mllib-KMeans.html">KMeans</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="spark-mllib/spark-mllib-TrainValidationSplit.html">TrainValidationSplit</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-mllib/spark-mllib-Predictor.html">Predictor</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="spark-mllib/spark-mllib-RandomForestRegressor.html">RandomForestRegressor</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-mllib/spark-mllib-Regressor.html">Regressor</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="spark-mllib/spark-mllib-LinearRegression.html">LinearRegression</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-mllib/spark-mllib-Classifier.html">Classifier</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="spark-mllib/spark-mllib-RandomForestClassifier.html">RandomForestClassifier</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="spark-mllib/spark-mllib-DecisionTreeClassifier.html">DecisionTreeClassifier</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-mllib/spark-mllib-models.html">Models</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-mllib/spark-mllib-Model.html">Model</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-mllib/spark-mllib-Evaluator.html">Evaluator&#8201;&#8212;&#8201;ML Pipeline Component for Model Scoring</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-mllib/spark-mllib-BinaryClassificationEvaluator.html">BinaryClassificationEvaluator&#8201;&#8212;&#8201;Evaluator of Binary Classification Models</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-mllib/spark-mllib-ClusteringEvaluator.html">ClusteringEvaluator&#8201;&#8212;&#8201;Evaluator of Clustering Models</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-mllib/spark-mllib-MulticlassClassificationEvaluator.html">MulticlassClassificationEvaluator&#8201;&#8212;&#8201;Evaluator of Multiclass Classification Models</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-mllib/spark-mllib-RegressionEvaluator.html">RegressionEvaluator&#8201;&#8212;&#8201;Evaluator of Regression Models</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-mllib/spark-mllib-CrossValidator.html">CrossValidator&#8201;&#8212;&#8201;Model Tuning / Finding The Best Model</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-mllib/spark-mllib-CrossValidatorModel.html">CrossValidatorModel</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-mllib/spark-mllib-ParamGridBuilder.html">ParamGridBuilder</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-mllib/spark-mllib-CrossValidator-example.html">CrossValidator with Pipeline Example</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-mllib/spark-mllib-Params.html">Params and ParamMaps</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-mllib/spark-mllib-ValidatorParams.html">ValidatorParams</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="spark-mllib/spark-mllib-HasParallelism.html">HasParallelism</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-mllib/spark-mllib-pipelines-persistence.html">ML Persistence&#8201;&#8212;&#8201;Saving and Loading Models and Pipelines</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-mllib/spark-mllib-MLWritable.html">MLWritable</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-mllib/spark-mllib-MLReader.html">MLReader</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-mllib/spark-mllib-pipelines-example-classification.html">Example&#8201;&#8212;&#8201;Text Classification</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-mllib/spark-mllib-pipelines-example-regression.html">Example&#8201;&#8212;&#8201;Linear Regression</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-mllib/spark-mllib-logistic-regression.html">Logistic Regression</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-mllib/spark-mllib-LogisticRegression.html">LogisticRegression</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-mllib/spark-mllib-latent-dirichlet-allocation.html">Latent Dirichlet Allocation (LDA)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-mllib/spark-mllib-vector.html">Vector</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-mllib/spark-mllib-labeledpoint.html">LabeledPoint</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-mllib/spark-mllib-streaming.html">Streaming MLlib</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-mllib/spark-mllib-GeneralizedLinearRegression.html">GeneralizedLinearRegression</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-mllib/spark-mllib-alternating-least-squares.html">Alternating Least Squares (ALS) Matrix Factorization</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-mllib/spark-mllib-ALS.html">ALS&#8201;&#8212;&#8201;Estimator for ALSModel</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-mllib/spark-mllib-ALSModel.html">ALSModel&#8201;&#8212;&#8201;Model for Predictions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-mllib/spark-mllib-ALSModelReader.html">ALSModelReader</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-mllib/spark-mllib-Instrumentation.html">Instrumentation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-mllib/spark-mllib-MLUtils.html">MLUtils</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-local/index.html">Spark local</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-local/spark-LocalSchedulerBackend.html">LocalSchedulerBackend</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-local/spark-LocalEndpoint.html">LocalEndpoint&#8201;&#8212;&#8201;RPC Endpoint for LocalSchedulerBackend</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-local/spark-LauncherBackend.html">LauncherBackend</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-on-yarn/index.html">Spark on YARN</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-on-yarn/spark-yarn-YarnShuffleService.html">YarnShuffleService&#8201;&#8212;&#8201;ExternalShuffleService on YARN</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-on-yarn/spark-yarn-ExecutorRunnable.html">ExecutorRunnable</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-on-yarn/spark-yarn-client.html">Client</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-on-yarn/spark-yarn-yarnrmclient.html">YarnRMClient</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-on-yarn/spark-yarn-applicationmaster.html">ApplicationMaster</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-on-yarn/spark-yarn-AMEndpoint.html">AMEndpoint&#8201;&#8212;&#8201;ApplicationMaster RPC Endpoint</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-on-yarn/spark-yarn-YarnClusterManager.html">YarnClusterManager&#8201;&#8212;&#8201;ExternalClusterManager for YARN</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-on-yarn/spark-yarn-taskschedulers.html">TaskSchedulers for YARN</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-on-yarn/spark-yarn-yarnscheduler.html">YarnScheduler</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-on-yarn/spark-yarn-yarnclusterscheduler.html">YarnClusterScheduler</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-on-yarn/spark-yarn-schedulerbackends.html">SchedulerBackends for YARN</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-on-yarn/spark-yarn-yarnschedulerbackend.html">YarnSchedulerBackend</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-on-yarn/spark-yarn-client-yarnclientschedulerbackend.html">YarnClientSchedulerBackend</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-on-yarn/spark-yarn-cluster-yarnclusterschedulerbackend.html">YarnClusterSchedulerBackend</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-on-yarn/spark-yarn-cluster-YarnSchedulerEndpoint.html">YarnSchedulerEndpoint RPC Endpoint</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-on-yarn/spark-yarn-YarnAllocator.html">YarnAllocator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-on-yarn/spark-yarn-introduction.html">Introduction to Hadoop YARN</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-on-yarn/spark-yarn-cluster-setup.html">Setting up YARN Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-on-yarn/spark-yarn-kerberos.html">Kerberos</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-on-yarn/spark-yarn-ConfigurableCredentialManager.html">ConfigurableCredentialManager</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-on-yarn/spark-yarn-ClientDistributedCacheManager.html">ClientDistributedCacheManager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-on-yarn/spark-yarn-YarnSparkHadoopUtil.html">YarnSparkHadoopUtil</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-on-yarn/spark-yarn-settings.html">Settings</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-standalone/index.html">Spark Standalone</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-standalone/spark-standalone-Master.html">Standalone Master&#8201;&#8212;&#8201;Cluster Manager of Spark Standalone</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-standalone/spark-standalone-worker.html">Standalone Worker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-standalone/spark-standalone-webui.html">web UI</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-standalone/spark-standalone-webui-ApplicationPage.html">ApplicationPage</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-standalone/spark-standalone-LocalSparkCluster.html">LocalSparkCluster&#8201;&#8212;&#8201;Single-JVM Spark Standalone Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-standalone/spark-standalone-submission-gateways.html">Submission Gateways</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-standalone/spark-standalone-master-scripts.html">Management Scripts for Standalone Master</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-standalone/spark-standalone-worker-scripts.html">Management Scripts for Standalone Workers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-standalone/spark-standalone-status.html">Checking Status</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-standalone/spark-standalone-example-2-workers-on-1-node-cluster.html">Example 2-workers-on-1-node Standalone Cluster (one executor per worker)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-standalone/spark-standalone-StandaloneSchedulerBackend.html">StandaloneSchedulerBackend</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="rest-api/index.html">Status REST API</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="rest-api/spark-api-ApiRootResource.html">ApiRootResource&#8201;&#8212;&#8201;/api/v1 URI Handler</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="rest-api/spark-api-ApplicationListResource.html">ApplicationListResource&#8201;&#8212;&#8201;applications URI Handler</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="rest-api/spark-api-OneApplicationResource.html">OneApplicationResource&#8201;&#8212;&#8201;applications/appId URI Handler</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="rest-api/spark-api-StagesResource.html">StagesResource</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="rest-api/spark-api-OneApplicationAttemptResource.html">OneApplicationAttemptResource</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="rest-api/spark-api-AbstractApplicationResource.html">AbstractApplicationResource</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="rest-api/spark-api-BaseAppResource.html">BaseAppResource</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="rest-api/spark-api-ApiRequestContext.html">ApiRequestContext</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="rest-api/spark-api-UIRoot.html">UIRoot&#8201;&#8212;&#8201;Contract for Root Contrainers of Application UI Information</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="rest-api/spark-api-UIRootFromServletContext.html">UIRootFromServletContext</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-on-mesos/index.html">Spark on Mesos</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-on-mesos/spark-mesos-MesosCoarseGrainedSchedulerBackend.html">MesosCoarseGrainedSchedulerBackend</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-on-mesos/spark-mesos-introduction.html">About Mesos</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-on-mesos/spark-executor-backends-MesosExecutorBackend.html">MesosExecutorBackend</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Exercises</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="exercises/spark-exercise-pairrddfunctions-oneliners.html">One-liners using PairRDDFunctions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="exercises/spark-exercise-take-multiple-jobs.html">Learning Jobs and Partitions Using take Action</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="exercises/spark-exercise-standalone-master-ha.html">Spark Standalone - Using ZooKeeper for High-Availability of Master</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="exercises/spark-hello-world-using-spark-shell.html">Spark&#8217;s Hello World using Spark shell and Scala</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="exercises/spark-examples-wordcount-spark-shell.html">WordCount using Spark shell</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="exercises/spark-first-app.html">Your first complete Spark application (using Scala and sbt)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="exercises/spark-notable-use-cases.html">Spark (notable) use cases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="exercises/spark-sql-hive-orc-example.html">Using Spark SQL to update data in Hive using ORC files</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="exercises/spark-exercise-custom-scheduler-listener.html">Developing Custom SparkListener to monitor DAGScheduler in Scala</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="exercises/spark-exercise-custom-rpc-environment.html">Developing RPC Environment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="exercises/spark-exercise-custom-rdd.html">Developing Custom RDD</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="exercises/spark-exercise-dataframe-jdbc-postgresql.html">Working with Datasets from JDBC Data Sources (and PostgreSQL)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="exercises/spark-exercise-failing-stage.html">Causing Stage to Fail</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Apache Spark</span>
    <span class="version">2.4.4</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Apache Spark</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">2.4.4</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Apache Spark</a></li>
    <li>Block Storage System</li>
    <li><a href="spark-BlockManager.html">BlockManager</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///Users/alex/Alex/_Code/GitBook/mastering-apache-spark-book-cn/modules/ROOT/pages/spark-BlockManager.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<h1 class="page"><a id="BlockManager"></a> BlockManager&#8201;&#8212;&#8201;Key-Value Store of Blocks of Data</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><code>BlockManager</code> is a key-value store of blocks of data (<strong>block storage</strong>) identified by a block ID.</p>
</div>
<div class="paragraph">
<p><code>BlockManager</code> runs on every node in a Spark application, i.e. the <a href="spark-driver.html" class="page">driver</a> and <a href="spark-Executor.html" class="page">executors</a>.</p>
</div>
<div class="paragraph">
<p><code>BlockManager</code> is a <a href="spark-BlockDataManager.html" class="page">BlockDataManager</a> and manages the storage for blocks that with cached RDD partitions, intermediate shuffle outputs, broadcasts, etc.</p>
</div>
<div class="paragraph">
<p><code>BlockManager</code> is a local cache.</p>
</div>
<div class="paragraph">
<p><code>BlockManager</code> provides interface for uploading and fetching blocks both locally and remotely using various stores, i.e. <a href="#stores">memory, disk, and off-heap</a>.</p>
</div>
<div class="paragraph">
<p><code>BlockManager</code> is <a href="#creating-instance">created</a> exclusively when <code>SparkEnv</code> is <a href="spark-SparkEnv.html#create-BlockManager" class="page">created</a> (for the driver and executors). <code>BlockManager</code> gets a <a href="#diskBlockManager">DiskBlockManager</a>, a <a href="#blockInfoManager">BlockInfoManager</a>, a <a href="#memoryStore">MemoryStore</a> and a <a href="#diskStore">DiskStore</a> (and wires them up together).</p>
</div>
<div id="futureExecutionContext" class="paragraph">
<p><code>BlockManager</code> uses a Scala <a href="https://www.scala-lang.org/api/current/scala/concurrent/ExecutionContextExecutorService.html">ExecutionContextExecutorService</a> to execute <strong>FIXME</strong> asynchronously (on a thread pool with <strong>block-manager-future</strong> prefix and maximum of 128 threads).</p>
</div>
<div class="paragraph">
<p><code>BlockManager</code> is available as <a href="spark-SparkEnv.html#blockManager" class="page">SparkEnv.blockManager</a> regardless of the node (i.e. the driver or executors).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">// BlockManager is a private[spark] class
// so the following has to be under org.apache.spark package
// e.g. package org.apache.spark
import org.apache.spark.storage.BlockManager
val bm: BlockManager = SparkEnv.get.blockManager</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>BlockManager</code> is a <a href="spark-BlockEvictionHandler.adoc">BlockEvictionHandler</a> that can <a href="#dropFromMemory">drop a block from memory and store it on a disk</a> if required.</p>
</div>
<div class="paragraph">
<p><strong>Cached blocks</strong> are blocks with non-zero sum of memory and disk sizes.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Use <a href="spark-webui.adoc">Web UI</a>, esp. <a href="spark-webui-storage.adoc">Storage</a> and <a href="spark-webui-executors.adoc">Executors</a> tabs, to monitor the memory used.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Use <a href="spark-submit.adoc">spark-submit</a>'s command-line options, i.e. <a href="spark-submit.adoc#driver-memory">--driver-memory</a> for the driver and <a href="spark-submit.adoc#executor-memory">--executor-memory</a> for executors or their equivalents as Spark properties, i.e. <a href="spark-submit.adoc#spark.executor.memory">spark.executor.memory</a> and <a href="spark-submit.adoc#spark_driver_memory">spark.driver.memory</a>, to control the memory for storage memory.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A <a href="#creating-instance"><code>BlockManager</code> is created</a> when a <a href="spark-SparkEnv.adoc#create">Spark application starts</a> and must be <a href="#initialize">initialized</a> before it is fully operable.</p>
</div>
<div class="paragraph">
<p>When <a href="#externalShuffleServiceEnabled">External Shuffle Service is enabled</a>, <code>BlockManager</code> uses <a href="spark-ShuffleClient-ExternalShuffleClient.adoc">ExternalShuffleClient</a> to read other executors' shuffle files.</p>
</div>
<div id="metrics" class="paragraph">
<p><code>BlockManager</code> uses <a href="spark-BlockManager-BlockManagerSource.adoc">BlockManagerSource</a> to report metrics under the name <strong>BlockManager</strong>.</p>
</div>
<table id="internal-properties" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. BlockManager&#8217;s Internal Properties</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Initial Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>blockInfoManager</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FIXME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="blockInfoManager"></a> <a href="spark-BlockInfoManager.adoc">BlockInfoManager</a> for&#8230;&#8203;FIXME</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>diskStore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FIXME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="diskStore"></a> <a href="spark-DiskStore.adoc">DiskStore</a> for&#8230;&#8203;FIXME</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>diskBlockManager</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FIXME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="diskBlockManager"></a> <a href="spark-DiskBlockManager.adoc">DiskBlockManager</a> for&#8230;&#8203;FIXME</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maxMemory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total available <a href="spark-MemoryManager.adoc#maxOnHeapStorageMemory">on-heap</a> and <a href="spark-MemoryManager.adoc#maxOffHeapStorageMemory">off-heap</a> memory for storage (in bytes)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="maxMemory"></a> Total maximum value that <code>BlockManager</code> can ever possibly use (that depends on <a href="#memoryManager">MemoryManager</a> and may vary over time).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maxOffHeapMemory</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="maxOffHeapMemory"></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>maxOnHeapMemory</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="maxOnHeapMemory"></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>memoryStore</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="memoryStore"></a> <a href="spark-MemoryStore.adoc">MemoryStore</a> (with the <a href="#blockInfoManager">BlockInfoManager</a>, the <a href="#serializerManager">SerializerManager</a>, <a href="#memoryManager">MemoryManager</a> and this <code>BlockManager</code> as the <a href="spark-BlockEvictionHandler.adoc">BlockEvictionHandler</a>)</p></td>
</tr>
</tbody>
</table>
<div id="logging" class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Enable <code>INFO</code>, <code>DEBUG</code> or <code>TRACE</code> logging level for <code>org.apache.spark.storage.BlockManager</code> logger to see what happens inside.</p>
</div>
<div class="paragraph">
<p>Add the following line to <code>conf/log4j.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>log4j.logger.org.apache.spark.storage.BlockManager=TRACE</code></pre>
</div>
</div>
<div class="paragraph">
<p>Refer to <a href="spark-logging.adoc">Logging</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You may want to shut off WARN messages being printed out about the current state of blocks using the following line to cut the noise:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>log4j.logger.org.apache.spark.storage.BlockManager=OFF</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getlocations_method"><a class="anchor" href="#_getlocations_method"></a><a id="getLocations"></a> <code>getLocations</code> Method</h2>
<div class="sectionbody">
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_blockidstohosts_method"><a class="anchor" href="#_blockidstohosts_method"></a><a id="blockIdsToHosts"></a> <code>blockIdsToHosts</code> Method</h2>
<div class="sectionbody">
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getlocationblockids_method"><a class="anchor" href="#_getlocationblockids_method"></a><a id="getLocationBlockIds"></a> <code>getLocationBlockIds</code> Method</h2>
<div class="sectionbody">
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getpeers_method"><a class="anchor" href="#_getpeers_method"></a><a id="getPeers"></a> <code>getPeers</code> Method</h2>
<div class="sectionbody">
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_releasealllocksfortask_method"><a class="anchor" href="#_releasealllocksfortask_method"></a><a id="releaseAllLocksForTask"></a> <code>releaseAllLocksForTask</code> Method</h2>
<div class="sectionbody">
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_stopping_blockmanagerstop_method"><a class="anchor" href="#_stopping_blockmanagerstop_method"></a><a id="stop"></a> Stopping BlockManager&#8201;&#8212;&#8201;<code>stop</code> Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">stop(): Unit</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>stop</code>&#8230;&#8203;FIXME</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>stop</code> is used exclusively when <code>SparkEnv</code> is requested to <a href="spark-SparkEnv.adoc#stop">stop</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_ids_of_existing_blocks_for_a_given_filtergetmatchingblockids_method"><a class="anchor" href="#_getting_ids_of_existing_blocks_for_a_given_filtergetmatchingblockids_method"></a><a id="getMatchingBlockIds"></a> Getting IDs of Existing Blocks (For a Given Filter)&#8201;&#8212;&#8201;<code>getMatchingBlockIds</code> Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">getMatchingBlockIds(filter: BlockId =&gt; Boolean): Seq[BlockId]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>getMatchingBlockIds</code>&#8230;&#8203;FIXME</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>getMatchingBlockIds</code> is used exclusively when <code>BlockManagerSlaveEndpoint</code> is requested to <a href="spark-blockmanager-BlockManagerSlaveEndpoint.adoc#GetMatchingBlockIds">handle a GetMatchingBlockIds message</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getlocalvalues_method"><a class="anchor" href="#_getlocalvalues_method"></a><a id="getLocalValues"></a> <code>getLocalValues</code> Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">getLocalValues(blockId: BlockId): Option[BlockResult]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>getLocalValues</code>&#8230;&#8203;FIXME</p>
</div>
<div class="paragraph">
<p>Internally, when <code>getLocalValues</code> is executed, you should see the following DEBUG message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>DEBUG BlockManager: Getting local block [blockId]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>getLocalValues</code> <a href="spark-BlockInfoManager.adoc#lockForReading">obtains a read lock for <code>blockId</code></a>.</p>
</div>
<div class="paragraph">
<p>When no <code>blockId</code> block was found, you should see the following DEBUG message in the logs and <code>getLocalValues</code> returns "nothing" (i.e. <code>NONE</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>DEBUG Block [blockId] was not found</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the <code>blockId</code> block was found, you should see the following DEBUG message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>DEBUG Level for block [blockId] is [level]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>blockId</code> block has memory level and <a href="spark-MemoryStore.adoc#contains">is registered in <code>MemoryStore</code></a>, <code>getLocalValues</code> returns a <a href="#BlockResult">BlockResult</a> as <code>Memory</code> read method and with a <code>CompletionIterator</code> for an interator:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="spark-MemoryStore.adoc#getValues">Values iterator from <code>MemoryStore</code> for <code>blockId</code></a> for "deserialized" persistence levels.</p>
</li>
<li>
<p>Iterator from <a href="spark-SerializerManager.adoc#dataDeserializeStream"><code>SerializerManager</code> after the data stream has been deserialized</a> for the <code>blockId</code> block and <a href="spark-MemoryStore.adoc#getBytes">the bytes for <code>blockId</code> block</a> for "serialized" persistence levels.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>getLocalValues</code> is used when <a href="spark-TorrentBroadcast.adoc#readBroadcastBlock"><code>TorrentBroadcast</code> reads the blocks of a broadcast variable and stores them in a local <code>BlockManager</code></a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getremotevalues_internal_method"><a class="anchor" href="#_getremotevalues_internal_method"></a><a id="getRemoteValues"></a> <code>getRemoteValues</code> Internal Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">getRemoteValues[T: ClassTag](blockId: BlockId): Option[BlockResult]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>getRemoteValues</code>&#8230;&#8203;FIXME</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_retrieving_block_from_local_or_remote_block_managersget_method"><a class="anchor" href="#_retrieving_block_from_local_or_remote_block_managersget_method"></a><a id="get"></a> Retrieving Block from Local or Remote Block Managers&#8201;&#8212;&#8201;<code>get</code> Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">get[T: ClassTag](blockId: BlockId): Option[BlockResult]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>get</code> attempts to get the <code>blockId</code> block from a local block manager first before requesting it from remote block managers.</p>
</div>
<div class="paragraph">
<p>Internally, <code>get</code> tries to <a href="#getLocalValues">get the block from the local BlockManager</a>. If the block was found, you should see the following INFO message in the logs and <code>get</code> returns the local <a href="#BlockResult">BlockResult</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>INFO Found block [blockId] locally</code></pre>
</div>
</div>
<div class="paragraph">
<p>If however the block was not found locally, <code>get</code> tries to <a href="#getRemoteValues">get the block from remote block managers</a>. If retrieved from a remote block manager, you should see the following INFO message in the logs and <code>get</code> returns the remote <a href="#BlockResult">BlockResult</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>INFO Found block [blockId] remotely</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the end, <code>get</code> returns "nothing" (i.e. <code>NONE</code>) when the <code>blockId</code> block was not found either in the local <code>BlockManager</code> or any remote <code>BlockManager</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>get</code> is used when:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BlockManager</code> is requested to <a href="#getOrElseUpdate">getOrElseUpdate</a> and <a href="#getSingle">getSingle</a></p>
</li>
<li>
<p><code>BlockRDD</code> is requested to <a href="spark-streaming-BlockRDD.adoc#compute">compute a partition</a></p>
</li>
<li>
<p>Spark Streaming&#8217;s <code>WriteAheadLogBackedBlockRDD</code> is requested to <code>compute</code> a partition</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_retrieving_block_data_from_local_block_manager_as_serialized_bytesgetlocalbytes_method"><a class="anchor" href="#_retrieving_block_data_from_local_block_manager_as_serialized_bytesgetlocalbytes_method"></a><a id="getLocalBytes"></a> Retrieving Block Data from Local Block Manager (As Serialized Bytes)&#8201;&#8212;&#8201;<code>getLocalBytes</code> Method</h2>
<div class="sectionbody">
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_retrieving_block_datagetblockdata_method"><a class="anchor" href="#_retrieving_block_datagetblockdata_method"></a><a id="getBlockData"></a> Retrieving Block Data&#8201;&#8212;&#8201;<code>getBlockData</code> Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">getBlockData(blockId: BlockId): ManagedBuffer</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>getBlockData</code> is part of the <a href="spark-BlockDataManager.html#getBlockData" class="page">BlockDataManager Contract</a> to&#8230;&#8203;FIXME.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>getBlockData</code>&#8230;&#8203;FIXME</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>getBlockData</code> is used when&#8230;&#8203;FIXME
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_removeblockinternal_method"><a class="anchor" href="#_removeblockinternal_method"></a><a id="removeBlockInternal"></a> <code>removeBlockInternal</code> Method</h2>
<div class="sectionbody">
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_is_external_shuffle_service_enabledexternalshuffleserviceenabled_flag"><a class="anchor" href="#_is_external_shuffle_service_enabledexternalshuffleserviceenabled_flag"></a><a id="externalShuffleServiceEnabled"></a> Is External Shuffle Service Enabled?&#8201;&#8212;&#8201;<code>externalShuffleServiceEnabled</code> Flag</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When the <a href="spark-ExternalShuffleService.adoc">External Shuffle Service</a> is enabled for a Spark application, <code>BlockManager</code> uses <a href="spark-ShuffleClient-ExternalShuffleClient.adoc">ExternalShuffleClient</a> to read other executors' shuffle files.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME How is <code>shuffleClient</code> used?
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_stores"><a class="anchor" href="#_stores"></a><a id="stores"></a> Stores</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <strong>Store</strong> is the place where blocks are held.</p>
</div>
<div class="paragraph">
<p>There are the following possible stores:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="spark-MemoryStore.adoc">MemoryStore</a> for memory storage level.</p>
</li>
<li>
<p><a href="spark-DiskStore.adoc">DiskStore</a> for disk storage level.</p>
</li>
<li>
<p><code>ExternalBlockStore</code> for OFF_HEAP storage level.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_storing_block_data_locallyputblockdata_method"><a class="anchor" href="#_storing_block_data_locallyputblockdata_method"></a><a id="putBlockData"></a> Storing Block Data Locally&#8201;&#8212;&#8201;<code>putBlockData</code> Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">putBlockData(
  blockId: BlockId,
  data: ManagedBuffer,
  level: StorageLevel,
  classTag: ClassTag[_]): Boolean</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>putBlockData</code> simply <a href="#putBytes">stores <code>blockId</code> locally</a> (given the given storage <code>level</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>putBlockData</code> is part of the <a href="spark-BlockDataManager.adoc#putBlockData">BlockDataManager Contract</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Internally, <code>putBlockData</code> wraps <code>ChunkedByteBuffer</code> around <code>data</code> buffer&#8217;s NIO <code>ByteBuffer</code> and calls <a href="#putBytes">putBytes</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_storing_block_bytes_locallyputbytes_method"><a class="anchor" href="#_storing_block_bytes_locallyputbytes_method"></a><a id="putBytes"></a> Storing Block Bytes Locally&#8201;&#8212;&#8201;<code>putBytes</code> Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">putBytes(
  blockId: BlockId,
  bytes: ChunkedByteBuffer,
  level: StorageLevel,
  tellMaster: Boolean = true): Boolean</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>putBytes</code> makes sure that the <code>bytes</code> are not <code>null</code> and <a href="#doPutBytes">doPutBytes</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>putBytes</code> is used when:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BlockManager</code> is requested to <a href="#putBlockData">puts a block data locally</a></p>
</li>
<li>
<p><code>TaskRunner</code> is requested to <a href="spark-Executor-TaskRunner.adoc#run-result-sent-via-blockmanager">run</a> (and the result size is above <a href="spark-Executor.adoc#maxDirectResultSize">maxDirectResultSize</a>)</p>
</li>
<li>
<p><code>TorrentBroadcast</code> is requested to <a href="spark-TorrentBroadcast.adoc#writeBlocks">writeBlocks</a> and <a href="spark-TorrentBroadcast.adoc#readBlocks">readBlocks</a></p>
</li>
<li>
<p>Spark Streaming&#8217;s <code>WriteAheadLogBackedBlockRDD</code> is requested to <code>compute</code></p>
</li>
<li>
<p>Spark Streaming&#8217;s <code>BlockManagerBasedBlockHandler</code> is requested to <code>storeBlock</code></p>
</li>
<li>
<p>Spark Streaming&#8217;s <code>WriteAheadLogBasedBlockHandler</code> is requested to <code>storeBlock</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_doputbytes_internal_method"><a class="anchor" href="#_doputbytes_internal_method"></a><a id="doPutBytes"></a> <code>doPutBytes</code> Internal Method</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">def doPutBytes[T](
  blockId: BlockId,
  bytes: ChunkedByteBuffer,
  level: StorageLevel,
  classTag: ClassTag[T],
  tellMaster: Boolean = true,
  keepReadLock: Boolean = false): Boolean</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>doPutBytes</code> calls the internal helper <a href="#doPut">doPut</a> with a function that accepts a <code>BlockInfo</code> and does the uploading.</p>
</div>
<div class="paragraph">
<p>Inside the function, if the <a href="spark-rdd-StorageLevel.adoc">storage <code>level</code></a>'s replication is greater than 1, it immediately starts <a href="#replicate">replication</a> of the <code>blockId</code> block on a separate thread (from <code>futureExecutionContext</code> thread pool). The replication uses the input <code>bytes</code> and <code>level</code> storage level.</p>
</div>
<div class="paragraph">
<p>For a memory storage level, the function checks whether the storage <code>level</code> is deserialized or not. For a deserialized storage <code>level</code>, <code>BlockManager</code>'s <a href="spark-SerializerManager.adoc#dataDeserializeStream"><code>SerializerManager</code> deserializes <code>bytes</code> into an iterator of values</a> that <a href="spark-MemoryStore.adoc#putIteratorAsValues"><code>MemoryStore</code> stores</a>. If however the storage <code>level</code> is not deserialized, the function requests <a href="spark-MemoryStore.adoc#putBytes"><code>MemoryStore</code> to store the bytes</a></p>
</div>
<div class="paragraph">
<p>If the put did not succeed and the storage level is to use disk, you should see the following WARN message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>WARN BlockManager: Persisting block [blockId] to disk instead.</code></pre>
</div>
</div>
<div class="paragraph">
<p>And <a href="spark-DiskStore.adoc#putBytes"><code>DiskStore</code> stores the bytes</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="spark-DiskStore.adoc">DiskStore</a> is requested to store the bytes of a block with memory and disk storage level only when <a href="spark-MemoryStore.adoc">MemoryStore</a> has failed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the storage level is to use disk only, <a href="spark-DiskStore.adoc#putBytes"><code>DiskStore</code> stores the bytes</a>.</p>
</div>
<div class="paragraph">
<p><code>doPutBytes</code> requests <a href="#getCurrentBlockStatus">current block status</a> and if the block was successfully stored, and the driver should know about it (<code>tellMaster</code>), the function <a href="#reportBlockStatus">reports the current storage status of the block to the driver</a>. The <a href="spark-executor-TaskMetrics.adoc#incUpdatedBlockStatuses">current <code>TaskContext</code> metrics are updated with the updated block status</a> (only when executed inside a task where <code>TaskContext</code> is available).</p>
</div>
<div class="paragraph">
<p>You should see the following DEBUG message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>DEBUG BlockManager: Put block [blockId] locally took [time] ms</code></pre>
</div>
</div>
<div class="paragraph">
<p>The function waits till the earlier asynchronous replication finishes for a block with replication level greater than <code>1</code>.</p>
</div>
<div class="paragraph">
<p>The final result of <code>doPutBytes</code> is the result of storing the block successful or not (as computed earlier).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>doPutBytes</code> is used exclusively when <code>BlockManager</code> is requested to <a href="#putBytes">putBytes</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_maybecachediskvaluesinmemory_method"><a class="anchor" href="#_maybecachediskvaluesinmemory_method"></a><a id="maybeCacheDiskValuesInMemory"></a> <code>maybeCacheDiskValuesInMemory</code> Method</h2>
<div class="sectionbody">
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_doput_internal_method"><a class="anchor" href="#_doput_internal_method"></a><a id="doPut"></a> <code>doPut</code> Internal Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">doPut[T](
  blockId: BlockId,
  level: StorageLevel,
  classTag: ClassTag[_],
  tellMaster: Boolean,
  keepReadLock: Boolean)(putBody: BlockInfo =&gt; Option[T]): Option[T]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>doPut</code> is an internal helper method for <a href="#doPutBytes">doPutBytes</a> and <a href="#doPutIterator">doPutIterator</a>.</p>
</div>
<div class="paragraph">
<p><code>doPut</code> executes the input <code>putBody</code> function with a <a href="spark-BlockInfo.adoc">BlockInfo</a> being a new <code>BlockInfo</code> object (with <code>level</code> storage level) that <a href="spark-BlockInfoManager.adoc#lockNewBlockForWriting"><code>BlockInfoManager</code> managed to create a write lock for</a>.</p>
</div>
<div class="paragraph">
<p>If the block has already been created (and <a href="spark-BlockInfoManager.adoc#lockNewBlockForWriting"><code>BlockInfoManager</code> did not manage to create a write lock for</a>), the following WARN message is printed out to the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>WARN Block [blockId] already exists on this machine; not re-adding it</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>doPut</code> <a href="#releaseLock">releases the read lock for the block</a> when <code>keepReadLock</code> flag is disabled and returns <code>None</code> immediately.</p>
</div>
<div class="paragraph">
<p>If however the write lock has been given, <code>doPut</code> executes <code>putBody</code>.</p>
</div>
<div class="paragraph">
<p>If the result of <code>putBody</code> is <code>None</code> the block is considered saved successfully.</p>
</div>
<div class="paragraph">
<p>For successful save and <code>keepReadLock</code> enabled, <a href="spark-BlockInfoManager.adoc#downgradeLock"><code>BlockInfoManager</code> is requested to downgrade an exclusive write lock for <code>blockId</code> to a shared read lock</a>.</p>
</div>
<div class="paragraph">
<p>For successful save and <code>keepReadLock</code> disabled, <a href="spark-BlockInfoManager.adoc#unlock"><code>BlockInfoManager</code> is requested to release lock on <code>blockId</code></a>.</p>
</div>
<div class="paragraph">
<p>For unsuccessful save, <a href="#removeBlockInternal">the block is removed from memory and disk stores</a> and the following WARN message is printed out to the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>WARN Putting block [blockId] failed</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ultimately, the following DEBUG message is printed out to the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>DEBUG Putting block [blockId] [withOrWithout] replication took [usedTime] ms</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_removing_block_from_memory_and_diskremoveblock_method"><a class="anchor" href="#_removing_block_from_memory_and_diskremoveblock_method"></a><a id="removeBlock"></a> Removing Block From Memory and Disk&#8201;&#8212;&#8201;<code>removeBlock</code> Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">removeBlock(blockId: BlockId, tellMaster: Boolean = true): Unit</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>removeBlock</code> removes the <code>blockId</code> block from the <a href="spark-MemoryStore.adoc">MemoryStore</a> and <a href="spark-DiskStore.adoc">DiskStore</a>.</p>
</div>
<div class="paragraph">
<p>When executed, it prints out the following DEBUG message to the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>DEBUG Removing block [blockId]</code></pre>
</div>
</div>
<div class="paragraph">
<p>It requests <a href="spark-BlockInfoManager.adoc">BlockInfoManager</a> for lock for writing for the <code>blockId</code> block. If it receives none, it prints out the following WARN message to the logs and quits.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>WARN Asked to remove block [blockId], which does not exist</code></pre>
</div>
</div>
<div class="paragraph">
<p>Otherwise, with a write lock for the block, the block is removed from <a href="spark-MemoryStore.adoc">MemoryStore</a> and <a href="spark-DiskStore.adoc">DiskStore</a> (see <a href="spark-MemoryStore.adoc#remove">Removing Block in <code>MemoryStore</code></a> and <a href="spark-DiskStore.adoc#remove">Removing Block in <code>DiskStore</code></a>).</p>
</div>
<div class="paragraph">
<p>If both removals fail, it prints out the following WARN message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>WARN Block [blockId] could not be removed as it was not found in either the disk, memory, or external block store</code></pre>
</div>
</div>
<div class="paragraph">
<p>The block is removed from <a href="spark-BlockInfoManager.adoc">BlockInfoManager</a>.</p>
</div>
<div class="paragraph">
<p>It then <a href="#getCurrentBlockStatus">calculates the current block status</a> that is used to <a href="#reportBlockStatus">report the block status to the driver</a> (if the input <code>tellMaster</code> and the info&#8217;s <code>tellMaster</code> are both enabled, i.e. <code>true</code>) and the <a href="spark-executor-TaskMetrics.adoc#incUpdatedBlockStatuses">current TaskContext metrics are updated with the change</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is used to <a href="#removeRdd">remove RDDs</a> and <a href="#removeBroadcast">broadcast</a> as well as in <a href="spark-blockmanager-BlockManagerSlaveEndpoint.adoc#RemoveBlock"><code>BlockManagerSlaveEndpoint</code> while handling <code>RemoveBlock</code> messages</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_removing_rdd_blocksremoverdd_method"><a class="anchor" href="#_removing_rdd_blocksremoverdd_method"></a><a id="removeRdd"></a> Removing RDD Blocks&#8201;&#8212;&#8201;<code>removeRdd</code> Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">removeRdd(rddId: Int): Int</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>removeRdd</code> removes all the blocks that belong to the <code>rddId</code> RDD.</p>
</div>
<div class="paragraph">
<p>It prints out the following INFO message to the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>INFO Removing RDD [rddId]</code></pre>
</div>
</div>
<div class="paragraph">
<p>It then requests RDD blocks from <a href="spark-BlockInfoManager.adoc">BlockInfoManager</a> and <a href="#removeBlock">removes them (from memory and disk)</a> (without informing the driver).</p>
</div>
<div class="paragraph">
<p>The number of blocks removed is the final result.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is used by <a href="spark-blockmanager-BlockManagerSlaveEndpoint.adoc#RemoveRdd"><code>BlockManagerSlaveEndpoint</code> while handling <code>RemoveRdd</code> messages</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_removing_all_blocks_of_broadcast_variableremovebroadcast_method"><a class="anchor" href="#_removing_all_blocks_of_broadcast_variableremovebroadcast_method"></a><a id="removeBroadcast"></a> Removing All Blocks of Broadcast Variable&#8201;&#8212;&#8201;<code>removeBroadcast</code> Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">removeBroadcast(broadcastId: Long, tellMaster: Boolean): Int</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>removeBroadcast</code> removes all the blocks of the input <code>broadcastId</code> broadcast.</p>
</div>
<div class="paragraph">
<p>Internally, it starts by printing out the following DEBUG message to the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>DEBUG Removing broadcast [broadcastId]</code></pre>
</div>
</div>
<div class="paragraph">
<p>It then requests all the <a href="spark-BlockDataManager.adoc#BroadcastBlockId">BroadcastBlockId</a> objects that belong to the <code>broadcastId</code> broadcast from <a href="spark-BlockInfoManager.adoc">BlockInfoManager</a> and <a href="#removeBlock">removes them (from memory and disk)</a>.</p>
</div>
<div class="paragraph">
<p>The number of blocks removed is the final result.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is used by <a href="spark-blockmanager-BlockManagerSlaveEndpoint.adoc#RemoveBroadcast"><code>BlockManagerSlaveEndpoint</code> while handling <code>RemoveBroadcast</code> messages</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_block_statusgetstatus_method"><a class="anchor" href="#_getting_block_statusgetstatus_method"></a><a id="getStatus"></a> Getting Block Status&#8201;&#8212;&#8201;<code>getStatus</code> Method</h2>
<div class="sectionbody">
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_blockmanager_instance"><a class="anchor" href="#_creating_blockmanager_instance"></a><a id="creating-instance"></a> Creating BlockManager Instance</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>BlockManager</code> takes the following when created:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="executorId"></a> Executor ID</p>
</li>
<li>
<p><a id="rpcEnv"></a> <a href="spark-rpc.adoc">RpcEnv</a></p>
</li>
<li>
<p><a id="master"></a> <a href="spark-BlockManagerMaster.adoc">BlockManagerMaster</a></p>
</li>
<li>
<p><a id="serializerManager"></a> <a href="spark-SerializerManager.adoc">SerializerManager</a></p>
</li>
<li>
<p><a id="conf"></a> <a href="spark-SparkConf.adoc">SparkConf</a></p>
</li>
<li>
<p><a id="memoryManager"></a> <a href="spark-MemoryManager.adoc">MemoryManager</a></p>
</li>
<li>
<p><a id="mapOutputTracker"></a> <a href="spark-service-mapoutputtracker.adoc">MapOutputTracker</a></p>
</li>
<li>
<p><a id="shuffleManager"></a> <a href="spark-shuffle-ShuffleManager.adoc">ShuffleManager</a></p>
</li>
<li>
<p><a href="#blockTransferService">BlockTransferService</a></p>
</li>
<li>
<p><a id="securityManager"></a> <code>SecurityManager</code></p>
</li>
<li>
<p><a id="numUsableCores"></a> CPU cores</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>executorId</code> is <code>SparkContext.DRIVER_IDENTIFIER</code>, i.e. <code>driver</code> for the driver, and the value of <a href="spark-CoarseGrainedExecutorBackend.adoc#executor-id">--executor-id</a> command-line argument for <a href="spark-CoarseGrainedExecutorBackend.adoc">CoarseGrainedExecutorBackend</a> executors or <a href="spark-executor-backends-MesosExecutorBackend.adoc">MesosExecutorBackend</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME Elaborate on the executor backends and executor ids.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When created, <code>BlockManager</code> sets <a href="#externalShuffleServiceEnabled">externalShuffleServiceEnabled</a> internal flag per <a href="spark-ExternalShuffleService.adoc#spark.shuffle.service.enabled">spark.shuffle.service.enabled</a> Spark property.</p>
</div>
<div class="paragraph">
<p><code>BlockManager</code> then creates an instance of <a href="spark-DiskBlockManager.adoc">DiskBlockManager</a> (requesting <code>deleteFilesOnStop</code> when an external shuffle service is not in use).</p>
</div>
<div class="paragraph">
<p><code>BlockManager</code> creates an instance of <a href="spark-BlockInfoManager.adoc">BlockInfoManager</a> (as <code>blockInfoManager</code>).</p>
</div>
<div class="paragraph">
<p><code>BlockManager</code> creates <strong>block-manager-future</strong> daemon cached thread pool with 128 threads maximum (as <code>futureExecutionContext</code>).</p>
</div>
<div class="paragraph">
<p><code>BlockManager</code> creates a <a href="spark-MemoryStore.adoc">MemoryStore</a> and <a href="spark-DiskStore.adoc">DiskStore</a>.</p>
</div>
<div class="paragraph">
<p><a href="spark-MemoryManager.adoc">MemoryManager</a> gets the <a href="spark-MemoryStore.adoc">MemoryStore</a> object assigned.</p>
</div>
<div class="paragraph">
<p><code>BlockManager</code> calculates the maximum memory to use (as <code>maxMemory</code>) by requesting the maximum <a href="spark-MemoryManager.adoc#maxOnHeapStorageMemory">on-heap</a> and <a href="spark-MemoryManager.adoc#maxOffHeapStorageMemory">off-heap</a> storage memory from the assigned <code>MemoryManager</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="spark-UnifiedMemoryManager.adoc">UnifiedMemoryManager</a> is the default <code>MemoryManager</code> (as of Spark 1.6).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>BlockManager</code> calculates the port used by the external shuffle service (as <code>externalShuffleServicePort</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is computed specially in Spark on YARN.
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME Describe the YARN-specific part.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>BlockManager</code> creates a client to read other executors' shuffle files (as <code>shuffleClient</code>). If the external shuffle service is used an <a href="spark-ShuffleClient-ExternalShuffleClient.adoc">ExternalShuffleClient</a> is created or the input <a href="spark-BlockTransferService.adoc">BlockTransferService</a> is used.</p>
</div>
<div class="paragraph">
<p><code>BlockManager</code> sets <a href="#spark.block.failures.beforeLocationRefresh">the maximum number of failures before this block manager refreshes the block locations from the driver</a> (as <code>maxFailuresBeforeLocationRefresh</code>).</p>
</div>
<div class="paragraph">
<p><code>BlockManager</code> registers <a href="spark-blockmanager-BlockManagerSlaveEndpoint.adoc">BlockManagerSlaveEndpoint</a> with the input <a href="spark-rpc.adoc">RpcEnv</a>, itself, and <a href="spark-service-mapoutputtracker.adoc">MapOutputTracker</a> (as <code>slaveEndpoint</code>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_shuffleserverid"><a class="anchor" href="#_shuffleserverid"></a><a id="shuffleServerId"></a> <code>shuffleServerId</code></h2>
<div class="sectionbody">
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_initializing_blockmanagerinitialize_method"><a class="anchor" href="#_initializing_blockmanagerinitialize_method"></a><a id="initialize"></a> Initializing BlockManager&#8201;&#8212;&#8201;<code>initialize</code> Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">initialize(appId: String): Unit</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>initialize</code> initializes a <code>BlockManager</code> on the driver and executors (see <a href="spark-SparkContext.adoc#creating-instance">Creating SparkContext Instance</a> and <a href="spark-Executor.adoc#creating-instance">Creating Executor Instance</a>, respectively).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The method must be called before a <code>BlockManager</code> can be considered fully operable.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>initialize</code> does the following in order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Initializes <a href="spark-BlockTransferService.adoc#init">BlockTransferService</a></p>
</li>
<li>
<p>Initializes the internal shuffle client, be it <a href="spark-ShuffleClient-ExternalShuffleClient.adoc">ExternalShuffleClient</a> or <a href="spark-BlockTransferService.adoc">BlockTransferService</a>.</p>
</li>
<li>
<p><a href="spark-BlockManagerMaster.adoc#registerBlockManager">Registers itself with the driver&#8217;s <code>BlockManagerMaster</code></a> (using the <code>id</code>, <code>maxMemory</code> and its <code>slaveEndpoint</code>).</p>
<div class="paragraph">
<p>The <code>BlockManagerMaster</code> reference is passed in when the <a href="#creating-instance"><code>BlockManager</code> is created</a> on the driver and executors.</p>
</div>
</li>
<li>
<p>Sets <a href="#shuffleServerId">shuffleServerId</a> to an instance of <a href="#BlockManagerId">BlockManagerId</a> given an executor id, host name and port for <a href="spark-BlockTransferService.adoc">BlockTransferService</a>.</p>
</li>
<li>
<p>It creates the address of the server that serves this executor&#8217;s shuffle files (using <a href="#shuffleServerId">shuffleServerId</a>)</p>
</li>
</ol>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME Review the initialize procedure again
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME Describe <code>shuffleServerId</code>. Where is it used?
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the <a href="#externalShuffleServiceEnabled">External Shuffle Service is used</a>, the following INFO appears in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>INFO external shuffle service port = [externalShuffleServicePort]</code></pre>
</div>
</div>
<div class="paragraph">
<p>It <a href="spark-BlockManagerMaster.adoc#registerBlockManager">registers itself to the driver&#8217;s BlockManagerMaster</a> passing the <a href="#BlockManagerId">BlockManagerId</a>, the maximum memory (as <code>maxMemory</code>), and the <a href="spark-blockmanager-BlockManagerSlaveEndpoint.adoc">BlockManagerSlaveEndpoint</a>.</p>
</div>
<div class="paragraph">
<p>Ultimately, if the initialization happens on an executor and the <a href="#externalShuffleServiceEnabled">External Shuffle Service is used</a>, it <a href="#registerWithExternalShuffleServer">registers to the shuffle service</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>initialize</code> is called when the <a href="spark-SparkContext-creating-instance-internals.adoc#BlockManager-initialization">driver is launched (and <code>SparkContext</code> is created)</a> and when an <a href="spark-Executor.adoc#creating-instance"><code>Executor</code> is created</a> (for <a href="spark-CoarseGrainedExecutorBackend.adoc#RegisteredExecutor">CoarseGrainedExecutorBackend</a> and <a href="spark-executor-backends-MesosExecutorBackend.adoc">MesosExecutorBackend</a>).
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_registering_executors_blockmanager_with_external_shuffle_serverregisterwithexternalshuffleserver_method"><a class="anchor" href="#_registering_executors_blockmanager_with_external_shuffle_serverregisterwithexternalshuffleserver_method"></a><a id="registerWithExternalShuffleServer"></a> Registering Executor&#8217;s BlockManager with External Shuffle Server&#8201;&#8212;&#8201;<code>registerWithExternalShuffleServer</code> Method</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">registerWithExternalShuffleServer(): Unit</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>registerWithExternalShuffleServer</code> is an internal helper method to register the <code>BlockManager</code> for an executor with an <a href="spark-ExternalShuffleService.adoc">external shuffle server</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is executed when a <a href="#initialize"><code>BlockManager</code> is initialized on an executor and an external shuffle service is used</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When executed, you should see the following INFO message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>INFO Registering executor with local external shuffle service.</code></pre>
</div>
</div>
<div class="paragraph">
<p>It uses <a href="#shuffleClient">shuffleClient</a> to <a href="spark-ShuffleClient-ExternalShuffleClient.adoc#registerWithShuffleServer">register the block manager</a> using <a href="#shuffleServerId">shuffleServerId</a> (i.e. the host, the port and the executorId) and a <code>ExecutorShuffleInfo</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>ExecutorShuffleInfo</code> uses <code>localDirs</code> and <code>subDirsPerLocalDir</code> from <a href="spark-DiskBlockManager.adoc">DiskBlockManager</a> and the class name of the constructor <a href="spark-shuffle-ShuffleManager.adoc">ShuffleManager</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It tries to register at most 3 times with 5-second sleeps in-between.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The maximum number of attempts and the sleep time in-between are hard-coded, i.e. they are not configured.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Any issues while connecting to the external shuffle service are reported as ERROR messages in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ERROR Failed to connect to external shuffle server, will retry [#attempts] more times after waiting 5 seconds...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_re_registering_blockmanager_with_driver_and_reporting_blocksreregister_method"><a class="anchor" href="#_re_registering_blockmanager_with_driver_and_reporting_blocksreregister_method"></a><a id="reregister"></a> Re-registering BlockManager with Driver and Reporting Blocks&#8201;&#8212;&#8201;<code>reregister</code> Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">reregister(): Unit</code></pre>
</div>
</div>
<div class="paragraph">
<p>When executed, <code>reregister</code> prints the following INFO message to the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>INFO BlockManager: BlockManager [blockManagerId] re-registering with master</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>reregister</code> then <a href="spark-BlockManagerMaster.adoc#registerBlockManager">registers itself to the driver&#8217;s <code>BlockManagerMaster</code></a> (just as it was when <a href="#initialize">BlockManager was initializing</a>). It passes the <a href="#BlockManagerId">BlockManagerId</a>, the maximum memory (as <code>maxMemory</code>), and the <a href="spark-blockmanager-BlockManagerSlaveEndpoint.adoc">BlockManagerSlaveEndpoint</a>.</p>
</div>
<div class="paragraph">
<p><code>reregister</code> will then report all the local blocks to the <a href="spark-BlockManagerMaster.adoc">BlockManagerMaster</a>.</p>
</div>
<div class="paragraph">
<p>You should see the following INFO message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>INFO BlockManager: Reporting [blockInfoManager.size] blocks to the master.</code></pre>
</div>
</div>
<div class="paragraph">
<p>For each block metadata (in <a href="spark-BlockInfoManager.adoc">BlockInfoManager</a>) it <a href="#getCurrentBlockStatus">gets block current status</a> and <a href="#tryToReportBlockStatus">tries to send it to the BlockManagerMaster</a>.</p>
</div>
<div class="paragraph">
<p>If there is an issue communicating to the <a href="spark-BlockManagerMaster.adoc">BlockManagerMaster</a>, you should see the following ERROR message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ERROR BlockManager: Failed to report [blockId] to master; giving up.</code></pre>
</div>
</div>
<div class="paragraph">
<p>After the ERROR message, <code>reregister</code> stops reporting.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>reregister</code> is called when a <a href="spark-Executor.adoc#heartbeats-and-active-task-metrics"><code>Executor</code> was informed to re-register while sending heartbeats</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_calculate_current_block_statusgetcurrentblockstatus_method"><a class="anchor" href="#_calculate_current_block_statusgetcurrentblockstatus_method"></a><a id="getCurrentBlockStatus"></a> Calculate Current Block Status&#8201;&#8212;&#8201;<code>getCurrentBlockStatus</code> Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">getCurrentBlockStatus(blockId: BlockId, info: BlockInfo): BlockStatus</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>getCurrentBlockStatus</code> returns the current <code>BlockStatus</code> of the <code>BlockId</code> block (with the block&#8217;s current <a href="spark-rdd-StorageLevel.adoc">StorageLevel</a>, memory and disk sizes). It uses <a href="spark-MemoryStore.adoc">MemoryStore</a> and <a href="spark-DiskStore.adoc">DiskStore</a> for size and other information.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Most of the information to build <code>BlockStatus</code> is already in <code>BlockInfo</code> except that it may not necessarily reflect the current state per <a href="spark-MemoryStore.adoc">MemoryStore</a> and <a href="spark-DiskStore.adoc">DiskStore</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Internally, it uses the input <a href="spark-BlockInfo.adoc">BlockInfo</a> to know about the block&#8217;s storage level. If the storage level is not set (i.e. <code>null</code>), the returned <code>BlockStatus</code> assumes the <a href="spark-rdd-StorageLevel.adoc">default <code>NONE</code> storage level</a> and the memory and disk sizes being <code>0</code>.</p>
</div>
<div class="paragraph">
<p>If however the storage level is set, <code>getCurrentBlockStatus</code> uses <a href="spark-MemoryStore.adoc">MemoryStore</a> and <a href="spark-DiskStore.adoc">DiskStore</a> to check whether the block is stored in the storages or not and request for their sizes in the storages respectively (using their <code>getSize</code> or assume <code>0</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is acceptable that the <code>BlockInfo</code> says to use memory or disk yet the block is not in the storages (yet or anymore). The method will give current status.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>getCurrentBlockStatus</code> is used when <a href="#reregister">executor&#8217;s BlockManager is requested to report the current status of the local blocks to the master</a>, <a href="#doPutBytes">saving a block to a storage</a> or <a href="#dropFromMemory">removing a block from memory only</a> or <a href="#removeBlock">both, i.e. from memory and disk</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reportallblocks_internal_method"><a class="anchor" href="#_reportallblocks_internal_method"></a><a id="reportAllBlocks"></a> <code>reportAllBlocks</code> Internal Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">reportAllBlocks(): Unit</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>reportAllBlocks</code>&#8230;&#8203;FIXME</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>reportAllBlocks</code> is used when <code>BlockManager</code> is requested to <a href="#reregister">re-register all blocks to the driver</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reporting_current_storage_status_of_block_to_driverreportblockstatus_internal_method"><a class="anchor" href="#_reporting_current_storage_status_of_block_to_driverreportblockstatus_internal_method"></a><a id="reportBlockStatus"></a> Reporting Current Storage Status of Block to Driver&#8201;&#8212;&#8201;<code>reportBlockStatus</code> Internal Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">reportBlockStatus(
  blockId: BlockId,
  info: BlockInfo,
  status: BlockStatus,
  droppedMemorySize: Long = 0L): Unit</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>reportBlockStatus</code> is an internal method for <a href="#tryToReportBlockStatus">reporting a block status to the driver</a> and if told to re-register it prints out the following INFO message to the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>INFO BlockManager: Got told to re-register updating block [blockId]</code></pre>
</div>
</div>
<div class="paragraph">
<p>It does asynchronous reregistration (using <code>asyncReregister</code>).</p>
</div>
<div class="paragraph">
<p>In either case, it prints out the following DEBUG message to the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>DEBUG BlockManager: Told master about block [blockId]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>reportBlockStatus</code> is used when <code>BlockManager</code> is requested to <a href="#getBlockData">getBlockData</a>, <a href="#doPutBytes">doPutBytes</a>, <a href="#doPutIterator">doPutIterator</a>, <a href="#dropFromMemory">dropFromMemory</a> and <a href="#removeBlockInternal">removeBlockInternal</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reporting_block_status_update_to_drivertrytoreportblockstatus_internal_method"><a class="anchor" href="#_reporting_block_status_update_to_drivertrytoreportblockstatus_internal_method"></a><a id="tryToReportBlockStatus"></a> Reporting Block Status Update to Driver&#8201;&#8212;&#8201;<code>tryToReportBlockStatus</code> Internal Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">def tryToReportBlockStatus(
  blockId: BlockId,
  info: BlockInfo,
  status: BlockStatus,
  droppedMemorySize: Long = 0L): Boolean</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>tryToReportBlockStatus</code> <a href="spark-BlockManagerMaster.adoc#updateBlockInfo">reports block status update</a> to <a href="#master">BlockManagerMaster</a> and returns its response.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>tryToReportBlockStatus</code> is used when <code>BlockManager</code> is requested to <a href="#reportAllBlocks">reportAllBlocks</a> or <a href="#reportBlockStatus">reportBlockStatus</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_broadcast_values"><a class="anchor" href="#_broadcast_values"></a><a id="broadcast"></a> Broadcast Values</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When a new broadcast value is created, <a href="spark-TorrentBroadcast.adoc">TorrentBroadcast</a> blocks are put in the block manager.</p>
</div>
<div class="paragraph">
<p>You should see the following <code>TRACE</code> message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>TRACE Put for block [blockId] took [startTimeMs] to get into synchronized block</code></pre>
</div>
</div>
<div class="paragraph">
<p>It puts the data in the memory first and drop to disk if the memory store can&#8217;t hold it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>DEBUG Put block [blockId] locally took [startTimeMs]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_blockmanagerid"><a class="anchor" href="#_blockmanagerid"></a><a id="BlockManagerId"></a> BlockManagerId</h2>
<div class="sectionbody">
<div class="paragraph">
<p>FIXME</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_execution_context"><a class="anchor" href="#_execution_context"></a><a id="execution-context"></a> Execution Context</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>block-manager-future</strong> is the execution context for&#8230;&#8203;FIXME</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_misc"><a class="anchor" href="#_misc"></a>Misc</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The underlying abstraction for blocks in Spark is a <code>ByteBuffer</code> that limits the size of a block to 2GB (<code>Integer.MAX_VALUE</code> - see <a href="http://stackoverflow.com/q/8076472/1305344">Why does FileChannel.map take up to Integer.MAX_VALUE of data?</a> and <a href="https://issues.apache.org/jira/browse/SPARK-1476">SPARK-1476 2GB limit in spark for blocks</a>). This has implication not just for managed blocks in use, but also for shuffle blocks (memory mapped blocks are limited to 2GB, even though the API allows for <code>long</code>), ser-deser via byte array-backed output streams.</p>
</div>
<div class="paragraph">
<p>When a non-local executor starts, it initializes a <code>BlockManager</code> object using <a href="spark-SparkConf.adoc#spark.app.id">spark.app.id</a> Spark property for the id.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_blockresult"><a class="anchor" href="#_blockresult"></a><a id="BlockResult"></a> BlockResult</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>BlockResult</code> is a description of a fetched block with the <code>readMethod</code> and <code>bytes</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_registering_task_with_blockinfomanagerregistertask_method"><a class="anchor" href="#_registering_task_with_blockinfomanagerregistertask_method"></a><a id="registerTask"></a> Registering Task with BlockInfoManager&#8201;&#8212;&#8201;<code>registerTask</code> Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">registerTask(taskAttemptId: Long): Unit</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>registerTask</code> <a href="spark-BlockInfoManager.adoc#registerTask">registers the input <code>taskAttemptId</code> with <code>BlockInfoManager</code></a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>registerTask</code> is used exclusively when <a href="spark-scheduler-Task.adoc#run"><code>Task</code> runs</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_diskblockobjectwritergetdiskwriter_method"><a class="anchor" href="#_creating_diskblockobjectwritergetdiskwriter_method"></a><a id="getDiskWriter"></a> Creating DiskBlockObjectWriter&#8201;&#8212;&#8201;<code>getDiskWriter</code> Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">getDiskWriter(
  blockId: BlockId,
  file: File,
  serializerInstance: SerializerInstance,
  bufferSize: Int,
  writeMetrics: ShuffleWriteMetrics): DiskBlockObjectWriter</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>getDiskWriter</code> simply creates a <a href="spark-blockmanager-DiskBlockObjectWriter.html" class="page">DiskBlockObjectWriter</a> (with <a href="spark-configuration-properties.html#spark.shuffle.sync" class="page">spark.shuffle.sync</a> Spark property for <code>syncWrites</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>getDiskWriter</code> uses the same <code>serializerManager</code> that was used to <a href="#creating-instance">create a <code>BlockManager</code></a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>getDiskWriter</code> is used when:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BypassMergeSortShuffleWriter</code> is requested to <a href="spark-shuffle-BypassMergeSortShuffleWriter.html#write" class="page">write records</a></p>
</li>
<li>
<p><code>ShuffleExternalSorter</code> is requested to <a href="spark-shuffle-ShuffleExternalSorter.html#writeSortedFile" class="page">writeSortedFile</a></p>
</li>
<li>
<p><code>ExternalAppendOnlyMap</code> is requested to <code>spillMemoryIteratorToDisk</code></p>
</li>
<li>
<p><code>ExternalSorter</code> is requested to <a href="spark-ExternalSorter.html#spillMemoryIteratorToDisk" class="page">spillMemoryIteratorToDisk</a> and <a href="spark-ExternalSorter.html#writePartitionedFile" class="page">writePartitionedFile</a></p>
</li>
<li>
<p><code>UnsafeSorterSpillWriter</code> is created</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_recording_updated_blockstatus_in_current_tasks_taskmetricsaddupdatedblockstatustotaskmetrics_internal_method"><a class="anchor" href="#_recording_updated_blockstatus_in_current_tasks_taskmetricsaddupdatedblockstatustotaskmetrics_internal_method"></a><a id="addUpdatedBlockStatusToTaskMetrics"></a> Recording Updated BlockStatus In Current Task&#8217;s TaskMetrics&#8201;&#8212;&#8201;<code>addUpdatedBlockStatusToTaskMetrics</code> Internal Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">addUpdatedBlockStatusToTaskMetrics(blockId: BlockId, status: BlockStatus): Unit</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>addUpdatedBlockStatusToTaskMetrics</code> <a href="spark-TaskContext.adoc#get">takes an active <code>TaskContext</code></a> (if available) and <a href="spark-executor-TaskMetrics.adoc#incUpdatedBlockStatuses">records updated <code>BlockStatus</code> for <code>Block</code></a> (in the <a href="spark-TaskContext.adoc#taskMetrics">task&#8217;s <code>TaskMetrics</code></a>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>addUpdatedBlockStatusToTaskMetrics</code> is used when <code>BlockManager</code> <a href="#doPutBytes">doPutBytes</a> (for a block that was successfully stored), <a href="#doPut">doPut</a>, <a href="#doPutIterator">doPutIterator</a>, <a href="#dropFromMemory">removes blocks from memory</a> (possibly spilling it to disk) and <a href="#removeBlock">removes block from memory and disk</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_requesting_shuffle_related_spark_metrics_sourceshufflemetricssource_method"><a class="anchor" href="#_requesting_shuffle_related_spark_metrics_sourceshufflemetricssource_method"></a><a id="shuffleMetricsSource"></a> Requesting Shuffle-Related Spark Metrics Source&#8201;&#8212;&#8201;<code>shuffleMetricsSource</code> Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">shuffleMetricsSource: Source</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>shuffleMetricsSource</code> requests the <a href="#shuffleClient">ShuffleClient</a> for the <a href="spark-ShuffleClient.adoc#shuffleMetrics">shuffle-related metrics</a> and creates a <a href="spark-BlockManager-ShuffleMetricsSource.adoc">ShuffleMetricsSource</a> with the <a href="spark-BlockManager-ShuffleMetricsSource.adoc#sourceName">source name</a> per <a href="spark-ExternalShuffleService.adoc#spark.shuffle.service.enabled">spark.shuffle.service.enabled</a> configuration property:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ExternalShuffle</strong> when <a href="spark-ExternalShuffleService.adoc#spark.shuffle.service.enabled">spark.shuffle.service.enabled</a> configuration property is on (<code>true</code>)</p>
</li>
<li>
<p><strong>NettyBlockTransfer</strong> when <a href="spark-ExternalShuffleService.adoc#spark.shuffle.service.enabled">spark.shuffle.service.enabled</a> configuration property is off (<code>false</code>)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="spark-ExternalShuffleService.adoc#spark.shuffle.service.enabled">spark.shuffle.service.enabled</a> configuration property is off (<code>false</code>) by default.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>shuffleMetricsSource</code> is used exclusively when <code>Executor</code> is <a href="spark-Executor.adoc#creating-instance">created</a> (for non-local / cluster modes).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_settings"><a class="anchor" href="#_settings"></a><a id="settings"></a> Settings</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Spark Properties</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Spark Property</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="spark_blockManager_port"></a> <code>spark.blockManager.port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Port to use for the block manager when a more specific setting for the driver or executors is not provided.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_replicating_block_to_peersreplicate_internal_method"><a class="anchor" href="#_replicating_block_to_peersreplicate_internal_method"></a><a id="replicate"></a> Replicating Block To Peers&#8201;&#8212;&#8201;<code>replicate</code> Internal Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">replicate(
  blockId: BlockId,
  data: BlockData,
  level: StorageLevel,
  classTag: ClassTag[_],
  existingReplicas: Set[BlockManagerId] = Set.empty): Unit</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>replicate</code>&#8230;&#8203;FIXME</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>replicate</code> is used when <code>BlockManager</code> is requested to <a href="#doPutBytes">doPutBytes</a>, <a href="#doPutIterator">doPutIterator</a> and <a href="#replicateBlock">replicateBlock</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_replicateblock_method"><a class="anchor" href="#_replicateblock_method"></a><a id="replicateBlock"></a> <code>replicateBlock</code> Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">replicateBlock(
  blockId: BlockId,
  existingReplicas: Set[BlockManagerId],
  maxReplicas: Int): Unit</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>replicateBlock</code>&#8230;&#8203;FIXME</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>replicateBlock</code> is used exclusively when <code>BlockManagerSlaveEndpoint</code> is requested to <a href="spark-blockmanager-BlockManagerSlaveEndpoint.adoc#receiveAndReply-ReplicateBlock">handle ReplicateBlock messages</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_putiterator_method"><a class="anchor" href="#_putiterator_method"></a><a id="putIterator"></a> <code>putIterator</code> Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">putIterator[T: ClassTag](
  blockId: BlockId,
  values: Iterator[T],
  level: StorageLevel,
  tellMaster: Boolean = true): Boolean</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>putIterator</code>&#8230;&#8203;FIXME</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>putIterator</code> is used when:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BlockManager</code> is requested to <a href="#putSingle">putSingle</a></p>
</li>
<li>
<p>Spark Streaming&#8217;s <code>BlockManagerBasedBlockHandler</code> is requested to <code>storeBlock</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_putsingle_method"><a class="anchor" href="#_putsingle_method"></a><a id="putSingle"></a> <code>putSingle</code> Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">putSingle[T: ClassTag](
  blockId: BlockId,
  value: T,
  level: StorageLevel,
  tellMaster: Boolean = true): Boolean</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>putSingle</code>&#8230;&#8203;FIXME</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>putSingle</code> is used when <code>TorrentBroadcast</code> is requested to <a href="spark-TorrentBroadcast.adoc#writeBlocks">read the blocks of a broadcast variable</a> and <a href="spark-TorrentBroadcast.adoc#readBroadcastBlock">readBroadcastBlock</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_fetching_block_from_remote_nodesgetremotebytes_method"><a class="anchor" href="#_fetching_block_from_remote_nodesgetremotebytes_method"></a><a id="getRemoteBytes"></a> Fetching Block From Remote Nodes&#8201;&#8212;&#8201;<code>getRemoteBytes</code> Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">getRemoteBytes(blockId: BlockId): Option[ChunkedByteBuffer]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>getRemoteBytes</code>&#8230;&#8203;FIXME</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>getRemoteBytes</code> is used when:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BlockManager</code> is requested to <a href="#getRemoteValues">getRemoteValues</a></p>
</li>
<li>
<p><code>TorrentBroadcast</code> is requested to <a href="spark-TorrentBroadcast.adoc#readBlocks">readBlocks</a></p>
</li>
<li>
<p><code>TaskResultGetter</code> is requested to <a href="spark-scheduler-TaskResultGetter.adoc#enqueueSuccessfulTask">enqueuing a successful IndirectTaskResult</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getremotevalues_internal_method_2"><a class="anchor" href="#_getremotevalues_internal_method_2"></a><a id="getRemoteValues"></a> <code>getRemoteValues</code> Internal Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">getRemoteValues[T: ClassTag](blockId: BlockId): Option[BlockResult]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>getRemoteValues</code>&#8230;&#8203;FIXME</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>getRemoteValues</code> is used exclusively when <code>BlockManager</code> is requested to <a href="#get">get a block by BlockId</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getsingle_method"><a class="anchor" href="#_getsingle_method"></a><a id="getSingle"></a> <code>getSingle</code> Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">getSingle[T: ClassTag](blockId: BlockId): Option[T]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>getSingle</code>&#8230;&#8203;FIXME</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>getSingle</code> is used exclusively in Spark tests.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_shuffleclient_property"><a class="anchor" href="#_shuffleclient_property"></a><a id="shuffleClient"></a> <code>shuffleClient</code> Property</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">shuffleClient: ShuffleClient</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>shuffleClient</code> is a <a href="spark-ShuffleClient.adoc">ShuffleClient</a> that <code>BlockManager</code> uses for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#shuffleMetricsSource">shuffleMetricsSource</a></p>
</li>
<li>
<p><a href="#registerWithExternalShuffleServer">Registering the BlockManager of an executor with an external shuffle server</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>shuffleClient</code> is also used when <code>BlockStoreShuffleReader</code> is requested to <a href="spark-shuffle-BlockStoreShuffleReader.adoc#read">read combined key-value records for a reduce task</a> (and creates a <a href="spark-ShuffleBlockFetcherIterator.adoc#shuffleClient">ShuffleBlockFetcherIterator</a>).</p>
</div>
<div class="paragraph">
<p><code>shuffleClient</code> can be either a <a href="spark-ShuffleClient-ExternalShuffleClient.adoc">ExternalShuffleClient</a> or the <a href="#blockTransferService">BlockTransferService</a> (that is the <a href="spark-NettyBlockTransferService.adoc">NettyBlockTransferService</a> given by <a href="spark-SparkEnv.adoc#create-BlockManager">SparkEnv</a>).</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME Figure
</td>
</tr>
</table>
</div>
<div id="shuffleClient-externalShuffleServiceEnabled" class="paragraph">
<p><code>shuffleClient</code> uses <code>spark.shuffle.service.enabled</code> configuration property (default: <code>false</code>) that controls whether to use <a href="spark-ShuffleClient-ExternalShuffleClient.adoc">ExternalShuffleClient</a> (<code>true</code>) or the <a href="#blockTransferService">BlockTransferService</a> (i.e. <a href="spark-NettyBlockTransferService.adoc">NettyBlockTransferService</a>).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_blocktransferservice_property"><a class="anchor" href="#_blocktransferservice_property"></a><a id="blockTransferService"></a> <code>blockTransferService</code> Property</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When <a href="#creating-instance">created</a>, <code>BlockManager</code> is given a <a href="spark-BlockTransferService.adoc">BlockTransferService</a> that is used for the following services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#getRemoteBytes">Fetching a block from remote nodes</a></p>
</li>
<li>
<p><a href="#replicate">Replicating a block to peers</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Remote nodes, peers, block managers are all synonyms.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>BlockTransferService</code> acts as the <a href="#shuffleClient">ShuffleClient</a> when <a href="#shuffleClient-externalShuffleServiceEnabled">spark.shuffle.service.enabled</a> configuration property is off (which is the default).</p>
</div>
<div class="paragraph">
<p>When <a href="#initialize">initialized</a>, <code>BlockManager</code> requests the <code>BlockTransferService</code> to <a href="spark-BlockTransferService.adoc#init">init</a>. <code>BlockManager</code> also requests the <a href="#shuffleClient">ShuffleClient</a> to <a href="spark-ShuffleClient.adoc#init">init</a> (that does nothing by default).</p>
</div>
<div class="paragraph">
<p>When <a href="#stop">stopped</a>, <code>BlockManager</code> requests the <code>BlockTransferService</code> to <a href="spark-BlockTransferService.adoc#close">close</a>. <code>BlockManager</code> also requests the <a href="#shuffleClient">ShuffleClient</a> to <code>close</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_block_from_block_managers_or_computing_and_storing_it_otherwisegetorelseupdate_method"><a class="anchor" href="#_getting_block_from_block_managers_or_computing_and_storing_it_otherwisegetorelseupdate_method"></a><a id="getOrElseUpdate"></a> Getting Block From Block Managers Or Computing and Storing It Otherwise&#8201;&#8212;&#8201;<code>getOrElseUpdate</code> Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">getOrElseUpdate[T](
  blockId: BlockId,
  level: StorageLevel,
  classTag: ClassTag[T],
  makeIterator: () =&gt; Iterator[T]): Either[BlockResult, Iterator[T]]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><em>I think</em> it is fair to say that <code>getOrElseUpdate</code> is like <a href="https://www.scala-lang.org/api/current/scala/collection/mutable/Map.html#getOrElseUpdate(key:K,op:=%3EV):V">getOrElseUpdate</a> of <a href="https://www.scala-lang.org/api/current/scala/collection/mutable/Map.html">scala.collection.mutable.Map</a> in Scala.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">getOrElseUpdate(key: K, op: ⇒ V): V</code></pre>
</div>
</div>
<div class="paragraph">
<p>Quoting the official scaladoc:</p>
</div>
<div class="paragraph">
<p>If given key <code>K</code> is already in this map, <code>getOrElseUpdate</code> returns the associated value <code>V</code>.</p>
</div>
<div class="paragraph">
<p>Otherwise, <code>getOrElseUpdate</code> computes a value <code>V</code> from given expression <code>op</code>, stores with the key <code>K</code> in the map and returns that value.</p>
</div>
<div class="paragraph">
<p>Since <code>BlockManager</code> is a key-value store of blocks of data identified by a block ID that works just fine.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>getOrElseUpdate</code> first attempts to <a href="#get">get the block</a> by the <code>BlockId</code> (from the local block manager first and, if unavailable, requesting remote peers).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Enable <code>INFO</code> logging level for <code>org.apache.spark.storage.BlockManager</code> logger to see what happens when <code>BlockManager</code> tries to <a href="#get">get a block</a>.</p>
</div>
<div class="paragraph">
<p>See <a href="#logging">logging</a> in this document.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>getOrElseUpdate</code> gives the <code>BlockResult</code> of the block if found.</p>
</div>
<div class="paragraph">
<p>If however the block was not found (in any block manager in a Spark cluster), <code>getOrElseUpdate</code> <a href="#doPutIterator">doPutIterator</a> (for the input <code>BlockId</code>, the <code>makeIterator</code> function and the <code>StorageLevel</code>).</p>
</div>
<div class="paragraph">
<p><code>getOrElseUpdate</code> branches off per the result.</p>
</div>
<div class="paragraph">
<p>For <code>None</code>, <code>getOrElseUpdate</code> <a href="#getLocalValues">getLocalValues</a> for the <code>BlockId</code> and eventually returns the <code>BlockResult</code> (unless terminated by a <code>SparkException</code> due to some internal error).</p>
</div>
<div class="paragraph">
<p>For <code>Some(iter)</code>, <code>getOrElseUpdate</code> returns an iterator of <code>T</code> values.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>getOrElseUpdate</code> is used exclusively when <code>RDD</code> is requested to <a href="spark-rdd-RDD.adoc#getOrCompute">get or compute an RDD partition</a> (for a <code>RDDBlockId</code> with a RDD ID and a partition index).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_doputiterator_internal_method"><a class="anchor" href="#_doputiterator_internal_method"></a><a id="doPutIterator"></a> <code>doPutIterator</code> Internal Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">doPutIterator[T](
  blockId: BlockId,
  iterator: () =&gt; Iterator[T],
  level: StorageLevel,
  classTag: ClassTag[T],
  tellMaster: Boolean = true,
  keepReadLock: Boolean = false): Option[PartiallyUnrolledIterator[T]]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>doPutIterator</code> simply <a href="#doPut">doPut</a> with the <code>putBody</code> function that accepts a <code>BlockInfo</code> and does the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>putBody</code> branches off per whether the <code>StorageLevel</code> indicates to use a <a href="spark-rdd-StorageLevel.adoc#useMemory">memory</a> or simply a <a href="spark-rdd-StorageLevel.adoc#useDisk">disk</a>, i.e.</p>
<div class="ulist">
<ul>
<li>
<p>When the input <code>StorageLevel</code> indicates to <a href="spark-rdd-StorageLevel.adoc#useMemory">use a memory</a> for storage in <a href="spark-rdd-StorageLevel.adoc#deserialized">deserialized</a> format, <code>putBody</code> requests <a href="#memoryStore">MemoryStore</a> to <a href="spark-MemoryStore.adoc#putIteratorAsValues">putIteratorAsValues</a> (for the <code>BlockId</code> and with the <code>iterator</code> factory function).</p>
<div class="paragraph">
<p>If the <a href="#memoryStore">MemoryStore</a> returned a correct value, the internal <code>size</code> is set to the value.</p>
</div>
<div class="paragraph">
<p>If however the <a href="#memoryStore">MemoryStore</a> failed to give a correct value, FIXME</p>
</div>
</li>
<li>
<p>When the input <code>StorageLevel</code> indicates to <a href="spark-rdd-StorageLevel.adoc#useMemory">use memory</a> for storage in <a href="spark-rdd-StorageLevel.adoc#deserialized">serialized</a> format, <code>putBody</code>&#8230;&#8203;FIXME</p>
</li>
<li>
<p>When the input <code>StorageLevel</code> does not indicate to use memory for storage but <a href="spark-rdd-StorageLevel.adoc#useDisk">disk</a> instead, <code>putBody</code>&#8230;&#8203;FIXME</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>putBody</code> requests the <a href="#getCurrentBlockStatus">current block status</a></p>
</li>
<li>
<p>Only when the block was successfully stored in either the memory or disk store:</p>
<div class="ulist">
<ul>
<li>
<p><code>putBody</code> <a href="#reportBlockStatus">reports the block status</a> to the <a href="#master">BlockManagerMaster</a> when the input <code>tellMaster</code> flag (default: enabled) and the <code>tellMaster</code> flag of the block info are both enabled.</p>
</li>
<li>
<p><code>putBody</code> <a href="#addUpdatedBlockStatusToTaskMetrics">addUpdatedBlockStatusToTaskMetrics</a> (with the <code>BlockId</code> and <code>BlockStatus</code>)</p>
</li>
<li>
<p><code>putBody</code> prints out the following DEBUG message to the logs:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Put block [blockId] locally took [time] ms</code></pre>
</div>
</div>
</li>
<li>
<p>When the input <code>StorageLevel</code> indicates to use <a href="spark-rdd-StorageLevel.adoc#replication">replication</a>, <code>putBody</code> <a href="#doGetLocalBytes">doGetLocalBytes</a> followed by <a href="#replicate">replicate</a> (with the input <code>BlockId</code> and the <code>StorageLevel</code> as well as the <code>BlockData</code> to replicate)</p>
</li>
<li>
<p>With a successful replication, <code>putBody</code> prints out the following DEBUG message to the logs:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Put block [blockId] remotely took [time] ms</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>In the end, <code>putBody</code> may or may not give a <code>PartiallyUnrolledIterator</code> if&#8230;&#8203;FIXME</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>doPutIterator</code> is used when <code>BlockManager</code> is requested to <a href="#getOrElseUpdate">get a block from block managers or computing and storing it otherwise</a> and <a href="#putIterator">putIterator</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_removing_blocks_from_memory_onlydropfrommemory_method"><a class="anchor" href="#_removing_blocks_from_memory_onlydropfrommemory_method"></a><a id="dropFromMemory"></a> Removing Blocks From Memory Only&#8201;&#8212;&#8201;<code>dropFromMemory</code> Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">dropFromMemory(
  blockId: BlockId,
  data: () =&gt; Either[Array[T], ChunkedByteBuffer]): StorageLevel</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>dropFromMemory</code> is part of the <a href="spark-BlockEvictionHandler.adoc#dropFromMemory">BlockEvictionHandler Contract</a> to&#8230;&#8203;FIXME
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When <code>dropFromMemory</code> is executed, you should see the following INFO message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>INFO BlockManager: Dropping block [blockId] from memory</code></pre>
</div>
</div>
<div class="paragraph">
<p>It then asserts that the <code>blockId</code> block is <a href="spark-BlockInfoManager.adoc#assertBlockIsLockedForWriting">locked for writing</a>.</p>
</div>
<div class="paragraph">
<p>If the block&#8217;s <a href="spark-rdd-StorageLevel.adoc">StorageLevel</a> uses disks and the internal <a href="spark-DiskStore.adoc">DiskStore</a> object (<code>diskStore</code>) does not contain the block, it is saved then. You should see the following INFO message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>INFO BlockManager: Writing block [blockId] to disk</code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME Describe the case with saving a block to disk.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The block&#8217;s memory size is fetched and recorded (using <code>MemoryStore.getSize</code>).</p>
</div>
<div class="paragraph">
<p>The block is <a href="spark-MemoryStore.adoc#remove">removed from memory</a> if exists. If not, you should see the following WARN message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>WARN BlockManager: Block [blockId] could not be dropped from memory as it does not exist</code></pre>
</div>
</div>
<div class="paragraph">
<p>It then <a href="#getCurrentBlockStatus">calculates the current storage status of the block</a> and <a href="#reportBlockStatus">reports it to the driver</a>. It only happens when <code>info.tellMaster</code>.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME When would <code>info.tellMaster</code> be <code>true</code>?
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A block is considered updated when it was written to disk or removed from memory or both. If either happened, the <a href="spark-executor-TaskMetrics.adoc#incUpdatedBlockStatuses">current TaskContext metrics are updated with the change</a>.</p>
</div>
<div class="paragraph">
<p>Ultimately, <code>dropFromMemory</code> returns the current storage level of the block.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_handlelocalreadfailure_internal_method"><a class="anchor" href="#_handlelocalreadfailure_internal_method"></a><a id="handleLocalReadFailure"></a> <code>handleLocalReadFailure</code> Internal Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">handleLocalReadFailure(blockId: BlockId): Nothing</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>handleLocalReadFailure</code>&#8230;&#8203;FIXME</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>handleLocalReadFailure</code> is used when&#8230;&#8203;FIXME
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_releaselockanddispose_method"><a class="anchor" href="#_releaselockanddispose_method"></a><a id="releaseLockAndDispose"></a> <code>releaseLockAndDispose</code> Method</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">releaseLockAndDispose(
  blockId: BlockId,
  data: BlockData,
  taskAttemptId: Option[Long] = None): Unit</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>releaseLockAndDispose</code>&#8230;&#8203;FIXME</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>releaseLockAndDispose</code> is used when&#8230;&#8203;FIXME
</td>
</tr>
</table>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
