<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: The Internals Of Apache Spark</title>
    <link rel="canonical" href="http://alexwangx.github.io/apache-spark-internals/2.4.5/apache-spark-internals/latest/scheduler/TaskSetManager.html">
    <meta name="generator" content="Antora 2.3.1">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-86782445-1"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','UA-86782445-1')</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="http://alexwangx.github.io/apache-spark-internals/2.4.5">The Internals Of Apache Spark</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="apache-spark-internals" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Apache Spark</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rdd/index.html">Resilient Distributed Dataset</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rdd/RDD.html">RDD</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rdd/spark-rdd-CoGroupedRDD.html">CoGroupedRDD</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rdd/spark-rdd-HadoopRDD.html">HadoopRDD</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rdd/spark-rdd-MapPartitionsRDD.html">MapPartitionsRDD</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rdd/spark-rdd-NewHadoopRDD.html">NewHadoopRDD</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rdd/spark-rdd-OrderedRDDFunctions.html">OrderedRDDFunctions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rdd/spark-rdd-ParallelCollectionRDD.html">ParallelCollectionRDD</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rdd/CheckpointRDD.html">CheckpointRDD</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../rdd/ReliableCheckpointRDD.html">ReliableCheckpointRDD</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rdd/ShuffledRDD.html">ShuffledRDD</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rdd/spark-rdd-SubtractedRDD.html">SubtractedRDD</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rdd/spark-rdd-operations.html">Operators</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rdd/spark-rdd-transformations.html">Transformations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../rdd/PairRDDFunctions.html">PairRDDFunctions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rdd/spark-rdd-actions.html">Actions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../rdd/spark-rdd-lineage.html">RDD Lineage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../rdd/spark-rdd-caching.html">Caching and Persistence</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rdd/spark-rdd-partitions.html">Partitions and Partitioning</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rdd/spark-rdd-Partition.html">Partition</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rdd/Partitioner.html">Partitioner</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rdd/HashPartitioner.html">HashPartitioner</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rdd/RangePartitioner.html">RangePartitioner</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rdd/RDDCheckpointData.html">RDDCheckpointData</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rdd/LocalRDDCheckpointData.html">LocalRDDCheckpointData</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rdd/ReliableRDDCheckpointData.html">ReliableRDDCheckpointData</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../rdd/spark-rdd-shuffle.html">Shuffling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rdd/spark-rdd-Dependency.html">Dependencies</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rdd/spark-rdd-NarrowDependency.html">NarrowDependency</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rdd/ShuffleDependency.html">ShuffleDependency</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../rdd/Aggregator.html">Aggregator</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Scheduler</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="DAGScheduler.html">DAGScheduler</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="DAGSchedulerEvent.html">DAGScheduler Events</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="DAGSchedulerEventProcessLoop.html">DAGScheduler Event Bus</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="Stage.html">Stage</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ResultStage.html">ResultStage</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ShuffleMapStage.html">ShuffleMapStage</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="MapOutputTracker.html">MapOutputTracker</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="MapOutputTrackerMaster.html">MapOutputTrackerMaster</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="ShuffleStatus.html">ShuffleStatus</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="MapOutputTrackerMasterEndpoint.html">MapOutputTrackerMasterEndpoint</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="MapOutputTrackerWorker.html">MapOutputTrackerWorker</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-scheduler-StageInfo.html">StageInfo</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-scheduler-JobListener.html">JobListener</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-scheduler-JobWaiter.html">JobWaiter</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="TaskScheduler.html">TaskScheduler</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="TaskSchedulerImpl.html">TaskSchedulerImpl</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="SchedulerBackend.html">SchedulerBackend</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="CoarseGrainedSchedulerBackend.html">CoarseGrainedSchedulerBackend</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="CoarseGrainedSchedulerBackend-DriverEndpoint.html">DriverEndpoint</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="Task.html">Task</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ShuffleMapTask.html">ShuffleMapTask</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ResultTask.html">ResultTask</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="TaskSet.html">TaskSet</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="TaskSetManager.html">TaskSetManager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-scheduler-ActiveJob.html">Jobs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-scheduler-SchedulableBuilder.html">SchedulableBuilder</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-scheduler-FIFOSchedulableBuilder.html">FIFOSchedulableBuilder</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-scheduler-FairSchedulableBuilder.html">FairSchedulableBuilder</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-scheduler-Schedulable.html">Schedulable Entities</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-scheduler-Pool.html">Schedulable Pool</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-scheduler-SchedulingMode.html">Scheduling Mode</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-scheduler-TaskInfo.html">TaskInfo</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="MapStatus.html">MapStatus</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-scheduler-TaskDescription.html">TaskDescription</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-taskschedulerimpl-speculative-execution.html">Speculative Execution of Tasks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="TaskResultGetter.html">TaskResultGetter</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="spark-TaskContext.html">TaskContext</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-BarrierTaskContext.html">BarrierTaskContext</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="spark-TaskContextImpl.html">TaskContextImpl</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-scheduler-TaskResult.html">TaskResults</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spark-scheduler-TaskSetBlacklist.html">TaskSetBlacklist</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="OutputCommitCoordinator.html">OutputCommitCoordinator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="TaskLocation.html">TaskLocation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ExternalClusterManager.html">ExternalClusterManager</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../memory/index.html">Memory System</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../memory/MemoryManager.html">MemoryManager</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../memory/StaticMemoryManager.html">StaticMemoryManager</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../memory/UnifiedMemoryManager.html">UnifiedMemoryManager</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../memory/MemoryPool.html">MemoryPool</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../memory/ExecutionMemoryPool.html">ExecutionMemoryPool</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../memory/StorageMemoryPool.html">StorageMemoryPool</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../memory/TaskMemoryManager.html">TaskMemoryManager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../memory/MemoryConsumer.html">MemoryConsumer</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../memory/BytesToBytesMap.html">BytesToBytesMap</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../memory/UnsafeSorterSpillReader.html">UnsafeSorterSpillReader</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../memory/UnsafeExternalSorter.html">UnsafeExternalSorter</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../memory/UnsafeInMemorySorter.html">UnsafeInMemorySorter</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../memory/UnsafeSorterSpillWriter.html">UnsafeSorterSpillWriter</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Storage System</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/BlockManager.html">BlockManager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/DiskBlockManager.html">DiskBlockManager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/DiskStore.html">DiskStore</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/spark-BlockDataManager.html">BlockDataManager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/spark-BlockId.html">BlockId</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../storage/spark-BlockInfoManager.html">BlockInfoManager</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../storage/spark-BlockInfo.html">BlockInfo</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../storage/BlockManagerMaster.html">BlockManagerMaster</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../storage/spark-blockmanager-BlockManagerMasterEndpoint.html">BlockManagerMasterEndpoint</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/MemoryStore.html">MemoryStore</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/spark-BlockEvictionHandler.html">BlockEvictionHandler</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/spark-blockmanager-BlockManagerSlaveEndpoint.html">BlockManagerSlaveEndpoint</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/DiskBlockObjectWriter.html">DiskBlockObjectWriter</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/spark-BlockManager-BlockManagerSource.html">BlockManagerSource</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/spark-BlockManager-ShuffleMetricsSource.html">ShuffleMetricsSource</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/spark-blockmanager-StorageStatus.html">StorageStatus</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/ShuffleBlockFetcherIterator.html">ShuffleBlockFetcherIterator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/RDDInfo.html">RDDInfo</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/StorageLevel.html">StorageLevel</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../storage/demo-diskblockmanager-and-block-data.html">Demo: DiskBlockManager and Block Data</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../shuffle/index.html">Shuffle System</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../shuffle/ShuffleManager.html">ShuffleManager</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../shuffle/SortShuffleManager.html">SortShuffleManager</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../shuffle/spark-shuffle-ShuffleHandle.html">ShuffleHandle</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../shuffle/spark-shuffle-BaseShuffleHandle.html">BaseShuffleHandle</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../shuffle/BypassMergeSortShuffleHandle.html">BypassMergeSortShuffleHandle</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../shuffle/SerializedShuffleHandle.html">SerializedShuffleHandle</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../shuffle/spark-shuffle-ShuffleReader.html">ShuffleReader</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../shuffle/BlockStoreShuffleReader.html">BlockStoreShuffleReader</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../shuffle/ShuffleWriter.html">ShuffleWriter</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../shuffle/BypassMergeSortShuffleWriter.html">BypassMergeSortShuffleWriter</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../shuffle/SortShuffleWriter.html">SortShuffleWriter</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../shuffle/UnsafeShuffleWriter.html">UnsafeShuffleWriter</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../shuffle/ShuffleExternalSorter.html">ShuffleExternalSorter</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../shuffle/ShuffleInMemorySorter.html">ShuffleInMemorySorter</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../shuffle/ShuffleBlockResolver.html">ShuffleBlockResolver</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../shuffle/IndexShuffleBlockResolver.html">IndexShuffleBlockResolver</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../shuffle/FetchFailedException.html">FetchFailedException</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../shuffle/Spillable.html">Spillable</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../shuffle/ExternalAppendOnlyMap.html">ExternalAppendOnlyMap</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../shuffle/ExternalSorter.html">ExternalSorter</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../spark-overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../SparkConf.html">SparkConf</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-properties.html">Spark Properties and spark-defaults.conf Properties File</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-deploy-mode.html">Deploy Mode</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../SparkContext.html">SparkContext</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-HeartbeatReceiver.html">HeartbeatReceiver RPC Endpoint</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-SparkContext-creating-instance-internals.html">Inside Creating SparkContext</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-sparkcontext-ConsoleProgressBar.html">ConsoleProgressBar</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-sparkcontext-SparkStatusTracker.html">SparkStatusTracker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-sparkcontext-local-properties.html">Local Properties</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../rdd-checkpointing.html">RDD Checkpointing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-dynamic-allocation.html">Dynamic Allocation of Executors</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-ExecutorAllocationManager.html">ExecutorAllocationManager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-service-ExecutorAllocationClient.html">ExecutorAllocationClient</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-service-ExecutorAllocationManagerSource.html">ExecutorAllocationManagerSource</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Shared Variables</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-broadcast.html">Broadcast variables</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-accumulators.html">Accumulators</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-AccumulatorContext.html">AccumulatorContext</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../spark-data-locality.html">Data Locality</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-architecture.html">Spark Architecture</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-driver.html">Driver</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-master.html">Master</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-workers.html">Workers</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../configuration-properties.html">Configuration Properties</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../spark-anatomy-spark-application.html">Anatomy of Spark Application</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Internal IO</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-internal-io-SparkHadoopWriter.html">SparkHadoopWriter</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-internal-io-FileCommitProtocol.html">FileCommitProtocol</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../spark-internal-io-HadoopMapReduceCommitProtocol.html">HadoopMapReduceCommitProtocol</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../spark-internal-io-HadoopMapRedCommitProtocol.html">HadoopMapRedCommitProtocol</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-internal-io-HadoopWriteConfigUtil.html">HadoopWriteConfigUtil</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../spark-internal-io-HadoopMapReduceWriteConfigUtil.html">HadoopMapReduceWriteConfigUtil</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../spark-internal-io-HadoopMapRedWriteConfigUtil.html">HadoopMapRedWriteConfigUtil</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Misc</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-core-AppStatusStore.html">AppStatusStore</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-core-AppStatusPlugin.html">AppStatusPlugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-core-KVStore.html">KVStore</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-core-KVStoreView.html">KVStoreView</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-core-ElementTrackingStore.html">ElementTrackingStore</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-core-InMemoryStore.html">InMemoryStore</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-core-LevelDB.html">LevelDB</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-InterruptibleIterator.html">InterruptibleIterator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-Utils.html">Utils Helper Object</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-barrier-execution-mode.html">Barrier Execution Mode</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-RDDBarrier.html">RDDBarrier</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-webui-security.html">Securing Web UI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-deployment-environments.html">Deployment Environments</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-cluster.html">Spark on cluster</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Monitoring, Tuning, Debugging and Testing</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-logging.html">Logging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-tuning.html">Performance Tuning</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-scheduler-SparkListener.html">SparkListener</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-SparkListener-AppStatusListener.html">AppStatusListener</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-SparkListener-ExecutorAllocationListener.html">ExecutorAllocationListener</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-SparkListener-SpillListener.html">SpillListener</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-SparkListener-StatsReportListener.html">StatsReportListener</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-scheduler-LiveListenerBus.html">LiveListenerBus</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-SparkListenerBus.html">SparkListenerBus</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-SparkListenerBus-AsyncEventQueue.html">AsyncEventQueue</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-SparkListenerBus-ReplayListenerBus.html">ReplayListenerBus</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-JsonProtocol.html">JsonProtocol</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-debugging.html">Debugging Spark</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Varia</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../varia/spark-building-from-sources.html">Building Apache Spark from Sources</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../varia/spark-hadoop.html">Spark and Hadoop</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-SparkHadoopUtil.html">SparkHadoopUtil</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../varia/spark-inmemory-filesystems.html">Spark and software in-memory file systems</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../varia/spark-others.html">Spark and The Others</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../varia/spark-deeplearning.html">Distributed Deep Learning on Spark</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../varia/spark-packages.html">Spark Packages</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-tips-and-tricks.html">Spark Tips and Tricks</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-tips-and-tricks-access-private-members-spark-shell.html">Access private members in Scala in Spark shell</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-tips-and-tricks-sparkexception-task-not-serializable.html">SparkException: Task not serializable</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-tips-and-tricks-running-spark-windows.html">Running Spark Applications on Windows</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Core Services</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core/SparkEnv.html">SparkEnv</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../core/BroadcastManager.html">BroadcastManager</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../core/BroadcastFactory.html">BroadcastFactory</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../core/TorrentBroadcastFactory.html">TorrentBroadcastFactory</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../core/TorrentBroadcast.html">TorrentBroadcast</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../core/ContextCleaner.html">ContextCleaner</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../core/CleanerListener.html">CleanerListener</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../core/ShuffleClient.html">ShuffleClient</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../core/BlockTransferService.html">BlockTransferService</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../core/ExternalShuffleClient.html">ExternalShuffleClient</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../core/NettyBlockTransferService.html">NettyBlockTransferService</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../core/NettyBlockRpcServer.html">NettyBlockRpcServer</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core/BlockFetchingListener.html">BlockFetchingListener</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../core/RetryingBlockFetcher.html">RetryingBlockFetcher</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../core/BlockFetchStarter.html">BlockFetchStarter</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../executor/Executor.html">Executor</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../executor/TaskRunner.html">TaskRunner</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../executor/ExecutorSource.html">ExecutorSource</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../executor/ExecutorBackend.html">ExecutorBackend</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../executor/CoarseGrainedExecutorBackend.html">CoarseGrainedExecutorBackend</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../executor/TaskMetrics.html">TaskMetrics</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../executor/ShuffleWriteMetrics.html">ShuffleWriteMetrics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../executor/ShuffleReadMetrics.html">ShuffleReadMetrics</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rpc/index.html">RPC System</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rpc/RpcEnv.html">RpcEnv</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rpc/NettyRpcEnv.html">NettyRpcEnv</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../rpc/NettyStreamManager.html">NettyStreamManager</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../rpc/RpcEnvConfig.html">RpcEnvConfig</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../rpc/RpcEndpoint.html">RpcEndpoint</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../rpc/RpcEndpointRef.html">RpcEndpointRef</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../rpc/RpcAddress.html">RpcAddress</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../rpc/RpcEndpointAddress.html">RpcEndpointAddress</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rpc/RpcEnvFactory.html">RpcEnvFactory</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rpc/NettyRpcEnvFactory.html">NettyRpcEnvFactory</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../rpc/RpcEnvFileServer.html">RpcEnvFileServer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../rpc/spark-rpc-netty.html">Netty-based RpcEnv</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../rpc/RpcUtils.html">RpcUtils</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Network System</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../network/TransportContext.html">TransportContext</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../network/MessageHandler.html">MessageHandler</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../network/TransportRequestHandler.html">TransportRequestHandler</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../network/TransportConf.html">TransportConf</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../network/SparkTransportConf.html">SparkTransportConf</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../network/TransportClientFactory.html">TransportClientFactory</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../network/TransportServer.html">TransportServer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../network/RpcHandler.html">RpcHandler</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../network/StreamManager.html">StreamManager</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../network/OneForOneStreamManager.html">OneForOneStreamManager</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../network/ManagedBuffer.html">ManagedBuffer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../network/RpcResponseCallback.html">RpcResponseCallback</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../deploy/ExternalShuffleService.html">External Shuffle Service</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploy/ExternalShuffleBlockHandler.html">ExternalShuffleBlockHandler</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploy/ExternalShuffleBlockResolver.html">ExternalShuffleBlockResolver</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../io/CompressionCodec.html">CompressionCodec</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../serializer/index.html">Serialization System</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../serializer/SerializerManager.html">SerializerManager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../serializer/Serializer.html">Serializer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../serializer/SerializerInstance.html">SerializerInstance</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../serializer/SerializationStream.html">SerializationStream</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../serializer/DeserializationStream.html">DeserializationStream</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Tools</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tools/spark-shell.html">Spark Shell (spark-shell)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../tools/spark-submit.html">Spark Submit (spark-submit)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tools/spark-submit-SparkSubmitArguments.html">SparkSubmitArguments</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tools/spark-submit-SparkSubmitOptionParser.html">SparkSubmitOptionParser</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tools/spark-submit-SparkSubmitCommandBuilder.html">SparkSubmitCommandBuilder</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../tools/spark-class.html">spark-class shell script</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tools/spark-AbstractCommandBuilder.html">AbstractCommandBuilder</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tools/spark-SparkLauncher.html">SparkLauncher</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../webui/index.html">Web UI</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../webui/spark-webui-jobs.html">Jobs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../webui/spark-webui-JobsTab.html">JobsTab</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../webui/spark-webui-AllJobsPage.html">AllJobsPage</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../webui/spark-webui-JobPage.html">JobPage</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../webui/spark-webui-stages.html">Stages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../webui/spark-webui-storage.html">Storage</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../webui/spark-webui-environment.html">Environment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../webui/spark-webui-executors.html">Executors</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../webui/spark-webui-StagesTab.html">StagesTab&#8201;&#8212;&#8201;Stages for All Jobs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../webui/spark-webui-AllStagesPage.html">AllStagesPage&#8201;&#8212;&#8201;Stages for All Jobs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../webui/spark-webui-StagePage.html">StagePage&#8201;&#8212;&#8201;Stage Details</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../webui/spark-webui-PoolPage.html">PoolPage&#8201;&#8212;&#8201;Pool Details</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../webui/spark-webui-StorageTab.html">StorageTab</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../webui/spark-webui-StoragePage.html">StoragePage</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../webui/spark-webui-RDDPage.html">RDDPage</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../webui/spark-webui-EnvironmentTab.html">EnvironmentTab</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../webui/spark-webui-EnvironmentPage.html">EnvironmentPage</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../webui/spark-webui-ExecutorsTab.html">ExecutorsTab</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../webui/spark-webui-ExecutorsPage.html">ExecutorsPage</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../webui/spark-webui-ExecutorThreadDumpPage.html">ExecutorThreadDumpPage</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../webui/spark-webui-SparkUI.html">SparkUI&#8201;&#8212;&#8201;Web UI of Spark Application</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../webui/spark-webui-SparkUITab.html">SparkUITab</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../webui/spark-webui-BlockStatusListener.html">BlockStatusListener Spark Listener</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../webui/spark-webui-EnvironmentListener.html">EnvironmentListener Spark Listener</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../webui/spark-webui-executors-ExecutorsListener.html">ExecutorsListener Spark Listener</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../webui/spark-webui-JobProgressListener.html">JobProgressListener Spark Listener</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../webui/spark-webui-StorageStatusListener.html">StorageStatusListener Spark Listener</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../webui/spark-webui-StorageListener.html">StorageListener&#8201;&#8212;&#8201;Spark Listener for Tracking Persistence Status of RDD Blocks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../webui/spark-webui-RDDOperationGraphListener.html">RDDOperationGraphListener Spark Listener</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../webui/spark-webui-WebUI.html">WebUI&#8201;&#8212;&#8201;Framework For Web UIs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../webui/spark-webui-WebUIPage.html">WebUIPage&#8201;&#8212;&#8201;Contract of Pages in Web UI</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../webui/spark-webui-WebUITab.html">WebUITab&#8201;&#8212;&#8201;Contract of Tabs in Web UI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../webui/spark-webui-RDDStorageInfo.html">RDDStorageInfo</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../webui/spark-core-LiveEntity.html">LiveEntity</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../webui/spark-core-LiveRDD.html">LiveRDD</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../webui/spark-webui-UIUtils.html">UIUtils</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../webui/spark-webui-JettyUtils.html">JettyUtils</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../webui/spark-webui-properties.html">web UI Configuration Properties</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../metrics/index.html">Spark Metrics</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../metrics/spark-metrics-MetricsSystem.html">MetricsSystem</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../metrics/spark-metrics-MetricsConfig.html">MetricsConfig</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../metrics/spark-metrics-Source.html">Source</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../metrics/spark-scheduler-DAGSchedulerSource.html">DAGSchedulerSourcer</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../metrics/spark-metrics-Sink.html">Sink</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../metrics/spark-metrics-MetricsServlet.html">MetricsServlet JSON Metrics Sink</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../metrics/spark-metrics-properties.html">Metrics Configuration Properties</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-mllib/index.html">Spark MLlib</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-mllib/spark-mllib-pipelines.html">ML Pipelines (spark.ml)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-mllib/spark-mllib-Pipeline.html">Pipeline</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-mllib/spark-mllib-PipelineStage.html">PipelineStage</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-mllib/spark-mllib-transformers.html">Transformers</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../spark-mllib/spark-mllib-Transformer.html">Transformer</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../spark-mllib/spark-mllib-transformers-Tokenizer.html">Tokenizer</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-mllib/spark-mllib-estimators.html">Estimators</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-mllib/spark-mllib-Estimator.html">Estimator</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../spark-mllib/spark-mllib-StringIndexer.html">StringIndexer</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../spark-mllib/spark-mllib-KMeans.html">KMeans</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../spark-mllib/spark-mllib-TrainValidationSplit.html">TrainValidationSplit</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-mllib/spark-mllib-Predictor.html">Predictor</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../spark-mllib/spark-mllib-RandomForestRegressor.html">RandomForestRegressor</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-mllib/spark-mllib-Regressor.html">Regressor</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../spark-mllib/spark-mllib-LinearRegression.html">LinearRegression</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-mllib/spark-mllib-Classifier.html">Classifier</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../spark-mllib/spark-mllib-RandomForestClassifier.html">RandomForestClassifier</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../spark-mllib/spark-mllib-DecisionTreeClassifier.html">DecisionTreeClassifier</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-mllib/spark-mllib-models.html">Models</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../spark-mllib/spark-mllib-Model.html">Model</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-mllib/spark-mllib-Evaluator.html">Evaluator&#8201;&#8212;&#8201;ML Pipeline Component for Model Scoring</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../spark-mllib/spark-mllib-BinaryClassificationEvaluator.html">BinaryClassificationEvaluator&#8201;&#8212;&#8201;Evaluator of Binary Classification Models</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../spark-mllib/spark-mllib-ClusteringEvaluator.html">ClusteringEvaluator&#8201;&#8212;&#8201;Evaluator of Clustering Models</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../spark-mllib/spark-mllib-MulticlassClassificationEvaluator.html">MulticlassClassificationEvaluator&#8201;&#8212;&#8201;Evaluator of Multiclass Classification Models</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../spark-mllib/spark-mllib-RegressionEvaluator.html">RegressionEvaluator&#8201;&#8212;&#8201;Evaluator of Regression Models</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-mllib/spark-mllib-CrossValidator.html">CrossValidator&#8201;&#8212;&#8201;Model Tuning / Finding The Best Model</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../spark-mllib/spark-mllib-CrossValidatorModel.html">CrossValidatorModel</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../spark-mllib/spark-mllib-ParamGridBuilder.html">ParamGridBuilder</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../spark-mllib/spark-mllib-CrossValidator-example.html">CrossValidator with Pipeline Example</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-mllib/spark-mllib-Params.html">Params and ParamMaps</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../spark-mllib/spark-mllib-ValidatorParams.html">ValidatorParams</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../spark-mllib/spark-mllib-HasParallelism.html">HasParallelism</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-mllib/spark-mllib-pipelines-persistence.html">ML Persistence&#8201;&#8212;&#8201;Saving and Loading Models and Pipelines</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-mllib/spark-mllib-MLWritable.html">MLWritable</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-mllib/spark-mllib-MLReader.html">MLReader</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-mllib/spark-mllib-pipelines-example-classification.html">Example&#8201;&#8212;&#8201;Text Classification</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-mllib/spark-mllib-pipelines-example-regression.html">Example&#8201;&#8212;&#8201;Linear Regression</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-mllib/spark-mllib-logistic-regression.html">Logistic Regression</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-mllib/spark-mllib-LogisticRegression.html">LogisticRegression</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-mllib/spark-mllib-latent-dirichlet-allocation.html">Latent Dirichlet Allocation (LDA)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-mllib/spark-mllib-vector.html">Vector</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-mllib/spark-mllib-labeledpoint.html">LabeledPoint</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-mllib/spark-mllib-streaming.html">Streaming MLlib</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-mllib/spark-mllib-GeneralizedLinearRegression.html">GeneralizedLinearRegression</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-mllib/spark-mllib-alternating-least-squares.html">Alternating Least Squares (ALS) Matrix Factorization</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-mllib/spark-mllib-ALS.html">ALS&#8201;&#8212;&#8201;Estimator for ALSModel</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-mllib/spark-mllib-ALSModel.html">ALSModel&#8201;&#8212;&#8201;Model for Predictions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-mllib/spark-mllib-ALSModelReader.html">ALSModelReader</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-mllib/spark-mllib-Instrumentation.html">Instrumentation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-mllib/spark-mllib-MLUtils.html">MLUtils</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-history-server/index.html">Spark History Server</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration-properties.html">Configuration Properties</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-history-server/HistoryServer.html">HistoryServer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-history-server/EventLoggingListener.html">EventLoggingListener</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-history-server/SQLHistoryListener.html">SQLHistoryListener</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-history-server/ApplicationHistoryProvider.html">ApplicationHistoryProvider</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-history-server/FsHistoryProvider.html">FsHistoryProvider</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-history-server/HistoryServerArguments.html">HistoryServerArguments</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-history-server/ApplicationCacheOperations.html">ApplicationCacheOperations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-history-server/ApplicationCache.html">ApplicationCache</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-local/index.html">Spark local</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-local/spark-LocalSchedulerBackend.html">LocalSchedulerBackend</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-local/spark-LocalEndpoint.html">LocalEndpoint&#8201;&#8212;&#8201;RPC Endpoint for LocalSchedulerBackend</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-local/spark-LauncherBackend.html">LauncherBackend</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-on-yarn/index.html">Spark on YARN</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-on-yarn/spark-yarn-YarnShuffleService.html">YarnShuffleService&#8201;&#8212;&#8201;ExternalShuffleService on YARN</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-on-yarn/spark-yarn-ExecutorRunnable.html">ExecutorRunnable</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-on-yarn/spark-yarn-client.html">Client</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-on-yarn/spark-yarn-yarnrmclient.html">YarnRMClient</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-on-yarn/spark-yarn-applicationmaster.html">ApplicationMaster</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-on-yarn/spark-yarn-AMEndpoint.html">AMEndpoint&#8201;&#8212;&#8201;ApplicationMaster RPC Endpoint</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-on-yarn/spark-yarn-YarnClusterManager.html">YarnClusterManager&#8201;&#8212;&#8201;ExternalClusterManager for YARN</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-on-yarn/spark-yarn-taskschedulers.html">TaskSchedulers for YARN</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-on-yarn/spark-yarn-yarnscheduler.html">YarnScheduler</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-on-yarn/spark-yarn-yarnclusterscheduler.html">YarnClusterScheduler</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-on-yarn/spark-yarn-schedulerbackends.html">SchedulerBackends for YARN</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-on-yarn/spark-yarn-yarnschedulerbackend.html">YarnSchedulerBackend</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-on-yarn/spark-yarn-client-yarnclientschedulerbackend.html">YarnClientSchedulerBackend</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-on-yarn/spark-yarn-cluster-yarnclusterschedulerbackend.html">YarnClusterSchedulerBackend</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-on-yarn/spark-yarn-cluster-YarnSchedulerEndpoint.html">YarnSchedulerEndpoint RPC Endpoint</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-on-yarn/spark-yarn-YarnAllocator.html">YarnAllocator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-on-yarn/spark-yarn-introduction.html">Introduction to Hadoop YARN</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-on-yarn/spark-yarn-cluster-setup.html">Setting up YARN Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-on-yarn/spark-yarn-kerberos.html">Kerberos</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-on-yarn/spark-yarn-ConfigurableCredentialManager.html">ConfigurableCredentialManager</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-on-yarn/spark-yarn-ClientDistributedCacheManager.html">ClientDistributedCacheManager</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-on-yarn/spark-yarn-YarnSparkHadoopUtil.html">YarnSparkHadoopUtil</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-on-yarn/spark-yarn-settings.html">Settings</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-standalone/index.html">Spark Standalone</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-standalone/spark-standalone-Master.html">Standalone Master&#8201;&#8212;&#8201;Cluster Manager of Spark Standalone</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-standalone/spark-standalone-worker.html">Standalone Worker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-standalone/spark-standalone-webui.html">web UI</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../spark-standalone/spark-standalone-webui-ApplicationPage.html">ApplicationPage</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-standalone/spark-standalone-LocalSparkCluster.html">LocalSparkCluster&#8201;&#8212;&#8201;Single-JVM Spark Standalone Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-standalone/spark-standalone-submission-gateways.html">Submission Gateways</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-standalone/spark-standalone-master-scripts.html">Management Scripts for Standalone Master</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-standalone/spark-standalone-worker-scripts.html">Management Scripts for Standalone Workers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-standalone/spark-standalone-status.html">Checking Status</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-standalone/spark-standalone-example-2-workers-on-1-node-cluster.html">Example 2-workers-on-1-node Standalone Cluster (one executor per worker)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-standalone/spark-standalone-StandaloneSchedulerBackend.html">StandaloneSchedulerBackend</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rest-api/index.html">Status REST API</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rest-api/spark-api-ApiRootResource.html">ApiRootResource&#8201;&#8212;&#8201;/api/v1 URI Handler</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rest-api/spark-api-ApplicationListResource.html">ApplicationListResource&#8201;&#8212;&#8201;applications URI Handler</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rest-api/spark-api-OneApplicationResource.html">OneApplicationResource&#8201;&#8212;&#8201;applications/appId URI Handler</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../rest-api/spark-api-StagesResource.html">StagesResource</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rest-api/spark-api-OneApplicationAttemptResource.html">OneApplicationAttemptResource</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../rest-api/spark-api-AbstractApplicationResource.html">AbstractApplicationResource</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../rest-api/spark-api-BaseAppResource.html">BaseAppResource</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../rest-api/spark-api-ApiRequestContext.html">ApiRequestContext</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../rest-api/spark-api-UIRoot.html">UIRoot&#8201;&#8212;&#8201;Contract for Root Contrainers of Application UI Information</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../rest-api/spark-api-UIRootFromServletContext.html">UIRootFromServletContext</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../spark-on-mesos/index.html">Spark on Mesos</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-on-mesos/spark-mesos-MesosCoarseGrainedSchedulerBackend.html">MesosCoarseGrainedSchedulerBackend</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-on-mesos/spark-mesos-introduction.html">About Mesos</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../spark-on-mesos/spark-executor-backends-MesosExecutorBackend.html">MesosExecutorBackend</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Exercises</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../exercises/spark-exercise-pairrddfunctions-oneliners.html">One-liners using PairRDDFunctions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../exercises/spark-exercise-take-multiple-jobs.html">Learning Jobs and Partitions Using take Action</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../exercises/spark-exercise-standalone-master-ha.html">Spark Standalone - Using ZooKeeper for High-Availability of Master</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../exercises/spark-hello-world-using-spark-shell.html">Spark&#8217;s Hello World using Spark shell and Scala</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../exercises/spark-examples-wordcount-spark-shell.html">WordCount using Spark shell</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../exercises/spark-first-app.html">Your first complete Spark application (using Scala and sbt)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../exercises/spark-sql-hive-orc-example.html">Using Spark SQL to update data in Hive using ORC files</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../exercises/spark-exercise-custom-scheduler-listener.html">Developing Custom SparkListener to monitor DAGScheduler in Scala</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../exercises/spark-exercise-custom-rdd.html">Developing Custom RDD</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../exercises/spark-exercise-dataframe-jdbc-postgresql.html">Working with Datasets from JDBC Data Sources (and PostgreSQL)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../exercises/spark-exercise-failing-stage.html">Causing Stage to Fail</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Apache Spark</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Apache Spark</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Apache Spark</a></li>
    <li><a href="index.html">Scheduler</a></li>
    <li><a href="TaskSetManager.html">TaskSetManager</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///Users/alex/Alex/_Code/GitBook/mastering-apache-spark-book-cn/modules/scheduler/pages/TaskSetManager.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<div class="sect1">
<h2 id="tasksetmanager"><a class="anchor" href="#tasksetmanager"></a><a class="link" href="#tasksetmanager"><a id="TaskSetManager"></a> TaskSetManager</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>TaskSetManager</code> is a <a href="#schedulable">Schedulable</a> that manages scheduling of tasks of a <a href="#taskSet">TaskSet</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A <a href="TaskSet.html" class="page">TaskSet</a> represents a set of <a href="Task.html" class="page">tasks</a> that correspond to missing <a href="spark-rdd-partitions.adoc">partitions</a> of a <a href="Stage.html" class="page">stage</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>TaskSetManager</code> is <a href="#creating-instance">created</a> exclusively when <code>TaskSchedulerImpl</code> is requested to <a href="TaskSchedulerImpl.html#createTaskSetManager" class="page">create one</a> (when submitting tasks for a given <code>TaskSet</code>).</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/TaskSetManager-TaskSchedulerImpl-TaskSet.png" alt="TaskSetManager TaskSchedulerImpl TaskSet">
</div>
<div class="title">Figure 1. TaskSetManager and its Dependencies</div>
</div>
<div class="paragraph">
<p>When <a href="#creating-instance">created</a> with a given <a href="#taskSet">TaskSet</a>, <code>TaskSetManager</code> <a href="#addPendingTask">registers all the tasks as pending execution</a>.</p>
</div>
<div class="paragraph">
<p><code>TaskSetManager</code> is notified when a task (from the <code>TaskSet</code> it manages) finishes&#8201;&#8212;&#8201;<a href="#handleSuccessfulTask">sucessfully</a> or due to a <a href="#handleFailedTask">failure</a> (in task execution or <a href="#executorLost">an executor being lost</a>).</p>
</div>
<div class="paragraph">
<p><code>TaskSetManager</code> uses <a href="#maxTaskFailures">maxTaskFailures</a> to control how many times a <a href="#handleFailedTask">single task can fail</a> before an <a href="#abort">entire <code>TaskSet</code> gets aborted</a> that can take the following values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>1</code> for <a href="local/spark-local.adoc"><code>local</code> run mode</a></p>
</li>
<li>
<p><code>maxFailures</code> in <a href="local/spark-local.adoc#local-with-retries">Spark local-with-retries</a> (i.e. <code>local[N, maxFailures]</code>)</p>
</li>
<li>
<p><a href="../configuration-properties.html#spark.task.maxFailures" class="page">spark.task.maxFailures</a> configuration property for <a href="local/spark-local.adoc">Spark local-cluster</a> and <a href="spark-cluster.adoc">Spark clustered</a> (using Spark Standalone, Mesos and YARN)</p>
</li>
</ul>
</div>
<div id="maxResultSize" class="paragraph">
<p><code>TaskSetManager</code> uses <a href="../configuration-properties.html#MAX_RESULT_SIZE" class="page">spark.driver.maxResultSize</a> configuration property (default: <code>1g</code>) to <a href="#canFetchMoreResults">check available memory for task results</a>.</p>
</div>
<div class="paragraph">
<p>The responsibilities of a <code>TaskSetManager</code> include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#scheduling-tasks">Scheduling the tasks in a taskset</a></p>
</li>
<li>
<p><a href="#task-retries">Retrying tasks on failure</a></p>
</li>
<li>
<p><a href="#locality-aware-scheduling">Locality-aware scheduling via delay scheduling</a></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Enable <code>DEBUG</code> logging level for <code>org.apache.spark.scheduler.TaskSchedulerImpl</code> (or <code>org.apache.spark.scheduler.cluster.YarnScheduler</code> for YARN) and <code>org.apache.spark.scheduler.TaskSetManager</code> and execute the following two-stage job to see their low-level innerworkings.</p>
</div>
<div class="paragraph">
<p>A cluster manager is recommended since it gives more task localization choices (with YARN additionally supporting rack localization).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ ./bin/spark-shell --master yarn --conf spark.ui.showConsoleProgress=false

// Keep # partitions low to keep # messages low
scala&gt; sc.parallelize(0 to 9, 3).groupBy(_ % 3).count
INFO YarnScheduler: Adding task set 0.0 with 3 tasks
DEBUG TaskSetManager: Epoch for TaskSet 0.0: 0
DEBUG TaskSetManager: Valid locality levels for TaskSet 0.0: NO_PREF, ANY
DEBUG YarnScheduler: parentName: , name: TaskSet_0.0, runningTasks: 0
INFO TaskSetManager: Starting task 0.0 in stage 0.0 (TID 0, 10.0.2.87, executor 1, partition 0, PROCESS_LOCAL, 7541 bytes)
INFO TaskSetManager: Starting task 1.0 in stage 0.0 (TID 1, 10.0.2.87, executor 2, partition 1, PROCESS_LOCAL, 7541 bytes)
DEBUG YarnScheduler: parentName: , name: TaskSet_0.0, runningTasks: 1
INFO TaskSetManager: Starting task 2.0 in stage 0.0 (TID 2, 10.0.2.87, executor 1, partition 2, PROCESS_LOCAL, 7598 bytes)
DEBUG YarnScheduler: parentName: , name: TaskSet_0.0, runningTasks: 1
DEBUG TaskSetManager: No tasks for locality level NO_PREF, so moving to locality level ANY
INFO TaskSetManager: Finished task 0.0 in stage 0.0 (TID 0) in 518 ms on 10.0.2.87 (executor 1) (1/3)
INFO TaskSetManager: Finished task 1.0 in stage 0.0 (TID 1) in 512 ms on 10.0.2.87 (executor 2) (2/3)
DEBUG YarnScheduler: parentName: , name: TaskSet_0.0, runningTasks: 0
INFO TaskSetManager: Finished task 2.0 in stage 0.0 (TID 2) in 51 ms on 10.0.2.87 (executor 1) (3/3)
INFO YarnScheduler: Removed TaskSet 0.0, whose tasks have all completed, from pool
INFO YarnScheduler: Adding task set 1.0 with 3 tasks
DEBUG TaskSetManager: Epoch for TaskSet 1.0: 1
DEBUG TaskSetManager: Valid locality levels for TaskSet 1.0: NODE_LOCAL, RACK_LOCAL, ANY
DEBUG YarnScheduler: parentName: , name: TaskSet_1.0, runningTasks: 0
INFO TaskSetManager: Starting task 0.0 in stage 1.0 (TID 3, 10.0.2.87, executor 2, partition 0, NODE_LOCAL, 7348 bytes)
INFO TaskSetManager: Starting task 1.0 in stage 1.0 (TID 4, 10.0.2.87, executor 1, partition 1, NODE_LOCAL, 7348 bytes)
DEBUG YarnScheduler: parentName: , name: TaskSet_1.0, runningTasks: 1
INFO TaskSetManager: Starting task 2.0 in stage 1.0 (TID 5, 10.0.2.87, executor 1, partition 2, NODE_LOCAL, 7348 bytes)
INFO TaskSetManager: Finished task 1.0 in stage 1.0 (TID 4) in 130 ms on 10.0.2.87 (executor 1) (1/3)
DEBUG YarnScheduler: parentName: , name: TaskSet_1.0, runningTasks: 1
DEBUG TaskSetManager: No tasks for locality level NODE_LOCAL, so moving to locality level RACK_LOCAL
DEBUG TaskSetManager: No tasks for locality level RACK_LOCAL, so moving to locality level ANY
INFO TaskSetManager: Finished task 0.0 in stage 1.0 (TID 3) in 133 ms on 10.0.2.87 (executor 2) (2/3)
DEBUG YarnScheduler: parentName: , name: TaskSet_1.0, runningTasks: 0
INFO TaskSetManager: Finished task 2.0 in stage 1.0 (TID 5) in 21 ms on 10.0.2.87 (executor 1) (3/3)
INFO YarnScheduler: Removed TaskSet 1.0, whose tasks have all completed, from pool
res0: Long = 3</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<table id="internal-registries" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. TaskSetManager&#8217;s Internal Properties (e.g. Registries, Counters and Flags)</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="allPendingTasks"></a> <code>allPendingTasks</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indices of all the pending tasks to execute (regardless of their localization preferences).</p>
<p class="tableblock">Updated with an task index when <code>TaskSetManager</code> <a href="#addPendingTask">registers a task as pending execution (per preferred locations)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="calculatedTasks"></a> <code>calculatedTasks</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of the tasks that have already completed execution.</p>
<p class="tableblock">Starts from <code>0</code> when a <a href="#creating-instance"><code>TaskSetManager</code> is created</a> and is only incremented when the <a href="#canFetchMoreResults"><code>TaskSetManager</code> checks that there is enough memory to fetch a task result</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="copiesRunning"></a> <code>copiesRunning</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of task copies currently running per task (index in its task set).</p>
<p class="tableblock">The number of task copies of a task is increased when <a href="#resourceOffer">finds a task for execution (given resource offer)</a> or <a href="#checkSpeculatableTasks">checking for speculatable tasks</a> and decreased when <a href="#handleFailedTask">a task fails</a> or <a href="#executorLost">an executor is lost</a> (for a shuffle map stage and no external shuffle service).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="currentLocalityIndex"></a> <code>currentLocalityIndex</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="epoch"></a> <code>epoch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current <a href="MapOutputTracker.html#getEpoch" class="page">map output tracker epoch</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="failedExecutors"></a> <code>failedExecutors</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lookup table of <a href="spark-scheduler-TaskInfo.adoc">TaskInfo</a> indices that failed to executor ids and the time of the failure.</p>
<p class="tableblock">Used in <a href="#handleFailedTask">handleFailedTask</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="isZombie"></a> <code>isZombie</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled, i.e. <code>false</code>, by default.</p>
<p class="tableblock">Read <a href="#zombie-state">Zombie state</a> in this document.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="lastLaunchTime"></a> <code>lastLaunchTime</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="localityWaits"></a> <code>localityWaits</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="myLocalityLevels"></a> <code>myLocalityLevels</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="TaskSchedulerImpl.html#TaskLocality" class="page"><code>TaskLocality</code> locality preferences</a> of the pending tasks in the <a href="#taskSet">TaskSet</a> ranging from <code>PROCESS_LOCAL</code> through <code>NODE_LOCAL</code>, <code>NO_PREF</code>, and <code>RACK_LOCAL</code> to <code>ANY</code>.</p>
<p class="tableblock">NOTE: <code>myLocalityLevels</code> may contain only a few of all the available <code>TaskLocality</code> preferences with <code>ANY</code> as a mandatory task locality preference.</p>
<p class="tableblock"><a href="#computeValidLocalityLevels">Set</a> immediately when <a href="#creating-instance"><code>TaskSetManager</code> is created</a>.</p>
<p class="tableblock"><a href="#recomputeLocality">Recomputed</a> every change in the status of executors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="name"></a> <code>name</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="numFailures"></a> <code>numFailures</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array of the number of task failures per <a href="#tasks">task</a>.</p>
<p class="tableblock">Incremented when <code>TaskSetManager</code> <a href="#handleFailedTask">handles a task failure</a> and immediatelly checked if above <a href="#maxTaskFailures">acceptable number of task failures</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="numTasks"></a> <code>numTasks</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of <a href="#tasks">tasks</a> to compute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="pendingTasksForExecutor"></a> <code>pendingTasksForExecutor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lookup table of the indices of tasks pending execution per executor.</p>
<p class="tableblock">Updated with an task index and executor when <code>TaskSetManager</code> <a href="#addPendingTask">registers a task as pending execution (per preferred locations)</a> (and the location is a <code>ExecutorCacheTaskLocation</code> or <code>HDFSCacheTaskLocation</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="pendingTasksForHost"></a> <code>pendingTasksForHost</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lookup table of the indices of tasks pending execution per host.</p>
<p class="tableblock">Updated with an task index and host when <code>TaskSetManager</code> <a href="#addPendingTask">registers a task as pending execution (per preferred locations)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="pendingTasksForRack"></a> <code>pendingTasksForRack</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lookup table of the indices of tasks pending execution per rack.</p>
<p class="tableblock">Updated with an task index and rack when <code>TaskSetManager</code> <a href="#addPendingTask">registers a task as pending execution (per preferred locations)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="pendingTasksWithNoPrefs"></a> <code>pendingTasksWithNoPrefs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lookup table of the indices of tasks pending execution with no location preferences.</p>
<p class="tableblock">Updated with an task index when <code>TaskSetManager</code> <a href="#addPendingTask">registers a task as pending execution (per preferred locations)</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="priority"></a> <code>priority</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="recentExceptions"></a> <code>recentExceptions</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="runningTasksSet"></a> <code>runningTasksSet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Collection of running tasks that a <code>TaskSetManager</code> manages.</p>
<p class="tableblock">Used to implement <a href="#runningTasks">runningTasks</a> (that is simply the size of <code>runningTasksSet</code> but a required part of any <a href="spark-scheduler-Schedulable.adoc#contract">Schedulable</a>). <code>runningTasksSet</code> is expanded when <a href="#addRunningTask">registering a running task</a> and shrinked when <a href="#removeRunningTask">unregistering a running task</a>.</p>
<p class="tableblock">Used in <a href="TaskSchedulerImpl.html#cancelTasks" class="page"><code>TaskSchedulerImpl</code> to cancel tasks</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="speculatableTasks"></a> <code>speculatableTasks</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="stageId"></a> <code>stageId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The stage&#8217;s id a <code>TaskSetManager</code> runs for.</p>
<p class="tableblock">Set when <a href="#creating-instance"><code>TaskSetManager</code> is created</a>.</p>
<p class="tableblock">NOTE: <code>stageId</code> is part of <a href="spark-scheduler-Schedulable.adoc#contract">Schedulable contract</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="successful"></a> <code>successful</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Status of <a href="#tasks">tasks</a> (with a boolean flag, i.e. <code>true</code> or <code>false</code>, per task).</p>
<p class="tableblock">All tasks start with their flags disabled, i.e. <code>false</code>, when <a href="#creating-instance"><code>TaskSetManager</code> is created</a>.</p>
<p class="tableblock">The flag for a task is turned on, i.e. <code>true</code>, when a task finishes <a href="#handleSuccessfulTask">successfully</a> but also <a href="#handleFailedTask">with a failure</a>.</p>
<p class="tableblock">A flag is explicitly turned off only for <a href="#executorLost"><code>ShuffleMapTask</code> tasks when their executor is lost</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="taskAttempts"></a> <code>taskAttempts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registry of <a href="spark-scheduler-TaskInfo.adoc">TaskInfos</a> per every task attempt per task.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="taskInfos"></a> <code>taskInfos</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registry of <a href="spark-scheduler-TaskInfo.adoc">TaskInfos</a> per task id.</p>
<p class="tableblock">Updated with the task (id) and the corresponding <code>TaskInfo</code> when <code>TaskSetManager</code> <a href="#resourceOffer">finds a task for execution (given resource offer)</a>.</p>
<p class="tableblock">NOTE: It <em>appears</em> that the entires stay forever, i.e. are never removed (perhaps because the maintenance overhead is not needed given a <code>TaskSetManager</code> is a short-lived entity).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="tasks"></a> <code>tasks</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lookup table of <a href="Task.html" class="page">Tasks</a> (per partition id) to schedule execution of.</p>
<p class="tableblock">NOTE: The tasks all belong to a single <a href="#taskSet">TaskSet</a> that was given when <a href="#creating-instance"><code>TaskSetManager</code> was created</a> (which actually represent a single <a href="Stage.html" class="page">Stage</a>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="tasksSuccessful"></a> <code>tasksSuccessful</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="totalResultSize"></a> <code>totalResultSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The current total size of the result of all the tasks that have finished.</p>
<p class="tableblock">Starts from <code>0</code> when <a href="#creating-instance"><code>TaskSetManager</code> is created</a>.</p>
<p class="tableblock">Only increased with the size of a task result whenever a <code>TaskSetManager</code> <a href="#canFetchMoreResults">checks that there is enough memory to fetch the task result</a>.</p></td>
</tr>
</tbody>
</table>
<div id="logging" class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Enable <code>DEBUG</code> logging level for <code>org.apache.spark.scheduler.TaskSetManager</code> logger to see what happens inside.</p>
</div>
<div class="paragraph">
<p>Add the following line to <code>conf/log4j.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>log4j.logger.org.apache.spark.scheduler.TaskSetManager=DEBUG</code></pre>
</div>
</div>
<div class="paragraph">
<p>Refer to <a href="spark-logging.adoc">Logging</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="istaskblacklistedonexecornode-internal-method"><a class="anchor" href="#istaskblacklistedonexecornode-internal-method"></a><a class="link" href="#istaskblacklistedonexecornode-internal-method"><a id="isTaskBlacklistedOnExecOrNode"></a> <code>isTaskBlacklistedOnExecOrNode</code> Internal Method</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">isTaskBlacklistedOnExecOrNode(
  index: Int,
  execId: String,
  host: String): Boolean</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>isTaskBlacklistedOnExecOrNode</code>&#8230;&#8203;FIXME</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>isTaskBlacklistedOnExecOrNode</code> is used when <code>TaskSetManager</code> is requested to <a href="#dequeueTaskFromList">dequeueTaskFromList</a> and <a href="#dequeueSpeculativeTask">dequeueSpeculativeTask</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="getlocalityindex-method"><a class="anchor" href="#getlocalityindex-method"></a><a class="link" href="#getlocalityindex-method"><a id="getLocalityIndex"></a> <code>getLocalityIndex</code> Method</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">getLocalityIndex(locality: TaskLocality.TaskLocality): Int</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>getLocalityIndex</code>&#8230;&#8203;FIXME</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>getLocalityIndex</code> is used when <code>TaskSetManager</code> is requested to <a href="#resourceOffer">resourceOffer</a> and <a href="#recomputeLocality">recomputeLocality</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="dequeuespeculativetask-internal-method"><a class="anchor" href="#dequeuespeculativetask-internal-method"></a><a class="link" href="#dequeuespeculativetask-internal-method"><a id="dequeueSpeculativeTask"></a> <code>dequeueSpeculativeTask</code> Internal Method</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">dequeueSpeculativeTask(
  execId: String,
  host: String,
  locality: TaskLocality.Value): Option[(Int, TaskLocality.Value)]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>dequeueSpeculativeTask</code>&#8230;&#8203;FIXME</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>dequeueSpeculativeTask</code> is used exclusively when <code>TaskSetManager</code> is requested to <a href="#dequeueTask">dequeueTask</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="executoradded-method"><a class="anchor" href="#executoradded-method"></a><a class="link" href="#executoradded-method"><a id="executorAdded"></a> <code>executorAdded</code> Method</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">executorAdded(): Unit</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>executorAdded</code> simply <a href="#recomputeLocality">recomputeLocality</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>executorAdded</code> is used exclusively when <code>TaskSchedulerImpl</code> is requested to <a href="TaskSchedulerImpl.html#resourceOffers" class="page">resourceOffers</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="abortifcompletelyblacklisted-internal-method"><a class="anchor" href="#abortifcompletelyblacklisted-internal-method"></a><a class="link" href="#abortifcompletelyblacklisted-internal-method"><a id="abortIfCompletelyBlacklisted"></a> <code>abortIfCompletelyBlacklisted</code> Internal Method</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">abortIfCompletelyBlacklisted(
  hostToExecutors: HashMap[String, HashSet[String]]): Unit</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>abortIfCompletelyBlacklisted</code>&#8230;&#8203;FIXME</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>abortIfCompletelyBlacklisted</code> is used exclusively when <code>TaskSchedulerImpl</code> is requested to <a href="TaskSchedulerImpl.html#resourceOffers" class="page">resourceOffers</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="tasksetmanager-is-schedulable"><a class="anchor" href="#tasksetmanager-is-schedulable"></a><a class="link" href="#tasksetmanager-is-schedulable"><a id="schedulable"></a> TaskSetManager is Schedulable</a></h3>
<div class="paragraph">
<p><code>TaskSetManager</code> is a <a href="spark-scheduler-Schedulable.adoc">Schedulable</a> with the following implementation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>name</code> is <code>TaskSet_[taskSet.stageId.toString]</code></p>
</li>
<li>
<p>no <code>parent</code> is ever assigned, i.e. it is always <code>null</code>.</p>
<div class="paragraph">
<p>It means that it can only be a leaf in the tree of Schedulables (with <a href="spark-scheduler-Pool.adoc">Pools</a> being the nodes).</p>
</div>
</li>
<li>
<p><code>schedulingMode</code> always returns <code>SchedulingMode.NONE</code> (since there is nothing to schedule).</p>
</li>
<li>
<p><code>weight</code> is always <code>1</code>.</p>
</li>
<li>
<p><code>minShare</code> is always <code>0</code>.</p>
</li>
<li>
<p><code>runningTasks</code> is the number of running tasks in the internal  <code>runningTasksSet</code>.</p>
</li>
<li>
<p><code>priority</code> is the priority of the owned <a href="TaskSet.html" class="page">TaskSet</a> (using <code>taskSet.priority</code>).</p>
</li>
<li>
<p><code>stageId</code> is the stage id of the owned <a href="TaskSet.html" class="page">TaskSet</a> (using <code>taskSet.stageId</code>).</p>
</li>
<li>
<p><code>schedulableQueue</code> returns no queue, i.e. <code>null</code>.</p>
</li>
<li>
<p><code>addSchedulable</code> and <code>removeSchedulable</code> do nothing.</p>
</li>
<li>
<p><code>getSchedulableByName</code> always returns <code>null</code>.</p>
</li>
<li>
<p><code>getSortedTaskSetQueue</code> returns a one-element collection with the sole element being itself.</p>
</li>
<li>
<p><a href="#executorLost">executorLost</a></p>
</li>
<li>
<p><a href="#checkSpeculatableTasks">checkSpeculatableTasks</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="marking-task-as-fetching-indirect-resulthandletaskgettingresult-method"><a class="anchor" href="#marking-task-as-fetching-indirect-resulthandletaskgettingresult-method"></a><a class="link" href="#marking-task-as-fetching-indirect-resulthandletaskgettingresult-method"><a id="handleTaskGettingResult"></a> Marking Task As Fetching Indirect Result&#8201;&#8212;&#8201;<code>handleTaskGettingResult</code> Method</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">handleTaskGettingResult(tid: Long): Unit</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>handleTaskGettingResult</code> finds <a href="spark-scheduler-TaskInfo.adoc">TaskInfo</a> for <code>tid</code> task in <a href="#taskInfos">taskInfos</a> internal registry and marks it as fetching indirect task result. It then <a href="DAGScheduler.html#taskGettingResult" class="page">notifies <code>DAGScheduler</code></a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>handleTaskGettingResult</code> is executed when <a href="TaskSchedulerImpl.html#handleTaskGettingResult" class="page"><code>TaskSchedulerImpl</code> is notified about fetching indirect task result</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="registering-running-taskaddrunningtask-method"><a class="anchor" href="#registering-running-taskaddrunningtask-method"></a><a class="link" href="#registering-running-taskaddrunningtask-method"><a id="addRunningTask"></a> Registering Running Task&#8201;&#8212;&#8201;<code>addRunningTask</code> Method</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">addRunningTask(tid: Long): Unit</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>addRunningTask</code> adds <code>tid</code> to <a href="#runningTasksSet">runningTasksSet</a> internal registry and <a href="spark-scheduler-Pool.adoc#increaseRunningTasks">requests the <code>parent</code> pool to increase the number of running tasks</a> (if defined).</p>
</div>
</div>
<div class="sect2">
<h3 id="unregistering-running-taskremoverunningtask-method"><a class="anchor" href="#unregistering-running-taskremoverunningtask-method"></a><a class="link" href="#unregistering-running-taskremoverunningtask-method"><a id="removeRunningTask"></a> Unregistering Running Task&#8201;&#8212;&#8201;<code>removeRunningTask</code> Method</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">removeRunningTask(tid: Long): Unit</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>removeRunningTask</code> removes <code>tid</code> from <a href="#runningTasksSet">runningTasksSet</a> internal registry and <a href="spark-scheduler-Pool.adoc#decreaseRunningTasks">requests the <code>parent</code> pool to decrease the number of running task</a> (if defined).</p>
</div>
</div>
<div class="sect2">
<h3 id="checking-speculatable-taskscheckspeculatabletasks-method"><a class="anchor" href="#checking-speculatable-taskscheckspeculatabletasks-method"></a><a class="link" href="#checking-speculatable-taskscheckspeculatabletasks-method"><a id="checkSpeculatableTasks"></a> Checking Speculatable Tasks&#8201;&#8212;&#8201;<code>checkSpeculatableTasks</code> Method</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">checkSpeculatableTasks(minTimeToSpeculation: Int): Boolean</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>checkSpeculatableTasks</code> is part of the <a href="spark-scheduler-Schedulable.adoc#contract">Schedulable Contract</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>checkSpeculatableTasks</code> checks whether there are speculatable tasks in a <code>TaskSet</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>checkSpeculatableTasks</code> is called when <a href="spark-taskschedulerimpl-speculative-execution.adoc"><code>TaskSchedulerImpl</code> checks for speculatable tasks</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the TaskSetManager is <a href="#zombie-state">zombie</a> or has a single task in TaskSet, it assumes no speculatable tasks.</p>
</div>
<div class="paragraph">
<p>The method goes on with the assumption of no speculatable tasks by default.</p>
</div>
<div class="paragraph">
<p>It computes the minimum number of finished tasks for speculation (as <a href="spark-taskschedulerimpl-speculative-execution.adoc#spark_speculation_quantile">spark.speculation.quantile</a> of all the finished tasks).</p>
</div>
<div class="paragraph">
<p>You should see the DEBUG message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>DEBUG Checking for speculative tasks: minFinished = [minFinishedForSpeculation]</code></pre>
</div>
</div>
<div class="paragraph">
<p>It then checks whether the number is equal or greater than the number of tasks completed successfully (using <code>tasksSuccessful</code>).</p>
</div>
<div class="paragraph">
<p>Having done that, it computes the median duration of all the successfully completed tasks (using <a href="#taskInfos"><code>taskInfos</code> internal registry</a>) and task length threshold using the median duration multiplied by <a href="spark-taskschedulerimpl-speculative-execution.adoc#spark_speculation_multiplier">spark.speculation.multiplier</a> that has to be equal or less than <code>100</code>.</p>
</div>
<div class="paragraph">
<p>You should see the DEBUG message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>DEBUG Task length threshold for speculation: [threshold]</code></pre>
</div>
</div>
<div class="paragraph">
<p>For each task (using <a href="#taskInfos"><code>taskInfos</code> internal registry</a>) that is not marked as successful yet (using <code>successful</code>) for which there is only one copy running (using <code>copiesRunning</code>) and the task takes more time than the calculated threshold, but it was not in <code>speculatableTasks</code> it is assumed <strong>speculatable</strong>.</p>
</div>
<div class="paragraph">
<p>You should see the following INFO message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>INFO Marking task [index] in stage [taskSet.id] (on [info.host]) as speculatable because it ran more than [threshold] ms</code></pre>
</div>
</div>
<div class="paragraph">
<p>The task gets added to the internal <code>speculatableTasks</code> collection. The method responds positively.</p>
</div>
</div>
<div class="sect2">
<h3 id="getallowedlocalitylevel-internal-method"><a class="anchor" href="#getallowedlocalitylevel-internal-method"></a><a class="link" href="#getallowedlocalitylevel-internal-method"><a id="getAllowedLocalityLevel"></a> <code>getAllowedLocalityLevel</code> Internal Method</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">getAllowedLocalityLevel(curTime: Long): TaskLocality.TaskLocality</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>getAllowedLocalityLevel</code>&#8230;&#8203;FIXME</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>getAllowedLocalityLevel</code> is used exclusively when <code>TaskSetManager</code> is requested to <a href="#resourceOffer">find a task for execution (given a resource offer)</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="finding-task-for-execution-given-resource-offerresourceoffer-method"><a class="anchor" href="#finding-task-for-execution-given-resource-offerresourceoffer-method"></a><a class="link" href="#finding-task-for-execution-given-resource-offerresourceoffer-method"><a id="resourceOffer"></a> Finding Task For Execution (Given Resource Offer)&#8201;&#8212;&#8201;<code>resourceOffer</code> Method</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">resourceOffer(
  execId: String,
  host: String,
  maxLocality: TaskLocality): Option[TaskDescription]</code></pre>
</div>
</div>
<div class="paragraph">
<p>(only if <a href="#taskSetBlacklistHelperOpt">TaskSetBlacklist</a> is defined) <code>resourceOffer</code> requests <code>TaskSetBlacklist</code> to check if the input <a href="spark-scheduler-TaskSetBlacklist.adoc#isExecutorBlacklistedForTaskSet"><code>execId</code> executor</a> or <a href="spark-scheduler-TaskSetBlacklist.adoc#isNodeBlacklistedForTaskSet"><code>host</code> node</a> are blacklisted.</p>
</div>
<div class="paragraph">
<p>When <code>TaskSetManager</code> is a <a href="#zombie-state">zombie</a> or the resource offer (as executor and host) is blacklisted, <code>resourceOffer</code> finds no tasks to execute (and returns no <a href="spark-scheduler-TaskDescription.adoc">TaskDescription</a>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>resourceOffer</code> finds a task to schedule for a resource offer when neither <code>TaskSetManager</code> is a <a href="#zombie-state">zombie</a> nor the resource offer is blacklisted.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>resourceOffer</code> calculates the allowed task locality for task selection. When the input <code>maxLocality</code> is not <code>NO_PREF</code> task locality, <code>resourceOffer</code> <a href="#getAllowedLocalityLevel">getAllowedLocalityLevel</a> (for the current time) and sets it as the current task locality if more localized (specific).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="TaskSchedulerImpl.html" class="page">TaskLocality</a> can be the most localized <code>PROCESS_LOCAL</code>, <code>NODE_LOCAL</code> through <code>NO_PREF</code> and <code>RACK_LOCAL</code> to <code>ANY</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>resourceOffer</code> <a href="#dequeueTask">dequeues a task tor execution (given locality information)</a>.</p>
</div>
<div class="paragraph">
<p>If a task (index) is found, <code>resourceOffer</code> takes the <a href="Task.html" class="page">Task</a> (from <a href="#tasks">tasks</a> registry).</p>
</div>
<div class="paragraph">
<p><code>resourceOffer</code> <a href="TaskSchedulerImpl.html#newTaskId" class="page">requests <code>TaskSchedulerImpl</code> for the id for the new task</a>.</p>
</div>
<div class="paragraph">
<p><code>resourceOffer</code> increments the <a href="#copiesRunning">number of the copies of the task that are currently running</a> and finds the task attempt number (as the size of <a href="#taskAttempts">taskAttempts</a> entries for the task index).</p>
</div>
<div class="paragraph">
<p><code>resourceOffer</code> <a href="spark-scheduler-TaskInfo.adoc#creating-instance">creates a <code>TaskInfo</code></a> that is then registered in <a href="#taskInfos">taskInfos</a> and <a href="#taskAttempts">taskAttempts</a>.</p>
</div>
<div class="paragraph">
<p>If the maximum acceptable task locality is not <code>NO_PREF</code>, <code>resourceOffer</code> <a href="#getLocalityIndex">getLocalityIndex</a> (using the task&#8217;s locality) and records it as <a href="#currentLocalityIndex">currentLocalityIndex</a> with the current time as <a href="#lastLaunchTime">lastLaunchTime</a>.</p>
</div>
<div class="paragraph">
<p><code>resourceOffer</code> serializes the task.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>resourceOffer</code> uses <a href="../core/SparkEnv.html#closureSerializer" class="page"><code>SparkEnv</code> to access the closure <code>Serializer</code></a> and <a href="../serializer/Serializer.html#newInstance" class="page">create an instance thereof</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the task serialization fails, you should see the following ERROR message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Failed to serialize task [taskId], not attempting to retry it.</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>resourceOffer</code> <a href="#abort">aborts the <code>TaskSet</code></a> with the following message and reports a <code>TaskNotSerializableException</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Failed to serialize task [taskId], not attempting to retry it. Exception during serialization: [exception]</pre>
</div>
</div>
<div class="paragraph">
<p><code>resourceOffer</code> checks the size of the serialized task. If it is greater than <code>100</code> kB, you should see the following WARN message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>WARN Stage [id] contains a task of very large size ([size] KB). The maximum recommended task size is 100 KB.</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The size of the serializable task, i.e. <code>100</code> kB, is not configurable.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If however the serialization went well and the size is fine too, <code>resourceOffer</code> <a href="#addRunningTask">registers the task as running</a>.</p>
</div>
<div class="paragraph">
<p>You should see the following INFO message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>INFO TaskSetManager: Starting [name] (TID [id], [host], executor [id], partition [id], [taskLocality], [size] bytes)</pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>INFO TaskSetManager: Starting task 1.0 in stage 0.0 (TID 1, localhost, partition 1, PROCESS_LOCAL, 2054 bytes)</pre>
</div>
</div>
<div class="paragraph">
<p><code>resourceOffer</code> <a href="DAGScheduler.html#taskStarted" class="page">notifies <code>DAGScheduler</code> that the task has been started</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This is the moment when <code>TaskSetManager</code> informs <code>DAGScheduler</code> that a task has started.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>resourceOffer</code> is used exclusively when <code>TaskSchedulerImpl</code> is requested to <a href="TaskSchedulerImpl.html#resourceOfferSingleTaskSet" class="page">resourceOfferSingleTaskSet</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="dequeueing-task-for-execution-given-locality-informationdequeuetask-internal-method"><a class="anchor" href="#dequeueing-task-for-execution-given-locality-informationdequeuetask-internal-method"></a><a class="link" href="#dequeueing-task-for-execution-given-locality-informationdequeuetask-internal-method"><a id="dequeueTask"></a> Dequeueing Task For Execution (Given Locality Information)&#8201;&#8212;&#8201;<code>dequeueTask</code> Internal Method</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">dequeueTask(execId: String, host: String, maxLocality: TaskLocality): Option[(Int, TaskLocality, Boolean)]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>dequeueTask</code> tries to <a href="#dequeueTaskFromList">find the higest task index</a> (meeting localization requirements) using <a href="#getPendingTasksForExecutor">tasks (indices) registered for execution on <code>execId</code> executor</a>. If a task is found, <code>dequeueTask</code> returns its index, <code>PROCESS_LOCAL</code> task locality and the speculative marker disabled.</p>
</div>
<div class="paragraph">
<p><code>dequeueTask</code> then goes over all the possible <a href="TaskSchedulerImpl.html#TaskLocality" class="page">task localities</a> and checks what locality is allowed given the input <code>maxLocality</code>.</p>
</div>
<div class="paragraph">
<p><code>dequeueTask</code> checks out <code>NODE_LOCAL</code>, <code>NO_PREF</code>, <code>RACK_LOCAL</code> and <code>ANY</code> in that order.</p>
</div>
<div class="paragraph">
<p>For <code>NODE_LOCAL</code> <code>dequeueTask</code> tries to <a href="#dequeueTaskFromList">find the higest task index</a> (meeting localization requirements) using <a href="#getPendingTasksForHost">tasks (indices) registered for execution on <code>host</code> host</a> and if found returns its index, <code>NODE_LOCAL</code> task locality and the speculative marker disabled.</p>
</div>
<div class="paragraph">
<p>For <code>NO_PREF</code> <code>dequeueTask</code> tries to <a href="#dequeueTaskFromList">find the higest task index</a> (meeting localization requirements) using <a href="#pendingTasksWithNoPrefs">pendingTasksWithNoPrefs</a> internal registry and if found returns its index, <code>PROCESS_LOCAL</code> task locality and the speculative marker disabled.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For <code>NO_PREF</code> the task locality is <code>PROCESS_LOCAL</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For <code>RACK_LOCAL</code> <code>dequeueTask</code> <a href="TaskSchedulerImpl.html#getRackForHost" class="page">finds the rack for the input <code>host</code></a> and if available tries to <a href="#dequeueTaskFromList">find the higest task index</a> (meeting localization requirements) using <a href="#getPendingTasksForRack">tasks (indices) registered for execution on the rack</a>. If a task is found, <code>dequeueTask</code> returns its index, <code>RACK_LOCAL</code> task locality and the speculative marker disabled.</p>
</div>
<div class="paragraph">
<p>For <code>ANY</code> <code>dequeueTask</code> tries to <a href="#dequeueTaskFromList">find the higest task index</a> (meeting localization requirements) using <a href="#allPendingTasks">allPendingTasks</a> internal registry and if found returns its index, <code>ANY</code> task locality and the speculative marker disabled.</p>
</div>
<div class="paragraph">
<p>In the end, when no task could be found, <code>dequeueTask</code> <a href="#dequeueSpeculativeTask">dequeueSpeculativeTask</a> and if found returns its index, locality and the speculative marker enabled.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The speculative marker is enabled for a task only when <code>dequeueTask</code> did not manage to find a task for the available task localities and did find a speculative task.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>dequeueTask</code> is used exclusively when <code>TaskSetManager</code> is requested to <a href="#resourceOffer">find a task for execution (given a resource offer)</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="finding-higest-task-index-not-blacklisted-with-no-copies-running-and-not-completed-alreadydequeuetaskfromlist-internal-method"><a class="anchor" href="#finding-higest-task-index-not-blacklisted-with-no-copies-running-and-not-completed-alreadydequeuetaskfromlist-internal-method"></a><a class="link" href="#finding-higest-task-index-not-blacklisted-with-no-copies-running-and-not-completed-alreadydequeuetaskfromlist-internal-method"><a id="dequeueTaskFromList"></a> Finding Higest Task Index (Not Blacklisted, With No Copies Running and Not Completed Already)&#8201;&#8212;&#8201;<code>dequeueTaskFromList</code> Internal Method</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">dequeueTaskFromList(
  execId: String,
  host: String,
  list: ArrayBuffer[Int]): Option[Int]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>dequeueTaskFromList</code> takes task indices from the input <code>list</code> backwards (from the last to the first entry). For every index <code>dequeueTaskFromList</code> checks if it is not <a href="#isTaskBlacklistedOnExecOrNode">blacklisted on the input <code>execId</code> executor and <code>host</code></a> and if not, checks that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#copiesRunning">number of the copies of the task currently running</a> is <code>0</code></p>
</li>
<li>
<p>the task has not been marked as <a href="#successful">completed</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If so, <code>dequeueTaskFromList</code> returns the task index.</p>
</div>
<div class="paragraph">
<p>If <code>dequeueTaskFromList</code> has checked all the indices and no index has passed the checks, <code>dequeueTaskFromList</code> returns <code>None</code> (to indicate that no index has met the requirements).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>dequeueTaskFromList</code> is used exclusively when <code>TaskSetManager</code> is requested to <a href="#dequeueTask">dequeue a task for execution (given a locality information)</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="finding-tasks-indices-registered-for-execution-on-executorgetpendingtasksforexecutor-internal-method"><a class="anchor" href="#finding-tasks-indices-registered-for-execution-on-executorgetpendingtasksforexecutor-internal-method"></a><a class="link" href="#finding-tasks-indices-registered-for-execution-on-executorgetpendingtasksforexecutor-internal-method"><a id="getPendingTasksForExecutor"></a> Finding Tasks (Indices) Registered For Execution on Executor&#8201;&#8212;&#8201;<code>getPendingTasksForExecutor</code> Internal Method</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">getPendingTasksForExecutor(executorId: String): ArrayBuffer[Int]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>getPendingTasksForExecutor</code> finds pending tasks (indices) registered for execution on the input <code>executorId</code> executor (in <a href="#pendingTasksForExecutor">pendingTasksForExecutor</a> internal registry).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>getPendingTasksForExecutor</code> may find no matching tasks and return an empty collection.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>getPendingTasksForExecutor</code> is used exclusively when <code>TaskSetManager</code> is requested to <a href="#dequeueTask">dequeue a task for execution (given a locality information)</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="finding-tasks-indices-registered-for-execution-on-hostgetpendingtasksforhost-internal-method"><a class="anchor" href="#finding-tasks-indices-registered-for-execution-on-hostgetpendingtasksforhost-internal-method"></a><a class="link" href="#finding-tasks-indices-registered-for-execution-on-hostgetpendingtasksforhost-internal-method"><a id="getPendingTasksForHost"></a> Finding Tasks (Indices) Registered For Execution on Host&#8201;&#8212;&#8201;<code>getPendingTasksForHost</code> Internal Method</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">getPendingTasksForHost(host: String): ArrayBuffer[Int]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>getPendingTasksForHost</code> finds pending tasks (indices) registered for execution on the input <code>host</code> host (in <a href="#pendingTasksForHost">pendingTasksForHost</a> internal registry).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>getPendingTasksForHost</code> may find no matching tasks and return an empty collection.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>getPendingTasksForHost</code> is used exclusively when <code>TaskSetManager</code> is requested to <a href="#dequeueTask">dequeue a task for execution (given a locality information)</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="finding-tasks-indices-registered-for-execution-on-rackgetpendingtasksforrack-internal-method"><a class="anchor" href="#finding-tasks-indices-registered-for-execution-on-rackgetpendingtasksforrack-internal-method"></a><a class="link" href="#finding-tasks-indices-registered-for-execution-on-rackgetpendingtasksforrack-internal-method"><a id="getPendingTasksForRack"></a> Finding Tasks (Indices) Registered For Execution on Rack&#8201;&#8212;&#8201;<code>getPendingTasksForRack</code> Internal Method</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">getPendingTasksForRack(rack: String): ArrayBuffer[Int]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>getPendingTasksForRack</code> finds pending tasks (indices) registered for execution on the input <code>rack</code> rack (in <a href="#pendingTasksForRack">pendingTasksForRack</a> internal registry).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>getPendingTasksForRack</code> may find no matching tasks and return an empty collection.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>getPendingTasksForRack</code> is used exclusively when <code>TaskSetManager</code> is requested to <a href="#dequeueTask">dequeue a task for execution (given a locality information)</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="scheduling-tasks-in-taskset"><a class="anchor" href="#scheduling-tasks-in-taskset"></a><a class="link" href="#scheduling-tasks-in-taskset"><a id="scheduling-tasks"></a> Scheduling Tasks in TaskSet</a></h3>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For each submitted <a href="#taskset">TaskSet</a>, a new <code>TaskSetManager</code> is created. The TaskSetManager completely and exclusively owns a TaskSet submitted for execution.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME A picture with <code>TaskSetManager</code> owning TaskSet
</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME What component knows about TaskSet and TaskSetManager. Isn&#8217;t it that TaskSets are <strong>created</strong> by  DAGScheduler while TaskSetManager is used by TaskSchedulerImpl only?
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>TaskSetManager keeps track of the tasks pending execution per executor, host, rack or with no locality preferences.</p>
</div>
</div>
<div class="sect2">
<h3 id="locality-aware-scheduling-aka-delay-scheduling"><a class="anchor" href="#locality-aware-scheduling-aka-delay-scheduling"></a><a class="link" href="#locality-aware-scheduling-aka-delay-scheduling"><a id="locality-aware-scheduling"></a> Locality-Aware Scheduling aka Delay Scheduling</a></h3>
<div class="paragraph">
<p>TaskSetManager computes locality levels for the TaskSet for delay scheduling. While computing you should see the following DEBUG in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>DEBUG Valid locality levels for [taskSet]:  [levels]</code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME What&#8217;s delay scheduling?
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="events"><a class="anchor" href="#events"></a><a class="link" href="#events"><a id="events"></a> Events</a></h3>
<div class="paragraph">
<p>Once a task has finished, <code>TaskSetManager</code> informs <a href="DAGScheduler.html#taskEnded" class="page">DAGScheduler</a>.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="recording-successful-task-and-notifying-dagschedulerhandlesuccessfultask-method"><a class="anchor" href="#recording-successful-task-and-notifying-dagschedulerhandlesuccessfultask-method"></a><a class="link" href="#recording-successful-task-and-notifying-dagschedulerhandlesuccessfultask-method"><a id="handleSuccessfulTask"></a> Recording Successful Task And Notifying DAGScheduler&#8201;&#8212;&#8201;<code>handleSuccessfulTask</code> Method</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">handleSuccessfulTask(
  tid: Long,
  result: DirectTaskResult[_]): Unit</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>handleSuccessfulTask</code> records the <code>tid</code> task as finished, <a href="DAGScheduler.html#taskEnded" class="page">notifies the <code>DAGScheduler</code> that the task has ended</a> and <a href="#maybeFinishTaskSet">attempts to mark the <code>TaskSet</code> finished</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>handleSuccessfulTask</code> is executed after <a href="TaskSchedulerImpl.html#handleSuccessfulTask" class="page"><code>TaskSchedulerImpl</code> has been informed that <code>tid</code> task finished successfully (and the task result was deserialized)</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Internally, <code>handleSuccessfulTask</code> finds <a href="spark-scheduler-TaskInfo.adoc">TaskInfo</a> (in <a href="#taskInfos">taskInfos</a> internal registry) and marks it as <code>FINISHED</code>.</p>
</div>
<div class="paragraph">
<p>It then removes <code>tid</code> task from <a href="#runningTasksSet">runningTasksSet</a> internal registry.</p>
</div>
<div class="paragraph">
<p><code>handleSuccessfulTask</code> <a href="DAGScheduler.html#taskEnded" class="page">notifies <code>DAGScheduler</code> that <code>tid</code> task ended successfully</a> (with the <code>Task</code> object from <a href="#tasks">tasks</a> internal registry and the result as <code>Success</code>).</p>
</div>
<div class="paragraph">
<p>At this point, <code>handleSuccessfulTask</code> finds the other <a href="#taskAttempts">running task attempts</a> of <code>tid</code> task and <a href="SchedulerBackend.html#killTask" class="page">requests <code>SchedulerBackend</code> to kill them</a> (since they are no longer necessary now when at least one task attempt has completed successfully). You should see the following INFO message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>INFO Killing attempt [attemptNumber] for task [id] in stage [id] (TID [id]) on [host] as the attempt [attemptNumber] succeeded on [host]</pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME Review <code>taskAttempts</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If <code>tid</code> has <em>not</em> yet been recorded as <a href="#successful">successful</a>, <code>handleSuccessfulTask</code> increases <a href="#tasksSuccessful">tasksSuccessful</a> counter. You should see the following INFO message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>INFO Finished task [id] in stage [id] (TID [taskId]) in [duration] ms on [host] (executor [executorId]) ([tasksSuccessful]/[numTasks])</pre>
</div>
</div>
<div class="paragraph">
<p><code>tid</code> task is marked as <a href="#successful">successful</a>. If the number of task that have finished successfully is exactly the number of the tasks to execute (in the <code>TaskSet</code>), the <code>TaskSetManager</code> becomes a <a href="#isZombie">zombie</a>.</p>
</div>
<div class="paragraph">
<p>If <code>tid</code> task was already recorded as <a href="#successful">successful</a>, you should <em>merely</em> see the following INFO message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>INFO Ignoring task-finished event for [id] in stage [id] because task [index] has already completed successfully</pre>
</div>
</div>
<div class="paragraph">
<p>Ultimately, <code>handleSuccessfulTask</code> <a href="#maybeFinishTaskSet">attempts to mark the <code>TaskSet</code> finished</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>handleSuccessfulTask</code> is used exclusively when <code>TaskSchedulerImpl</code> is requested to <a href="TaskSchedulerImpl.html#handleSuccessfulTask" class="page">handleSuccessfulTask</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="attempting-to-mark-taskset-finishedmaybefinishtaskset-internal-method"><a class="anchor" href="#attempting-to-mark-taskset-finishedmaybefinishtaskset-internal-method"></a><a class="link" href="#attempting-to-mark-taskset-finishedmaybefinishtaskset-internal-method"><a id="maybeFinishTaskSet"></a> Attempting to Mark TaskSet Finished&#8201;&#8212;&#8201;<code>maybeFinishTaskSet</code> Internal Method</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">maybeFinishTaskSet(): Unit</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>maybeFinishTaskSet</code> <a href="TaskSchedulerImpl.html#taskSetFinished" class="page">notifies <code>TaskSchedulerImpl</code> that a <code>TaskSet</code> has finished</a> when there are no other <a href="#runningTasksSet">running tasks</a> and the <a href="#isZombie">TaskSetManager is not in zombie state</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="retrying-tasks-on-failure"><a class="anchor" href="#retrying-tasks-on-failure"></a><a class="link" href="#retrying-tasks-on-failure"><a id="task-retries"></a> Retrying Tasks on Failure</a></h3>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Up to <a href="../configuration-properties.html#spark.task.maxFailures" class="page">spark.task.maxFailures</a> attempts</p>
</div>
</div>
<div class="sect2">
<h3 id="task-retries-and-spark-task-maxfailures"><a class="anchor" href="#task-retries-and-spark-task-maxfailures"></a><a class="link" href="#task-retries-and-spark-task-maxfailures">Task retries and <code>spark.task.maxFailures</code></a></h3>
<div class="paragraph">
<p>When you start Spark program you set up <a href="../configuration-properties.html#spark.task.maxFailures" class="page">spark.task.maxFailures</a> for the number of failures that are acceptable until <code>TaskSetManager</code> gives up and marks a job failed.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In Spark shell with local master, <a href="../configuration-properties.html#spark.task.maxFailures" class="page">spark.task.maxFailures</a> is fixed to <code>1</code> and you need to use <a href="local/spark-local.adoc">local-with-retries master</a> to change it to some other value.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the following example, you are going to execute a job with two partitions and keep one failing at all times (by throwing an exception). The aim is to learn the behavior of retrying task execution in a stage in TaskSet. You will only look at a single task execution, namely <code>0.0</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ ./bin/spark-shell --master "local[*, 5]"
...
scala&gt; sc.textFile("README.md", 2).mapPartitionsWithIndex((idx, it) =&gt; if (idx == 0) throw new Exception("Partition 2 marked failed") else it).count
...
15/10/27 17:24:56 INFO DAGScheduler: Submitting 2 missing tasks from ResultStage 1 (MapPartitionsRDD[7] at mapPartitionsWithIndex at &lt;console&gt;:25)
15/10/27 17:24:56 DEBUG DAGScheduler: New pending partitions: Set(0, 1)
15/10/27 17:24:56 INFO TaskSchedulerImpl: Adding task set 1.0 with 2 tasks
...
15/10/27 17:24:56 INFO TaskSetManager: Starting task 0.0 in stage 1.0 (TID 2, localhost, partition 0,PROCESS_LOCAL, 2062 bytes)
...
15/10/27 17:24:56 INFO Executor: Running task 0.0 in stage 1.0 (TID 2)
...
15/10/27 17:24:56 ERROR Executor: Exception in task 0.0 in stage 1.0 (TID 2)
java.lang.Exception: Partition 2 marked failed
...
15/10/27 17:24:56 INFO TaskSetManager: Starting task 0.1 in stage 1.0 (TID 4, localhost, partition 0,PROCESS_LOCAL, 2062 bytes)
15/10/27 17:24:56 INFO Executor: Running task 0.1 in stage 1.0 (TID 4)
15/10/27 17:24:56 INFO HadoopRDD: Input split: file:/Users/jacek/dev/oss/spark/README.md:0+1784
15/10/27 17:24:56 ERROR Executor: Exception in task 0.1 in stage 1.0 (TID 4)
java.lang.Exception: Partition 2 marked failed
...
15/10/27 17:24:56 ERROR Executor: Exception in task 0.4 in stage 1.0 (TID 7)
java.lang.Exception: Partition 2 marked failed
...
15/10/27 17:24:56 INFO TaskSetManager: Lost task 0.4 in stage 1.0 (TID 7) on executor localhost: java.lang.Exception (Partition 2 marked failed) [duplicate 4]
15/10/27 17:24:56 ERROR TaskSetManager: Task 0 in stage 1.0 failed 5 times; aborting job
15/10/27 17:24:56 INFO TaskSchedulerImpl: Removed TaskSet 1.0, whose tasks have all completed, from pool
15/10/27 17:24:56 INFO TaskSchedulerImpl: Cancelling stage 1
15/10/27 17:24:56 INFO DAGScheduler: ResultStage 1 (count at &lt;console&gt;:25) failed in 0.058 s
15/10/27 17:24:56 DEBUG DAGScheduler: After removal of stage 1, remaining stages = 0
15/10/27 17:24:56 INFO DAGScheduler: Job 1 failed: count at &lt;console&gt;:25, took 0.085810 s
org.apache.spark.SparkException: Job aborted due to stage failure: Task 0 in stage 1.0 failed 5 times, most recent failure: Lost task 0.4 in stage 1.0 (TID 7, localhost): java.lang.Exception: Partition 2 marked failed</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="zombie-state"><a class="anchor" href="#zombie-state"></a><a class="link" href="#zombie-state"><a id="zombie-state"></a> Zombie state</a></h3>
<div class="paragraph">
<p>A <code>TaskSetManager</code> is in <strong>zombie</strong> state when all tasks in a taskset have completed successfully (regardless of the number of task attempts), or if the taskset has been <a href="#abort">aborted</a>.</p>
</div>
<div class="paragraph">
<p>While in zombie state, a <code>TaskSetManager</code> can launch no new tasks and <a href="#resourceOffer">responds with no <code>TaskDescription</code> to resourceOffers</a>.</p>
</div>
<div class="paragraph">
<p>A <code>TaskSetManager</code> remains in the zombie state until all tasks have finished running, i.e. to continue to track and account for the running tasks.</p>
</div>
</div>
<div class="sect2">
<h3 id="aborting-tasksetabort-method"><a class="anchor" href="#aborting-tasksetabort-method"></a><a class="link" href="#aborting-tasksetabort-method"><a id="abort"></a> Aborting TaskSet&#8201;&#8212;&#8201;<code>abort</code> Method</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">abort(
  message: String,
  exception: Option[Throwable] = None): Unit</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>abort</code> informs <a href="DAGScheduler.html#taskSetFailed" class="page"><code>DAGScheduler</code> that the <code>TaskSet</code> has been aborted</a>.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME image with DAGScheduler call
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The TaskSetManager enters <a href="#zombie-state">zombie state</a>.</p>
</div>
<div class="paragraph">
<p>In the end, <code>abort</code> <a href="#maybeFinishTaskSet">attempts to mark the <code>TaskSet</code> finished</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>abort</code> is used when:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>TaskResultGetter</code> is requested to <a href="TaskResultGetter.html#enqueueSuccessfulTask" class="page">enqueueSuccessfulTask</a> (that has failed)</p>
</li>
<li>
<p><code>TaskSchedulerImpl</code> is requested to <a href="TaskSchedulerImpl.html#cancelTasks" class="page">cancelTasks</a> and <a href="TaskSchedulerImpl.html#error" class="page">error</a></p>
</li>
<li>
<p><code>TaskSetManager</code> is requested to <a href="#resourceOffer">resourceOffer</a>, <a href="#abortIfCompletelyBlacklisted">abortIfCompletelyBlacklisted</a>, <a href="#canFetchMoreResults">canFetchMoreResults</a>, and <a href="#handleFailedTask">handleFailedTask</a></p>
</li>
<li>
<p><code>DriverEndpoint</code> is requested to <a href="CoarseGrainedSchedulerBackend-DriverEndpoint.html#launchTasks" class="page">launch tasks on executors</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="creating-tasksetmanager-instance"><a class="anchor" href="#creating-tasksetmanager-instance"></a><a class="link" href="#creating-tasksetmanager-instance"><a id="creating-instance"></a> Creating TaskSetManager Instance</a></h3>
<div class="paragraph">
<p><code>TaskSetManager</code> takes the following to be created:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a id="sched"></a> <a href="TaskSchedulerImpl.html" class="page">TaskSchedulerImpl</a></p>
</li>
<li>
<p><a id="taskSet"></a> <a href="TaskSet.html" class="page">TaskSet</a></p>
</li>
<li>
<p><a id="maxTaskFailures"></a> Number of task failures, i.e. how many times a <a href="#handleFailedTask">single task can fail</a> before an entire TaskSet is <a href="#abort">aborted</a></p>
</li>
<li>
<p><a id="blacklistTracker"></a> (optional) BlacklistTracker (default: <code>None</code>)</p>
</li>
<li>
<p><a id="clock"></a> <code>Clock</code> (default: <code>SystemClock</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>TaskSetManager</code> initializes the <a href="#internal-registries">internal registries and counters</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>maxTaskFailures</code> is <code>1</code> for <code>local</code> run mode, <code>maxFailures</code> for Spark local-with-retries, and <a href="../configuration-properties.html#spark.task.maxFailures" class="page">spark.task.maxFailures</a> configuration property for Spark local-cluster and Spark with cluster managers (Spark Standalone, Mesos and YARN).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>TaskSetManager</code> <a href="MapOutputTracker.html#getEpoch" class="page">requests the current epoch from <code>MapOutputTracker</code></a> and sets it on all tasks in the taskset.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>TaskSetManager</code> uses <a href="#sched">TaskSchedulerImpl</a> (that was given when <a href="#creating-instance">created</a>) to <a href="TaskSchedulerImpl.html#mapOutputTracker" class="page">access the current <code>MapOutputTracker</code></a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You should see the following DEBUG in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>DEBUG Epoch for [taskSet]: [epoch]</code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME Why is the epoch important?
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>TaskSetManager</code> requests <a href="TaskSchedulerImpl.html#mapOutputTracker" class="page"><code>MapOutputTracker</code> from <code>TaskSchedulerImpl</code></a> which is <em>likely</em> for unit testing only since <a href="../core/SparkEnv.html#mapOutputTracker" class="page"><code>MapOutputTracker</code> is available using <code>SparkEnv</code></a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>TaskSetManager</code> <a href="#addPendingTask">adds the tasks as pending execution</a> (in reverse order from the highest partition to the lowest).</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME Why is reverse order important? The code says it&#8217;s to execute tasks with low indices first.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="getting-notified-that-task-failedhandlefailedtask-method"><a class="anchor" href="#getting-notified-that-task-failedhandlefailedtask-method"></a><a class="link" href="#getting-notified-that-task-failedhandlefailedtask-method"><a id="handleFailedTask"></a> Getting Notified that Task Failed&#8201;&#8212;&#8201;<code>handleFailedTask</code> Method</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">handleFailedTask(
  tid: Long,
  state: TaskState,
  reason: TaskFailedReason): Unit</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>handleFailedTask</code> finds <a href="spark-scheduler-TaskInfo.adoc">TaskInfo</a> of <code>tid</code> task in <a href="#taskInfos">taskInfos</a> internal registry and simply quits if the task is already marked as failed or killed.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="_images/TaskSetManager-handleFailedTask.png" alt="TaskSetManager handleFailedTask">
</div>
<div class="title">Figure 2. TaskSetManager Gets Notified that Task Has Failed</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>handleFailedTask</code> is executed after <a href="TaskSchedulerImpl.html#handleFailedTask" class="page"><code>TaskSchedulerImpl</code> has been informed that <code>tid</code> task failed</a> or <a href="#executorLost">an executor was lost</a>. In either case, tasks could not finish successfully or could not report their status back.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>handleFailedTask</code> <a href="#removeRunningTask">unregisters <code>tid</code> task from the internal registry of running tasks</a> and then <a href="spark-scheduler-TaskInfo.adoc#markFinished">marks the corresponding <code>TaskInfo</code> as finished</a> (passing in the input <code>state</code>).</p>
</div>
<div class="paragraph">
<p><code>handleFailedTask</code> decrements the number of the running copies of <code>tid</code> task (in <a href="#copiesRunning">copiesRunning</a> internal registry).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
With <a href="spark-taskschedulerimpl-speculative-execution.adoc">speculative execution of tasks</a> enabled, there can be many copies of a task running simultaneuosly.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>handleFailedTask</code> uses the following pattern as the reason of the failure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Lost task [id] in stage [taskSetId] (TID [tid], [host], executor [executorId]): [reason]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>handleFailedTask</code> then calculates the failure exception per the input <code>reason</code> (follow the links for more details):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#handleFailedTask-FetchFailed">FetchFailed</a></p>
</li>
<li>
<p><a href="#handleFailedTask-ExceptionFailure">ExceptionFailure</a></p>
</li>
<li>
<p><a href="#handleFailedTask-ExecutorLostFailure">ExecutorLostFailure</a></p>
</li>
<li>
<p><a href="#handleFailedTask-TaskFailedReason">other TaskFailedReasons</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Description of how the final failure exception is "computed" was moved to respective sections below to make the reading slightly more pleasant and comprehensible.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>handleFailedTask</code> <a href="DAGScheduler.html#taskEnded" class="page">informs <code>DAGScheduler</code> that <code>tid</code> task has ended</a> (passing on the <code>Task</code> instance from <a href="#tasks">tasks</a> internal registry, the input <code>reason</code>, <code>null</code> result, calculated <code>accumUpdates</code> per failure, and the <a href="spark-scheduler-TaskInfo.adoc">TaskInfo</a>).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
This is the moment when <code>TaskSetManager</code> informs <code>DAGScheduler</code> that a task has ended.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If <code>tid</code> task has already been marked as completed (in <a href="#successful">successful</a> internal registry) you should see the following INFO message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>INFO Task [id] in stage [id] (TID [tid]) failed, but the task will not be re-executed (either because the task failed with a shuffle data fetch failure, so the previous stage needs to be re-run, or because a different copy of the task has already succeeded).</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Read up on <a href="spark-taskschedulerimpl-speculative-execution.adoc">Speculative Execution of Tasks</a> to find out why a single task could be executed multiple times.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If however <code>tid</code> task was not recorded as <a href="#successful">completed</a>, <code>handleFailedTask</code> <a href="#addPendingTask">records it as pending</a>.</p>
</div>
<div class="paragraph">
<p>If the <code>TaskSetManager</code> is not a <a href="#zombie-state">zombie</a> and the task failed <code>reason</code> should be counted towards the maximum number of times the task is allowed to fail before the stage is aborted (i.e. <code>TaskFailedReason.countTowardsTaskFailures</code> attribute is enabled), the optional <a href="spark-scheduler-TaskSetBlacklist.adoc#updateBlacklistForFailedTask"><code>TaskSetBlacklist</code> is notified</a> (passing on the host, executor and the task&#8217;s index). <code>handleFailedTask</code> then increments the <a href="#numFailures">number of failures</a> for <code>tid</code> task and checks if the number of failures is equal or greater than the <a href="#maxTaskFailures">allowed number of task failures per <code>TaskSet</code></a> (as defined when the <a href="#creating-instance"><code>TaskSetManager</code> was created</a>).</p>
</div>
<div class="paragraph">
<p>If so, i.e. the number of task failures of <code>tid</code> task reached the maximum value, you should see the following ERROR message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ERROR Task [id] in stage [id] failed [maxTaskFailures] times; aborting job</code></pre>
</div>
</div>
<div class="paragraph">
<p>And <code>handleFailedTask</code> <a href="#abort">aborts the <code>TaskSet</code></a> with the following message and then quits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Task [index] in stage [id] failed [maxTaskFailures] times, most recent failure: [failureReason]</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the end (except when the number of failures of <code>tid</code> task grew beyond the acceptable number), <code>handleFailedTask</code> <a href="#maybeFinishTaskSet">attempts to mark the <code>TaskSet</code> as finished</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>handleFailedTask</code> is used when:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>TaskSchedulerImpl</code> is requested to <a href="TaskSchedulerImpl.html#handleFailedTask" class="page">handle a failed task</a></p>
</li>
<li>
<p><code>TaskSetManager</code> is requested to <a href="#handleSuccessfulTask">handle a successful task</a> and <a href="#executorLost">handle a lost executor</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="fetchfailed-taskfailedreason"><a class="anchor" href="#fetchfailed-taskfailedreason"></a><a class="link" href="#fetchfailed-taskfailedreason"><a id="handleFailedTask-FetchFailed"></a> <code>FetchFailed</code> TaskFailedReason</a></h4>
<div class="paragraph">
<p>For <code>FetchFailed</code> you should see the following WARN message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>WARN Lost task [id] in stage [id] (TID [tid], [host], executor [id]): [reason]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unless <code>tid</code> has already been marked as successful (in <a href="#successful">successful</a> internal registry), it becomes so and the <a href="#tasksSuccessful">number of successful tasks in <code>TaskSet</code></a> gets increased.</p>
</div>
<div class="paragraph">
<p>The <code>TaskSetManager</code> enters <a href="#isZombie">zombie state</a>.</p>
</div>
<div class="paragraph">
<p>The failure exception is empty.</p>
</div>
</div>
<div class="sect3">
<h4 id="exceptionfailure-taskfailedreason"><a class="anchor" href="#exceptionfailure-taskfailedreason"></a><a class="link" href="#exceptionfailure-taskfailedreason"><a id="handleFailedTask-ExceptionFailure"></a> <code>ExceptionFailure</code> TaskFailedReason</a></h4>
<div class="paragraph">
<p>For <code>ExceptionFailure</code>, <code>handleFailedTask</code> checks if the exception is of type <code>NotSerializableException</code>. If so, you should see the following ERROR message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>ERROR Task [id] in stage [id] (TID [tid]) had a not serializable result: [description]; not retrying</code></pre>
</div>
</div>
<div class="paragraph">
<p>And <code>handleFailedTask</code> <a href="#abort">aborts the <code>TaskSet</code></a> and then quits.</p>
</div>
<div class="paragraph">
<p>Otherwise, if the exception is not of type <code>NotSerializableException</code>, <code>handleFailedTask</code> accesses accumulators and calculates whether to print the WARN message (with the failure reason) or the INFO message.</p>
</div>
<div class="paragraph">
<p>If the failure has already been reported (and is therefore a duplication), <a href="../configuration-properties.html#spark.logging.exceptionPrintInterval" class="page">spark.logging.exceptionPrintInterval</a> is checked before reprinting the duplicate exception in its entirety.</p>
</div>
<div class="paragraph">
<p>For full printout of the <code>ExceptionFailure</code>, the following WARN appears in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>WARN Lost task [id] in stage [id] (TID [tid], [host], executor [id]): [reason]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Otherwise, the following INFO appears in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>INFO Lost task [id] in stage [id] (TID [tid]) on [host], executor [id]: [className] ([description]) [duplicate [dupCount]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The exception in <code>ExceptionFailure</code> becomes the failure exception.</p>
</div>
</div>
<div class="sect3">
<h4 id="executorlostfailure-taskfailedreason"><a class="anchor" href="#executorlostfailure-taskfailedreason"></a><a class="link" href="#executorlostfailure-taskfailedreason"><a id="handleFailedTask-ExecutorLostFailure"></a> <code>ExecutorLostFailure</code> TaskFailedReason</a></h4>
<div class="paragraph">
<p>For <code>ExecutorLostFailure</code> if not <code>exitCausedByApp</code>, you should see the following INFO in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>INFO Task [tid] failed because while it was being computed, its executor exited for a reason unrelated to the task. Not counting this failure towards the maximum number of failures for the task.</code></pre>
</div>
</div>
<div class="paragraph">
<p>The failure exception is empty.</p>
</div>
</div>
<div class="sect3">
<h4 id="other-taskfailedreasons"><a class="anchor" href="#other-taskfailedreasons"></a><a class="link" href="#other-taskfailedreasons"><a id="handleFailedTask-TaskFailedReason"></a> Other TaskFailedReasons</a></h4>
<div class="paragraph">
<p>For the other TaskFailedReasons, you should see the following WARN message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>WARN Lost task [id] in stage [id] (TID [tid], [host], executor [id]): [reason]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The failure exception is empty.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="registering-task-as-pending-execution-per-preferred-locationsaddpendingtask-internal-method"><a class="anchor" href="#registering-task-as-pending-execution-per-preferred-locationsaddpendingtask-internal-method"></a><a class="link" href="#registering-task-as-pending-execution-per-preferred-locationsaddpendingtask-internal-method"><a id="addPendingTask"></a> Registering Task As Pending Execution (Per Preferred Locations)&#8201;&#8212;&#8201;<code>addPendingTask</code> Internal Method</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">addPendingTask(index: Int): Unit</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>addPendingTask</code> registers a <code>index</code> task in the pending-task lists that the task should be eventually scheduled to (per its preferred locations).</p>
</div>
<div class="paragraph">
<p>Internally, <code>addPendingTask</code> takes the <a href="Task.html#preferredLocations" class="page">preferred locations of the task</a> (given <code>index</code>) and registers the task in the internal pending-task registries for every preferred location:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#pendingTasksForExecutor">pendingTasksForExecutor</a> when the <a href="TaskLocation.html" class="page">TaskLocation</a> is <code>ExecutorCacheTaskLocation</code>.</p>
</li>
<li>
<p><a href="#pendingTasksForHost">pendingTasksForHost</a> for the hosts of a <a href="TaskLocation.html" class="page">TaskLocation</a>.</p>
</li>
<li>
<p><a href="#pendingTasksForRack">pendingTasksForRack</a> for the <a href="TaskSchedulerImpl.html#getRackForHost" class="page">racks from  <code>TaskSchedulerImpl</code> per the host</a> (of a <a href="TaskLocation.html" class="page">TaskLocation</a>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For a <a href="TaskLocation.html" class="page">TaskLocation</a> being <code>HDFSCacheTaskLocation</code>, <code>addPendingTask</code> <a href="TaskSchedulerImpl.html#getExecutorsAliveOnHost" class="page">requests <code>TaskSchedulerImpl</code> for the executors on the host</a> (of a preferred location) and registers the task in <a href="#pendingTasksForExecutor">pendingTasksForExecutor</a> for every executor (if available).</p>
</div>
<div class="paragraph">
<p>You should see the following INFO message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>INFO Pending task [index] has a cached location at [host] , where there are executors [executors]</code></pre>
</div>
</div>
<div class="paragraph">
<p>When <code>addPendingTask</code> could not find executors for a <code>HDFSCacheTaskLocation</code> preferred location, you should see the following DEBUG message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>DEBUG Pending task [index] has a cached location at [host] , but there are no executors alive there.</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the task has no location preferences, <code>addPendingTask</code> registers it in <a href="#pendingTasksWithNoPrefs">pendingTasksWithNoPrefs</a>.</p>
</div>
<div class="paragraph">
<p><code>addPendingTask</code> always registers the task in <a href="#allPendingTasks">allPendingTasks</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>addPendingTask</code> is used immediatelly when <code>TaskSetManager</code> <a href="#creating-instance">is created</a> and later when handling a <a href="#handleFailedTask">task failure</a> or <a href="#executorLost">lost executor</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="re-enqueuing-shufflemaptasks-with-no-externalshuffleservice-and-reporting-all-running-tasks-on-lost-executor-as-failedexecutorlost-method"><a class="anchor" href="#re-enqueuing-shufflemaptasks-with-no-externalshuffleservice-and-reporting-all-running-tasks-on-lost-executor-as-failedexecutorlost-method"></a><a class="link" href="#re-enqueuing-shufflemaptasks-with-no-externalshuffleservice-and-reporting-all-running-tasks-on-lost-executor-as-failedexecutorlost-method"><a id="executorLost"></a> Re-enqueuing ShuffleMapTasks (with no ExternalShuffleService) and Reporting All Running Tasks on Lost Executor as Failed&#8201;&#8212;&#8201;<code>executorLost</code> Method</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">executorLost(execId: String, host: String, reason: ExecutorLossReason): Unit</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>executorLost</code> re-enqueues all the <a href="ShuffleMapTask.html" class="page">ShuffleMapTasks</a> that have completed already on the lost executor (when <a href="../deploy/ExternalShuffleService.html" class="page">external shuffle service</a> is not in use) and <a href="#handleFailedTask">reports all currently-running tasks on the lost executor as failed</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>executorLost</code> is part of the <a href="spark-scheduler-Schedulable.adoc#contract">Schedulable contract</a> that <a href="TaskSchedulerImpl.html#removeExecutor" class="page"><code>TaskSchedulerImpl</code> uses to inform <code>TaskSetManagers</code> about lost executors</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Since <code>TaskSetManager</code> manages execution of the tasks in a single <a href="TaskSet.html" class="page">TaskSet</a>, when an executor gets lost, the affected tasks that have been running on the failed executor need to be re-enqueued. <code>executorLost</code> is the mechanism to "announce" the event to all <code>TaskSetManagers</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Internally, <code>executorLost</code> first checks whether the <a href="#tasks">tasks</a> are <a href="ShuffleMapTask.html" class="page">ShuffleMapTasks</a> and whether an <a href="../deploy/ExternalShuffleService.html" class="page">external shuffle service</a> is enabled (that could serve the map shuffle outputs in case of failure).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>executorLost</code> checks out the first task in <a href="#tasks">tasks</a> as it is assumed the other belong to the same stage. If the task is a <a href="ShuffleMapTask.html" class="page">ShuffleMapTask</a>, the entire <a href="#taskSet">TaskSet</a> is for a <a href="ShuffleMapStage.html" class="page">ShuffleMapStage</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>executorLost</code> uses <a href="../core/SparkEnv.html#blockManager" class="page"><code>SparkEnv</code> to access the current <code>BlockManager</code></a> and finds out whether an <a href="../storage/BlockManager.html#externalShuffleServiceEnabled" class="page">external shuffle service is enabled</a> or not (based on <a href="../configuration-properties.html#spark.shuffle.service.enabled" class="page">spark.shuffle.service.enabled</a> configuration property).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If <code>executorLost</code> is indeed due to an executor lost that executed tasks for a <a href="ShuffleMapStage.html" class="page">ShuffleMapStage</a> (that this <code>TaskSetManager</code> manages) and no external shuffle server is enabled, <code>executorLost</code> finds <a href="#taskInfos">all the tasks</a> that were scheduled on this lost executor and marks the <a href="#successful">ones that were already successfully completed</a> as not executed yet.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>executorLost</code> uses records every tasks on the lost executor in <a href="#successful">successful</a> (as <code>false</code>) and decrements <a href="#copiesRunning copiesRunning">[copiesRunning copiesRunning]</a>, and <a href="#tasksSuccessful">tasksSuccessful</a> for every task.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>executorLost</code> <a href="#addPendingTask">registers every task as pending execution (per preferred locations)</a> and <a href="DAGScheduler.html#taskEnded" class="page">informs <code>DAGScheduler</code> that the tasks (on the lost executor) have ended</a> (with <a href="DAGScheduler.html#handleTaskCompletion-Resubmitted" class="page">Resubmitted</a> reason).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>executorLost</code> uses <a href="TaskSchedulerImpl.html#dagScheduler" class="page"><code>TaskSchedulerImpl</code> to access the <code>DAGScheduler</code></a>. <code>TaskSchedulerImpl</code> is given when the <a href="#creating-instance"><code>TaskSetManager</code> was created</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Regardless of whether this <code>TaskSetManager</code> manages <code>ShuffleMapTasks</code> or not (it could also manage <a href="ResultTask.html" class="page">ResultTasks</a>) and whether the external shuffle service is used or not, <code>executorLost</code> finds all <a href="#taskInfos">currently-running tasks</a> on this lost executor and <a href="#handleFailedTask">reports them as failed</a> (with the task state <code>FAILED</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>executorLost</code> finds out if the reason for the executor lost is due to application fault, i.e. assumes <code>ExecutorExited</code>'s exit status as the indicator, <code>ExecutorKilled</code> for non-application&#8217;s fault and any other reason is an application fault.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>executorLost</code> <a href="#recomputeLocality">recomputes locality preferences</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="recomputing-task-locality-preferencesrecomputelocality-method"><a class="anchor" href="#recomputing-task-locality-preferencesrecomputelocality-method"></a><a class="link" href="#recomputing-task-locality-preferencesrecomputelocality-method"><a id="recomputeLocality"></a> Recomputing Task Locality Preferences&#8201;&#8212;&#8201;<code>recomputeLocality</code> Method</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">recomputeLocality(): Unit</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>recomputeLocality</code> recomputes the internal caches: <a href="#myLocalityLevels">myLocalityLevels</a>, <a href="#localityWaits">localityWaits</a> and <a href="#currentLocalityIndex">currentLocalityIndex</a>.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
FIXME But <strong>why</strong> are the caches important (and have to be recomputed)?
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>recomputeLocality</code> records the current <a href="TaskSchedulerImpl.html#TaskLocality" class="page">TaskLocality</a> level of this <code>TaskSetManager</code> (that is <a href="#currentLocalityIndex">currentLocalityIndex</a> in <a href="#myLocalityLevels">myLocalityLevels</a>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>TaskLocality</code> is one of <code>PROCESS_LOCAL</code>, <code>NODE_LOCAL</code>, <code>NO_PREF</code>, <code>RACK_LOCAL</code> and <code>ANY</code> values.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>recomputeLocality</code> <a href="#computeValidLocalityLevels">computes locality levels (for scheduled tasks)</a> and saves the result in <a href="#myLocalityLevels">myLocalityLevels</a> internal cache.</p>
</div>
<div class="paragraph">
<p><code>recomputeLocality</code> computes <a href="#localityWaits">localityWaits</a> (by <a href="#getLocalityWait">finding locality wait</a> for every locality level in <a href="#myLocalityLevels">myLocalityLevels</a> internal cache).</p>
</div>
<div class="paragraph">
<p>In the end, <code>recomputeLocality</code> <a href="#getLocalityIndex">getLocalityIndex</a> of the previous locality level and records it in <a href="#currentLocalityIndex">currentLocalityIndex</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>recomputeLocality</code> is used when <code>TaskSetManager</code> gets notified about status change in executors, i.e. when an executor is <a href="#executorLost">lost</a> or <a href="#executorAdded">added</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="computing-locality-levels-for-scheduled-taskscomputevalidlocalitylevels-internal-method"><a class="anchor" href="#computing-locality-levels-for-scheduled-taskscomputevalidlocalitylevels-internal-method"></a><a class="link" href="#computing-locality-levels-for-scheduled-taskscomputevalidlocalitylevels-internal-method"><a id="computeValidLocalityLevels"></a> Computing Locality Levels (for Scheduled Tasks)&#8201;&#8212;&#8201;<code>computeValidLocalityLevels</code> Internal Method</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">computeValidLocalityLevels(): Array[TaskLocality]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>computeValidLocalityLevels</code> computes valid locality levels for tasks that were registered in corresponding registries per locality level.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="TaskSchedulerImpl.html" class="page">TaskLocality</a> is a task locality preference and can be the most localized <code>PROCESS_LOCAL</code>, <code>NODE_LOCAL</code> through <code>NO_PREF</code> and <code>RACK_LOCAL</code> to <code>ANY</code>.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. TaskLocalities and Corresponding Internal Registries</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">TaskLocality</th>
<th class="tableblock halign-left valign-top">Internal Registry</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PROCESS_LOCAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#pendingTasksForExecutor">pendingTasksForExecutor</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NODE_LOCAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#pendingTasksForHost">pendingTasksForHost</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NO_PREF</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#pendingTasksWithNoPrefs">pendingTasksWithNoPrefs</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RACK_LOCAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#pendingTasksForRack">pendingTasksForRack</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>computeValidLocalityLevels</code> walks over every internal registry and if it is not empty <a href="#getLocalityWait">computes locality wait</a> for the corresponding <code>TaskLocality</code> and proceeds with it only when the locality wait is not <code>0</code>.</p>
</div>
<div class="paragraph">
<p>For <code>TaskLocality</code> with pending tasks, <code>computeValidLocalityLevels</code> asks <code>TaskSchedulerImpl</code> whether there is at least one executor alive (for <a href="TaskSchedulerImpl.html#isExecutorAlive" class="page">PROCESS_LOCAL</a>, <a href="TaskSchedulerImpl.html#hasExecutorsAliveOnHost" class="page">NODE_LOCAL</a> and <a href="TaskSchedulerImpl.html#hasHostAliveOnRack" class="page">RACK_LOCAL</a>) and if so registers the <code>TaskLocality</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>computeValidLocalityLevels</code> uses <a href="#sched">TaskSchedulerImpl</a> that was given when <a href="#TaskSetManager"><code>TaskSetManager</code> was created</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>computeValidLocalityLevels</code> always registers <code>ANY</code> task locality level.</p>
</div>
<div class="paragraph">
<p>In the end, you should see the following DEBUG message in the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>DEBUG TaskSetManager: Valid locality levels for [taskSet]: [comma-separated levels]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>computeValidLocalityLevels</code> is used when <code>TaskSetManager</code> <a href="#creating-instance">is created</a> and later to <a href="#recomputeLocality">recompute locality</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="finding-locality-waitgetlocalitywait-internal-method"><a class="anchor" href="#finding-locality-waitgetlocalitywait-internal-method"></a><a class="link" href="#finding-locality-waitgetlocalitywait-internal-method"><a id="getLocalityWait"></a> Finding Locality Wait&#8201;&#8212;&#8201;<code>getLocalityWait</code> Internal Method</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">getLocalityWait(level: TaskLocality): Long</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>getLocalityWait</code> finds <strong>locality wait</strong> (in milliseconds) for a given <a href="TaskSchedulerImpl.html#TaskLocality" class="page">TaskLocality</a>.</p>
</div>
<div class="paragraph">
<p><code>getLocalityWait</code> uses <a href="../configuration-properties.html#spark.locality.wait" class="page">spark.locality.wait</a> (default: <code>3s</code>) when the <code>TaskLocality</code>-specific property is not defined or <code>0</code> for <code>NO_PREF</code> and <code>ANY</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>NO_PREF</code> and <code>ANY</code> task localities have no locality wait.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. TaskLocalities and Corresponding Spark Properties</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">TaskLocality</th>
<th class="tableblock halign-left valign-top">Spark Property</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PROCESS_LOCAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../configuration-properties.html#spark.locality.wait.process" class="page">spark.locality.wait.process</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NODE_LOCAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../configuration-properties.html#spark.locality.wait.node" class="page">spark.locality.wait.node</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RACK_LOCAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../configuration-properties.html#spark.locality.wait.rack" class="page">spark.locality.wait.rack</a></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>getLocalityWait</code> is used when <code>TaskSetManager</code> calculates <a href="#localityWaits">localityWaits</a>, <a href="#computeValidLocalityLevels">computes locality levels (for scheduled tasks)</a> and <a href="#recomputeLocality">recomputes locality preferences</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="checking-available-memory-for-task-resultscanfetchmoreresults-method"><a class="anchor" href="#checking-available-memory-for-task-resultscanfetchmoreresults-method"></a><a class="link" href="#checking-available-memory-for-task-resultscanfetchmoreresults-method"><a id="canFetchMoreResults"></a> Checking Available Memory For Task Results&#8201;&#8212;&#8201;<code>canFetchMoreResults</code> Method</a></h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-scala hljs" data-lang="scala">canFetchMoreResults(size: Long): Boolean</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>canFetchMoreResults</code> checks whether there is enough memory to fetch the result of a task.</p>
</div>
<div class="paragraph">
<p>Internally, <code>canFetchMoreResults</code> increments the internal <a href="#totalResultSize">totalResultSize</a> with the input <code>size</code> (which is the size of the result of a task) and increments the internal <a href="#calculatedTasks">calculatedTasks</a>.</p>
</div>
<div class="paragraph">
<p>If the current internal <a href="#totalResultSize">totalResultSize</a> is bigger than the <a href="../configuration-properties.html#maxResultSize" class="page">maximum result size</a>, <code>canFetchMoreResults</code> prints out the following ERROR message to the logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Total size of serialized results of [calculatedTasks] tasks ([totalResultSize]) is bigger than spark.driver.maxResultSize ([maxResultSize])</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>canFetchMoreResults</code> uses <a href="../configuration-properties.html#spark.driver.maxResultSize" class="page">spark.driver.maxResultSize</a> configuration property to control the maximum result size. The default value is <code>1g</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the end, <code>canFetchMoreResults</code> <a href="#abort">aborts</a> the <a href="#taskSet">TaskSet</a> and returns <code>false</code>.</p>
</div>
<div class="paragraph">
<p>Otherwise, <code>canFetchMoreResults</code> returns <code>true</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>canFetchMoreResults</code> is used exclusively when <code>TaskResultGetter</code> is requested to  <a href="TaskResultGetter.html#enqueueSuccessfulTask" class="page">enqueue a successful task</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
